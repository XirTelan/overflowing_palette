var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{p as s}from"./phaser-C2RWnc_5.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=(t=>(t[t.red=0]="red",t[t.green=1]="green",t[t.blue=2]="blue",t[t.yellow=3]="yellow",t[t.purple=4]="purple",t[t.cyan=5]="cyan",t))(i||{}),o=(t=>(t[t.Waiting=0]="Waiting",t[t.Active=1]="Active",t))(o||{});class n{constructor(t,s,i,o,n=0){e(this,"tile"),e(this,"transitionTile"),e(this,"color"),e(this,"colors"),e(this,"grid"),e(this,"pos"),this.color=o,this.grid=t;const{cellSize:a,scene:r}=t,{colors:c}=r.cache.json.get("config");this.colors=c,this.tile=r.add.shader("base",i*(a+n),s*(a+n),a,a,["celltexture","cellnoise","cellnoise_d","cellnoise_center"]).setOrigin(0,0),this.tile.setUniform("color.value",c[o]),this.tile.setInteractive(),this.tile.on("pointerdown",this.onClick,this),this.tile.on("pointerover",this.onEnter,this),this.tile.on("pointerout",this.onLeave,this),this.pos={x:s,y:i};const l=r.add.shader("base",this.tile.x+a/2,this.tile.y+a/2,a,a);l.setUniform("color.value",{x:.949,y:.953,z:.827}),l.setUniform("active.value",1),l.setUniform("transparent.value",1),l.setVisible(!1),this.transitionTile=l}onEnter(){this.tile.setUniform("active.value",1)}onLeave(){this.tile.setUniform("active.value",0)}onClick(){this.grid.cellAction(this.pos.x,this.pos.y,this.color)}setColor(t){this.color=t,this.tile.setUniform("color.value",this.colors[t])}}const a=[[1,0],[-1,0],[0,1],[0,-1]],r=t=>Phaser.Display.Color.GetColor(255*t.x,255*t.y,255*t.z);function c(t,e){const s=Object.keys(i).length/2;return((e+t)%s+s)%s}function l(t){const e=i[t];return`${e[0].toUpperCase()}${e.slice(1)}`}class h{constructor(t,s){var i,o;e(this,"scene"),e(this,"container"),e(this,"transitionSpeed",800),e(this,"transitionSpeedMinimum",50),e(this,"pendingCalls",0),e(this,"board",[]),e(this,"cellSize"),e(this,"defaultValues"),e(this,"history"),e(this,"border"),this.scene=t,this.defaultValues=s;const a=s.length,r=s[0].length,c=[],{gridOptions:l}=t.cache.json.get("config").game;this.transitionSpeed=l.transition.default,this.transitionSpeedMinimum=l.transition.minimum;const h=Math.min((l.height-l.gap*(a-1))/a,(l.width-l.gap*(r-1))/r);this.cellSize=h;const d=l.width-l.borderPadding-r*(h+l.gap),g=l.height-l.borderPadding-a*(h+l.gap);this.border=t.add.nineslice(l.borderOffset.left,l.borderOffset.top,"grid_border",void 0,l.width-l.borderOffset.right-d,l.height-l.borderOffset.bottom-g,270,128,l.height/2.56,l.height/3).setOrigin(0,0).setTint(this.getColor()),null==(i=this.border.postFX)||i.addShine(.2,1,4);for(let e=0;e<a;e++)for(let t=0;t<r;t++){this.scene.gameStates.availableColors.add(s[e][t]);const i=new n(this,e,t,s[e][t],l.gap);c.push(i.tile),c.push(i.transitionTile),(o=this.board)[e]??(o[e]=[]),this.board[e][t]=i,s[e][t]!==this.scene.gameStates.targetColor&&(this.scene.gameStates.remains++,this.scene.gameStates.initialState.remains++)}this.container=this.scene.add.container(this.scene.cameras.main.width/2-l.width/2-l.offset.x,l.offset.y,[this.border,...c])}bfs(t,e,s,i,n,r,c){if(!this.board[t]||!this.board[t][e]||this.board[t][e].color==i||this.board[t][e].color!=s||n.has(this.board[t][e]))return;const{colors:l}=this.scene.cache.json.get("config");this.pendingCalls++;const h=this.board[t][e],d=this.board[t][e].tile;n.add(h);const g=h.transitionTile,u=this.transitionSpeedMinimum,p=Math.max(this.transitionSpeed*Math.pow(.8,r),u);this.scene.tweens.chain({targets:null,tweens:[{targets:d,x:{value:()=>d.x+Phaser.Math.Between(-5,5),duration:.1*p,repeat:1},y:{value:()=>d.y+Phaser.Math.Between(-5,5),duration:.1*p,repeat:1},onComplete:()=>{g.setVisible(!0).setDepth(10)},repeat:0,yoyo:!0,ease:"Sine.easeInOut"},{targets:g,alpha:.8,duration:p/2-10,repeat:0,scale:1.2,ease:"Linear"},{targets:g,alpha:0,scale:1.4,duration:p/2-10,repeat:0,ease:"Linear"}],onComplete:()=>{g.setVisible(!1),g.scale=1},delay:0,loop:0}),this.scene.tweens.addCounter({from:0,to:1,delay:.1*p,duration:p,ease:"Cubic.InOut",repeat:0,onStart:()=>{this.scene.sound.play("tileFlip",{detune:150*r}),this.board[t][e].tile.setUniform("colorToTransform.value",l[i]),this.board[t][e].tile.setUniform("curPoint.value",{x:t,y:e}),this.board[t][e].tile.setUniform("startPoint.value",c)},onUpdate:s=>{this.board[t][e].tile.setUniform("transition.value",s.getValue())},onComplete:()=>{this.board[t][e].tile.scale=1,this.board[t][e].tile.depth=1,this.board[t][e].tile.setUniform("transition.value",0),this.board[t][e].tile.setUniform("color.value",l[i]),this.board[t][e].color===this.scene.gameStates.targetColor&&this.scene.gameStates.remains++,this.board[t][e].color=Number(i),this.board[t][e].color===this.scene.gameStates.targetColor&&(this.scene.gameStates.remains-=1),this.pendingCalls--,0===this.pendingCalls&&this.scene.changeGameState(o.Active)}});for(const[o,m]of a)this.scene.time.delayedCall(p,(()=>{this.bfs(t+o,e+m,s,i,n,r+1,c)}))}flip(t,e,s){s!=this.scene.gameStates.selectedColor&&(this.scene.changeGameState(o.Waiting),this.bfs(t,e,s,this.scene.gameStates.selectedColor,new Set,0,{x:t,y:e}))}cellAction(t,e,s){if("Play"==this.scene.gameStates.mode){if(this.scene.gameStates.state===o.Waiting)return;this.flip(t,e,s)}else this.changeColor(t,e)}changeColor(t,e){const{colors:s}=this.scene.cache.json.get("config");this.board[t][e].tile.setUniform("color.value",s[this.scene.gameStates.selectedColor]),this.board[t][e].color=Number(this.scene.gameStates.selectedColor)}getColor(){const{colors:t}=this.scene.cache.json.get("config"),{x:e,y:s,z:i}=t[this.scene.gameStates.targetColor];return Phaser.Display.Color.GetColor(255*e,255*s,255*i)}updateBorderTint(){this.border.clearTint(),this.border.setTint(this.getColor())}resetBoard(){const t=this.defaultValues,e=t.length,s=t[0].length;for(let i=0;i<e;i++)for(let e=0;e<s;e++)this.board[i][e].setColor(t[i][e])}}const d={1:"NUMPAD_ONE,ONE",2:"NUMPAD_TWO,TWO",3:"NUMPAD_THREE,THREE",4:"NUMPAD_FOUR,FOUR",5:"NUMPAD_FIVE,FIVE",6:"NUMPAD_SIX,SIX",7:"NUMPAD_SEVEN,SEVEN",8:"NUMPAD_EIGHT,EIGHT",9:"NUMPAD_NINE,NINE"};class g{constructor(t,s,i,o,n,a,r){var c;e(this,"scene"),e(this,"gameObject"),e(this,"color"),e(this,"active"),e(this,"pointer"),this.scene=t;const l=this.scene.add.circle(s,i,o/2+5,16053492).setVisible(!1);this.active=l;const h=this.scene.add.triangle(l.x+o/2+20,10,s-5,i,s+10,i+10,s+10,i-10,16777215),g=this.scene.add.shader("base",s,i,o,o),u=this.scene.make.image({x:s,y:i+o/2,key:"uiatlas",frame:"hotkey_btn",scale:.1}),p=this.scene.make.text({x:s,y:u.y,text:`${a}`,style:{color:"#3e3e3e",font:"20px OpenSans_Bold"}}).setOrigin(.5,.5);r&&(r.add(l),r.add(g),r.add(u),r.add(p),r.add(h)),g.setUniform("color.value",n[1]),g.setUniform("radius.value",.5),g.setChannel0("celltexture"),g.setInteractive(),g.on("pointerdown",this.onClick,this),g.on("pointerover",this.onEnter,this),g.on("pointerout",this.onLeave,this);const m=null==(c=this.scene.input.keyboard)?void 0:c.addKeys(d[a]);if(m)for(const e of Object.keys(m))m[e].on("down",this.onClick,this);this.scene.tweens.add({targets:h,duration:1e3,x:"+=10",yoyo:!0,repeat:-1}),this.color=n,this.gameObject=g,this.pointer=h,this.update()}onEnter(){this.scene.sound.play("mouseOver"),this.active.setVisible(!0)}onLeave(){Number(this.scene.gameStates.selectedColor)!=Number(this.color[0])&&this.active.setVisible(!1)}update(){Number(this.scene.gameStates.selectedColor)===Number(this.color[0])?(this.active.setVisible(!0),this.pointer.setVisible(!0)):(this.active.setVisible(!1),this.pointer.setVisible(!1))}onClick(){this.scene.changeSelectedColor(this.color[0]),this.scene.sound.play("colorSelect")}}class u{constructor(t,s,i,o,n,a,r){e(this,"scene"),e(this,"leftButton"),e(this,"rightButton"),e(this,"container"),e(this,"text"),e(this,"value"),this.scene=t,this.container=t.add.container(s,i),this.value=n,this.leftButton=this.createButton(a,{x:-o/2,y:0,scale:.3,angle:180}),this.rightButton=this.createButton(r,{x:o/2,y:0,scale:.3,angle:0}),this.text=t.make.text({x:0,y:0,text:String(this.value),style:{color:"#ffffff",font:"20px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([t.add.rectangle(0,0,o,50,1710876,.6),t.add.circle(-o/2,0,25,1710876,.6),t.add.circle(o/2,0,25,1710876,.6),this.leftButton,this.text,this.rightButton])}createButton(t,e){const s=this.scene.add.container(e.x,0),i=this.scene.add.image(0,0,"uiatlas","arrow").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale),o=this.scene.add.image(0,0,"uiatlas","arrowBtn_over").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale);return o.setVisible(!1),i.setInteractive(),i.on("pointerdown",(()=>{this.text.setText(String(t()))})),i.on("pointerover",(()=>{o.setScale(.35),o.setVisible(!0)})),i.on("pointerout",(()=>{o.setScale(.3),o.setVisible(!1)})),s.add([i,o]),s}}class p{constructor(t,s,i){e(this,"scene"),e(this,"container"),this.scene=i,this.container=i.add.container(t,s)}hide(){this.container.setVisible(!1)}show(){this.container.setVisible(!0)}}class m extends p{constructor(t,s,i,o,n,a,r,c){super(t,s,a),e(this,"btn"),e(this,"text"),e(this,"overlay"),this.btn=a.add.nineslice(0,0,"uiatlas","primaryBtn",o,n,157,55).setOrigin(.5,.5).setScale(.7),this.overlay=a.add.nineslice(0,0,"uiatlas","primaryBtn__overlay",o,n,157,55).setOrigin(.5,.5).setScale(.7),this.overlay.setVisible(!1),this.btn.setInteractive(),r&&this.btn.on("pointerdown",r,c),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),this.text=a.make.text({x:this.btn.x,y:this.btn.y,text:i,style:{color:"#000000",font:"24px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([this.btn,this.overlay,this.text])}onEnter(){this.scene.input.setDefaultCursor("pointer"),this.overlay.setVisible(!0)}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default")}}class f{constructor(t){e(this,"viewBox"),e(this,"copyBtnString"),e(this,"copyBtnJson"),e(this,"openButton"),e(this,"isOpen"),e(this,"scene"),this.openButton=new m(160,320,"Export",250,50,t,(()=>this.open())),this.scene=t}copyToClipboard(t){navigator.clipboard.writeText(t),this.viewBox.destroy(),this.copyBtnString.container.destroy(),this.copyBtnJson.container.destroy()}open(){this.isOpen||(this.isOpen=!0,this.render())}close(){this.isOpen=!1}render(){const t=this.scene,e=t.grid.board.map((t=>t.map((t=>t.color)))),s={targetColor:t.gameStates.targetColor,turns:t.gameStates.turns,board:e},i=JSON.stringify(s,null,"\t"),o=btoa(JSON.stringify(s,null));this.viewBox=t.add.dom(t.cameras.main.width/2-8,t.cameras.main.height/2-100,"pre",{width:"800px",height:"800px",background:"#121212",fontSize:"24px",padding:"10px",overflow:"auto"}),this.copyBtnJson=new m(t.cameras.main.width/2+200,910,"Copy JSON",400,50,t,(()=>{this.copyToClipboard(i),this.isOpen=!1})),this.copyBtnString=new m(t.cameras.main.width/2-200,910,"Copy STRING",400,50,t,(()=>{this.copyToClipboard(o),this.isOpen=!1})),this.copyBtnJson.container.setScale(1.5),this.copyBtnString.container.setScale(1.5),this.viewBox.setText(i)}}class x{constructor(t,s){e(this,"scene"),e(this,"graphics"),e(this,"selectionBox"),e(this,"selectedObjects",[]),e(this,"isSelecting",!1),e(this,"startX"),e(this,"startY"),e(this,"objectList"),this.scene=s;const{selectionBox:i}=s.cache.json.get("config").game;this.graphics=s.add.graphics(i),this.objectList=t.flat(),s.input.on("pointerdown",this.onPointerDown,this),s.input.on("pointermove",this.onPointerMove,this),s.input.on("pointerup",this.onPointerUp,this)}onPointerDown(t){this.isSelecting=!0,this.startX=t.x,this.startY=t.y,this.selectionBox=new Phaser.Geom.Rectangle(this.startX,this.startY,0,0)}onPointerMove(t){this.isSelecting&&(this.selectionBox.width=t.x-this.startX,this.selectionBox.height=t.y-this.startY,this.redrawSelectionBox())}onPointerUp(){this.isSelecting=!1,this.graphics.clear(),this.selectedObjects=[];const t=this.selectionBox;if(!t)return;t.x=Math.min(t.x,t.x+t.width),t.width=Math.abs(t.width),t.y=Math.min(t.y,t.y+t.height),t.height=Math.abs(t.height);const e=this.scene.grid.cellSize/2;this.objectList.forEach((s=>{const{x:i,y:o}=s.tile.getWorldPoint();i+e>t.x&&i+e<t.x+t.width&&o+e>t.y&&o+e<t.y+t.height&&s.onClick()}))}redrawSelectionBox(){this.graphics.clear().fillRectShape(this.selectionBox)}}class y extends s.Scene{constructor(){super("Game"),e(this,"grid"),e(this,"colorSelectionButtons"),e(this,"btnContainer"),e(this,"gameStates"),e(this,"turnCounter"),e(this,"selectionBox"),e(this,"startTime"),e(this,"colors")}preload(){}create({mode:t,levelKey:e,levelData:s}){const n=this.cameras.main.width,a=this.cameras.main.height,{colors:r}=this.cache.json.get("config");this.colors=r,this.add.shader("distortion",n/2,a/2,n,a,["background"]),function(t,e){const s=t.shader.get("base"),{shaders:i}=t.json.get("config");s.uniforms={...i.base.init,screenResolution:{type:"2f",value:e}}}(this.cache,{x:n,y:a}),function(t,e,s,n){const a={levelKey:n,turns:s.turns,targetColor:s.targetColor,selectedColor:i.red,availableColors:new Set,state:o.Active,remains:0,mode:e,initialState:{turns:s.turns,remains:0}};t.gameStates=a,t.grid=new h(t,s.board),t.colorSelectionButtons=[],t.btnContainer=t.add.container(1500,400,[])}(this,t,s,e),"Editor"===t&&(this.selectionBox=new x(this.grid.board,this)),function(t){const{game:{ui:e}}=t.cache.json.get("config");"Editor"==t.gameStates.mode&&function(t,e){t.make.text({x:60,y:110,text:"Moves count:",style:{color:"#fff",font:"22px OpenSans_Regular"}}),t.make.text({x:60,y:200,text:"Target color:",style:{color:"#fff",font:"22px OpenSans_Regular"}}),new u(t,e.turnsValueSelector.x,e.turnsValueSelector.y,e.turnsValueSelector.width,t.gameStates.turns,(()=>--t.gameStates.turns),(()=>++t.gameStates.turns)),new f(t),new u(t,e.targetValueSelector.x,e.targetValueSelector.y,e.targetValueSelector.width,l(t.gameStates.targetColor),(()=>v(-1,t)),(()=>v(1,t)))}(t,e),"Play"==t.gameStates.mode&&function(t,e){const s=t.colors,o=t.make.text({x:60,y:110,text:"Remaining Moves:",style:{color:"#fff",font:"22px OpenSans_Regular"}});t.turnCounter=t.make.text({x:60+o.width+5,y:105,text:`${t.gameStates.turns}`,style:{color:"#ffcd3f",font:"26px OpenSans_ExtraBold"}});const n=t.make.text({x:e.targetUI.x,y:e.targetUI.y,text:"Turn all the blocks into",style:{color:"#cbcbcc",font:"30px OpenSans_Regular"}}),a=i[t.gameStates.targetColor];t.make.text({x:n.x+n.width+5,y:e.targetUI.y,text:`${a[0].toUpperCase()}${a.slice(1)}`,style:{color:`rgb(${255*s[t.gameStates.targetColor].x},${255*s[t.gameStates.targetColor].y},${255*s[t.gameStates.targetColor].z} )`,font:"30px OpenSans_Regular"}})}(t,e);const s=t.add.image(60,50,"icon").setScale(.5).setOrigin(0);t.make.text({x:s.x+50,y:s.y,text:"Overflowing Palette "+("Editor"===t.gameStates.mode?"| Mode:Editor":""),style:{color:"#ab9c6b",font:"26px OpenSans_Bold"}})}(this),this.initButtons(),this.startTime=this.time.now}changeGameState(t){if(t===o.Waiting&&(this.gameStates.state=o.Waiting),t===o.Active)if(this.gameStates.state=o.Active,this.gameStates.turns=Math.max(0,this.gameStates.turns-1),this.turnCounter.text=String(this.gameStates.turns),0===this.gameStates.remains){const t=this.gameStates.levelKey;if(new Date(this.time.now-this.startTime).toISOString().slice(11,19),this.gameStates.state=o.Waiting,!t)return;const e=localStorage.getItem("clearedLevels");let s;if(e){const t=JSON.parse(e);s=new Set(t)}else s=new Set;s.add(t),localStorage.setItem("clearedLevels",JSON.stringify(Array.from(s)))}else 0==this.gameStates.turns&&this.resetGame()}changeSelectedColor(t){this.gameStates.selectedColor=t,this.colorSelectionButtons.forEach((t=>t.update()))}initButtons(){const t=this,{game:{ui:e}}=t.cache.json.get("config"),s=e.colorButtons.size,{colors:i}=t.cache.json.get("config");Object.entries(i).filter((([e])=>!("Play"===t.gameStates.mode&&!t.gameStates.availableColors.has(Number(e))))).forEach((([i,o],n)=>{const a=new g(t,0,n*(s+e.colorButtons.gap),s,[Number(i),o],n+1,t.btnContainer);t.colorSelectionButtons.push(a)})),t.btnContainer.y-=80*t.colorSelectionButtons.length/2,function(t){const{resetBtn:e}=t.cache.json.get("config").game.ui,s=t.add.image(t.btnContainer.x,t.cameras.main.height-140,"uiatlas","resetBtn").setScale(.8),i=t.add.image(t.btnContainer.x,t.cameras.main.height-140,"uiatlas","resetBtn_over").setScale(.8);i.setVisible(!1);const o=t.make.image({...e.hotkeyBtn,x:s.x-30,y:s.y+80});t.make.text({...e.hotkeyText,x:o.x,y:o.y}),t.make.text({...e.text,x:o.x+60,y:o.y}),s.setInteractive(),s.on("pointerdown",(()=>{t.resetGame()})),s.on("pointerover",(()=>{i.setVisible(!0)})),s.on("pointerout",(()=>{i.setVisible(!1)}))}(this),function(t){const{game:{ui:e}}=t.cache.json.get("config"),s=t.add.image(t.cameras.main.width-e.closeBtn.offset.x,0+e.closeBtn.offset.y,"uiatlas","closeBtn").setScale(e.closeBtn.scale);s.setInteractive(),s.on("pointerdown",(()=>{t.scene.start("MainMenu")})),s.on("pointerover",(()=>{s.setScale(e.closeBtn.scale+.1)})),s.on("pointerout",(()=>{s.setScale(e.closeBtn.scale)}))}(this)}resetGame(){this.grid.resetBoard();const{initialState:t}=this.gameStates;"Play"===this.gameStates.mode&&(this.gameStates.turns=t.turns,this.gameStates.remains=t.remains,this.turnCounter.text=String(this.gameStates.turns))}}function v(t,e){let s=c(t,e.gameStates.targetColor);return e.gameStates.targetColor=s,e.grid.updateBorderTint(),l(s)}class S extends s.Scene{constructor(){super("Boot")}preload(){this.showLoading(),this.load.pack("assets_pack","assets/data/assets.json")}create(){this.loadUserConfig(),this.scene.start("MainMenu")}loadUserConfig(){const t=this.cache.json.get("config");this.loadShaderUserConfig(["activeOffset","lightenFactor"]);const e=localStorage.getItem("colors");e&&(t.colors={...t.colors,...JSON.parse(e)})}loadShaderUserConfig(t){const e=this.cache.json.get("config");t.forEach((t=>{const s=localStorage.getItem(`shader.${t}`);s&&(e.shaders.base.init={...e.shaders.base.init,[t]:JSON.parse(s)})}))}showLoading(t=b){const e=this,s=this.load,i=e.add.graphics(),o=e.add.graphics(),n=e.cameras.main.width,a=e.cameras.main.height;o.fillStyle(2236962,.7),o.fillRect(n/2-(t.width+t.boxPadding)/2,a/2-(t.height+t.boxPadding)/2,t.width+t.boxPadding,t.height+t.boxPadding);const r=e.make.text({x:n/2,y:a/2-t.height-t.boxPadding,text:"Loading...",style:{font:"20px monospace",color:"#ffffff"}});r.setOrigin(.5,.5);const c=e.make.text({x:n/2,y:a/2,text:"0%",style:{font:"18px monospace",color:"#ffffff"}});c.setOrigin(.5,.5);const l=e.make.text({x:n/2,y:a/2+t.height+t.boxPadding,text:"",style:{font:"18px monospace",color:"#ffffff"}});l.setOrigin(.5,.5),s.on("progress",(function(e){i.clear(),i.fillStyle(16777215,1),i.fillRect(n/2-t.width/2,a/2-t.height/2,t.width*e,t.height),c.setText(100*e+" %")})),s.on("fileprogress",(function(t){l.setText(`Loading asset: ${t.src}`)})),s.on("complete",(function(){i.destroy(),o.destroy(),r.destroy(),c.destroy(),l.destroy()}))}}const b={width:300,boxPadding:10,height:30};class w extends p{constructor(t,s,i,o,n){var a;super(s,i,t),e(this,"btn"),e(this,"overlay"),e(this,"text"),e(this,"isActive");const r=this.container,{menuBtn:c}=t.cache.json.get("config").mainMenu;this.btn=t.add.image(c.btn.offset,0,"uiatlas","menuBtn").setOrigin(0,.5),this.text=t.make.text({...c.text,text:o}).setOrigin(0,.5),this.overlay=t.add.image(this.btn.x,this.btn.y,"uiatlas","menuBtn_overlay").setOrigin(0,.5),null==(a=this.overlay.preFX)||a.addBloom(16777215,1,1,1.5),this.overlay.setVisible(!1),this.btn.setInteractive(),this.btn.on("pointerdown",n,this),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),r.add(this.btn),r.add(this.overlay),r.add(this.text),this.container=r}setActive(t){this.isActive=t}onEnter(){this.overlay.setVisible(!0),this.scene.input.setDefaultCursor("pointer"),this.text.setColor("#ffffff")}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default"),this.text.setColor("#a4a4a4")}}class B extends p{constructor({key:t,x:s,y:i,scene:o,width:n,height:a}){super(s,i,o),e(this,"key"),e(this,"content"),e(this,"width"),e(this,"height"),e(this,"defaultPos"),e(this,"actionBtn"),this.key=t,this.content=o.add.container(0,0),this.defaultPos={x:s,y:i},this.width=n,this.height=a,this.container.setVisible(!1),this.container.add(this.content),this.container.add(o.add.rectangle(0,0,n,a,0,.6).setOrigin(0,0));const r=o.add.rectangle(s,i,n,a,16777215).setOrigin(0,0).setVisible(!1).createGeometryMask();this.content.setMask(r),this.actionBtn=new m(n-180,a+50,"Start",350,0,o),this.actionBtn.container.setScale(1.5),this.container.add(this.actionBtn.container)}show(){this.container.visible||(this.container.setVisible(!0),this.scene.tweens.add({duration:300,targets:this.container,x:{from:this.defaultPos.x-100,to:this.defaultPos.x},alpha:{from:0,to:1},yoyo:!1}))}hide(t){const e=this.container.x;this.scene.tweens.add({duration:t?0:300,targets:this.container,x:{from:this.defaultPos.x,to:this.defaultPos.x-100},alpha:{from:1,to:0},onComplete:()=>{this.container.setVisible(!1),this.container.setX(e)}})}}class C extends p{constructor(t,s,i,o,n,a){super(t,s,a),e(this,"previewBlock"),e(this,"levelInfo"),e(this,"emptyBlock"),e(this,"actionBtn"),e(this,"width"),this.width=i;const{selectedLevelInfo:r}=a.cache.json.get("config").mainMenu.levelSelection;this.container.add([a.add.rectangle(0,0,i,o,0,.6).setOrigin(0,0),a.add.rectangle(0,0,i,45,0,1).setOrigin(0,0),a.make.text({x:i/2,y:0,text:"Preview",style:{color:"#fff",font:"32px OpenSans_Bold"}}).setOrigin(.5,0)]),this.emptyBlock=a.make.text({...r.emptyText,x:i/2}).setOrigin(.5,0),this.previewBlock=new O(0,40,a),this.levelInfo=new k(20,40,a),this.container.add([this.emptyBlock,this.levelInfo.container,this.previewBlock.container]),this.actionBtn=n,n.container.setPosition(i/2+70,o-50),n.container.parentContainer.remove(n.container),n.container.setScale(1),this.container.add(n.container),n.hide(),this.previewBlock.hide(),this.levelInfo.hide()}updateInfo(t,e){if(!t)return this.actionBtn.hide(),this.previewBlock.hide(),this.levelInfo.hide(),void this.emptyBlock.setVisible(!0);this.actionBtn.container.setVisible(!0),this.levelInfo.update(String(t.turns),t.targetColor),this.levelInfo.container.setVisible(!0),this.previewBlock.updatePreview(t.board),this.previewBlock.container.setVisible(!0),this.actionBtn.btn.on("pointerdown",(()=>{this.scene.scene.start("LoadingGame",{mode:"Play",levelKey:e,levelData:t})})),this.emptyBlock.setVisible(!1)}}class O extends p{constructor(t,s,i){super(t,s,i),e(this,"graphics"),this.graphics=i.add.graphics(),this.container.add(this.graphics)}updatePreview(t){const{selectedLevelInfo:e}=this.scene.cache.json.get("config").mainMenu.levelSelection,{colors:s}=this.scene.cache.json.get("config"),i=t.length,o=t[0].length,n=o*e.previewBlock.cellSize,a=i*e.previewBlock.cellSize,c=e.previewBlock.width/n,l=e.previewBlock.height/a,h=Math.min(c,l),d=this.graphics;d.setScale(h),this.container.setPosition((e.previewBlock.width-n*h)/2,this.container.y),d.clear();for(let g=0;g<i;g++)for(let e=0;e<o;e++){const i=s[t[g][e]];d.fillStyle(r(i)),d.fillRect(50*e,50*g,50,50)}}}class k extends p{constructor(t,s,i){super(t,s,i),e(this,"turnsText"),e(this,"tartgetColorText");const{selectedLevelInfo:o}=i.cache.json.get("config").mainMenu.levelSelection;this.container=i.add.container(o.infoBlock.x,o.infoBlock.y),this.container.add(i.add.rectangle(0,-10,o.infoBlock.width,o.infoBlock.height,0,1).setOrigin(0,0));const n=i.make.text({...o.targetColorTextOffset,text:"Target color:",style:o.defaultStyle});this.tartgetColorText=i.make.text({x:o.infoBlock.width-o.targetColorTextOffset.x,y:n.y,text:"No color",style:o.defaultStyle}).setOrigin(1,0);const a=i.make.text({...o.turnsTextOffset,text:"Turns:",style:o.defaultStyle});this.turnsText=i.make.text({x:o.infoBlock.width-o.turnsTextOffset.x,y:a.y,text:"0",style:{...o.defaultStyle,color:"#ffcd3f"}}).setOrigin(1,0),this.container.add([this.tartgetColorText,this.turnsText,n,a])}update(t,e){this.tartgetColorText.setText(`${i[e]}`);const{colors:s}=this.scene.cache.json.get("config"),{x:o,y:n,z:a}=s[e];this.tartgetColorText.setColor(Phaser.Display.Color.RGBToString(255*o,255*n,255*a)),this.turnsText.setText(t)}}class L extends p{constructor(t){super(0,0,t),e(this,"viewBox"),e(this,"applyBtn")}render(){const t=this.scene;this.viewBox=t.add.dom(t.cameras.main.width/2,t.cameras.main.height/2-100,"TextArea",{width:"500px",height:"200px",background:"#121212",fontSize:"24px",padding:"10px",overflow:"auto"}),this.applyBtn=new m(t.cameras.main.width/2,t.cameras.main.height/2+50,"Apply",600,50,t,(()=>{const t=this.viewBox.node;this.parseString(t.value)})),this.applyBtn.container.setScale(1.2),this.container.add([this.applyBtn.container,this.viewBox])}parseString(t){try{const e=JSON.parse(atob(t));if(!("turns"in e)||!("board"in e))return;this.scene.scene.start("LoadingGame",{mode:"Play",levelData:e})}catch(e){console.error("catch"),this.hide()}}hide(){super.hide(),this.viewBox.node.value=""}}class T extends B{constructor(t){super(t),e(this,"selectedLevelData"),e(this,"selectedFolder"),e(this,"selectedLevelInfo"),e(this,"levelsList"),e(this,"clearedLevels");const{x:s,y:i,scene:o,width:n,height:a}=t;this.levelsList=o.add.dom(0,0,"div",{width:`${n}px`,height:`${a}px`,fontSize:"24px",overflow:"auto"}).setOrigin(0,0),this.levelsList.node.id="boxid",this.container.add(this.levelsList);const r=document.createElement("div");this.selectedLevelInfo=new C(s+n,i,o.cameras.main.width-s-n-10,a,this.actionBtn,o),this.selectedLevelInfo.container.add(new m(80,this.actionBtn.container.y,"Back",200,0,o,(()=>{this.showFolders(),this.selectedLevelInfo.hide()})).container),this.levelsList.node.append(r),this.levelsList.node.id="boxid",this.selectedLevelInfo.hide(),this.showFolders()}showSelectedFolder(t){if(!this.scene.cache.json.get("levels"))return;this.levelsList.node.replaceChildren(),this.selectedFolder=t.folderName,this.selectedLevelInfo.show();const e=localStorage.getItem("clearedLevels");let s;if(e){const t=JSON.parse(e);s=new Set(t)}else s=new Set;this.clearedLevels=s;for(const i of t.categories)this.levelsList.node.append(this.createCategory(i))}showFolders(){const t=this.scene.cache.json.get("levels");if(!t)return;this.levelsList.node.replaceChildren();for(const s of t)this.levelsList.node.append(this.createFolderBtn(s.folderName,s));const e=this.createBtn("Import");e.addEventListener("click",(()=>{new L(this.scene).render()})),this.levelsList.node.append(e)}createLvlBtn(t,e,s){const i=this.createBtn(t);return s&&this.clearedLevels.has(s)&&i.classList.add("cleared"),i.addEventListener("click",(()=>{this.selectedLevelInfo.updateInfo(e,s)})),i}createFolderBtn(t,e){const s=this.createBtn(t);return s.addEventListener("click",(()=>{this.showSelectedFolder(e)})),s}createBtn(t){const e=document.createElement("div"),s=document.createElement("div");return s.innerText=t,s.classList.add("text"),e.classList.add("level-card"),e.append(s),e}createCategory(t){const e=document.createElement("div"),s=document.createElement("h3");s.classList.add("folder-text"),s.innerText=t.categoryName,e.append(s);const i=document.createElement("div");return i.classList.add("container"),t.levels.forEach(((e,s)=>{i.append(this.createLvlBtn(String(s+1),e,`${this.selectedFolder}.${t.categoryName}.${s+1}`))})),e.append(i),e.classList.add("folder"),e}show(){super.show(),this.showFolders()}hide(t){super.hide(),this.selectedLevelInfo.hide(),this.selectedLevelInfo.updateInfo(void 0)}}class E extends B{constructor(t){super(t),e(this,"selectedFillColor",0),e(this,"rows",8),e(this,"columns",10);const{scene:s,width:i,height:o}=t,{levelEditor:n}=s.cache.json.get("config").mainMenu;this.actionBtn.btn.setInteractive(),this.actionBtn.btn.on("pointerdown",(()=>{this.scene.scene.start("LoadingGame",{mode:"Editor",levelData:{board:this.generateField(this.rows,this.columns,this.selectedFillColor),targetColor:0,turns:0}})}));const a=s.make.text({x:100,y:120,text:"Columns:",style:n.defaultStyle}).setOrigin(0,.5),r=new u(s,400,a.y,200,this.columns,(()=>--this.columns),(()=>++this.columns)),c=s.make.text({x:100,y:50,text:"Rows:",style:n.defaultStyle}).setOrigin(0,.5),h=new u(s,400,c.y,200,this.rows,(()=>--this.rows),(()=>++this.rows)),d=s.make.text({x:100,y:190,text:"Fill color ",style:n.defaultStyle}).setOrigin(0,.5),g=new u(s,400,d.y,200,l(this.selectedFillColor),(()=>P(-1,this)),(()=>P(1,this)));this.container.add([c,h.container,a,r.container,d,g.container])}generateField(t,e,s){const i=[];for(let o=0;o<t;o++){i[o]??(i[o]=[]);for(let t=0;t<e;t++)i[o][t]=s}return i}}function P(t,e){let s=c(t,e.selectedFillColor);return e.selectedFillColor=s,l(s)}class I extends B{constructor(t){super(t),e(this,"viewBox"),e(this,"localCache"),e(this,"inputs",[]),e(this,"isSimpleColors"),e(this,"strongerHighlight");const s=this.scene,{colors:i}=s.cache.json.get("config");this.actionBtn.text.setText("Save"),this.actionBtn.container.setScale(1),this.actionBtn.container.setPosition(t.width/2+175,t.height+25),this.actionBtn.btn.on("pointerdown",this.save,this);const o=new m(t.width/2-25,this.actionBtn.container.y,"Reset",200,0,s,this.reset,this);this.viewBox=s.add.dom(0,0,"div",{width:`${t.width}px`,height:`${t.height}px`,fontSize:"24px",overflow:"auto"}).setOrigin(0);const n=document.createElement("div"),a=document.createElement("div");a.classList.add("colors-container");const r=document.createElement("p");r.textContent="After any changes (save/reset) refresh game",r.style="color:#fff;",r.classList.add("options-text"),n.append(r),this.addText("Colors",n,"category"),n.append(a),this.addText("Grid",n,"category"),n.classList.add("menu-options"),this.viewBox.node.append(n),this.container.add([this.viewBox,o.container]),Object.entries(i).forEach((t=>{const e=document.createElement("input");e.setAttribute("type","color"),this.inputs.push(e),e.value="#ffffff",a.append(e)})),this.isSimpleColors=this.addCheckbox("Simple colors",n,"shader.lightenFactor"),this.strongerHighlight=this.addCheckbox("Stronger higlight",n,"shader.activeOffset")}addText(t,e,s){const i=document.createElement("p");i.textContent=t,s&&i.classList.add(s),e.append(i)}addCheckbox(t,e,s){const i=document.createElement("div");i.style="display:flex;justify-content:space-between;align-items:center;padding:1rem;",this.addText(t,i);const o=document.createElement("input");return localStorage.getItem(s)&&(o.checked=!0),i.append(o),o.setAttribute("type","checkbox"),e.append(i),o}show(){super.show(),this.update()}update(){const{colors:t}=this.scene.cache.json.get("config");this.localCache=t,this.inputs.forEach(((t,e)=>{const s=this.localCache[e],i=Phaser.Display.Color.RGBToString(255*s.x,255*s.y,255*s.z);t.style.background=i,t.value=i}))}reset(){Object.keys(localStorage).forEach((t=>{"clearedLevels"!==t&&localStorage.removeItem(t)})),this.hide()}save(){const t={};this.inputs.forEach(((e,s)=>{const i=Phaser.Display.Color.HexStringToColor(e.value);t[s]={x:i.red/255,y:i.green/255,z:i.blue/255}})),this.isSimpleColors.checked?localStorage.setItem("shader.lightenFactor",JSON.stringify({type:"1f",value:1})):localStorage.removeItem("shader.lightenFactor"),this.strongerHighlight.checked?localStorage.setItem("shader.activeOffset",JSON.stringify({type:"2f",value:{x:0,y:.7}})):localStorage.removeItem("shader.activeOffset"),localStorage.setItem("colors",JSON.stringify(t)),this.hide()}}const M=["LevelEditor","LevelSelector","Options"];class N extends s.Scene{constructor(){super("MainMenu"),e(this,"activeTab"),e(this,"tabs",new Map)}preload(){}create(){this.createBackground(),this.makeMenuBtns();const t=new T({x:500,y:100,scene:this,width:1e3,height:800,key:"LevelSelector"}),e=new E({x:500,y:100,scene:this,width:600,height:600,key:"LevelEditor"}),s=new I({x:500,y:100,scene:this,width:600,height:600,key:"Options"});this.tabs.set("LevelSelector",t),this.tabs.set("LevelEditor",e),this.tabs.set("Options",s)}createBackground(){const t=this.cameras.main.width,e=this.cameras.main.height;if(this.add.shader("distortion",t/2,e/2,t,e,["background"]),!this.textures.exists("gradient")){const s=this.textures.createCanvas("gradient",800,e);if(s){const i=s.getContext(),o=i.createLinearGradient(0,0,800,0);o.addColorStop(.3,"black"),o.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=o,i.fillRect(0,0,t,e),s.refresh()}}this.add.image(0,0,"gradient").setOrigin(0);const s=this.add.graphics();s.fillStyle(1447446,1),s.lineStyle(4,4473924,.6),s.lineBetween(50,0,50,this.cameras.main.height)}makeMenuBtns(){const t=this.cache.json.get("config").mainMenu.buttonsBlock,e=this.add.container(t.x,t.y),s=100+t.gap,i=this.createButton(0,0,"Select Level","LevelSelector").container,o=this.createButton(0,s,"Create Level","LevelEditor").container,n=this.createButton(0,2*s,"Options","Options").container,a=this.createButton(0,this.cameras.main.height-300,"Open Docs (GitHub)","Git");a.btn.on("pointerdown",(()=>{window.open("https://github.com/XirTelan/overflowing_palette","GitHubProject")})),a.text.setFontSize(24),e.add([i,o,n,a.container])}createButton(t,e,s,i){return new w(this,t,e,s,(()=>{M.forEach((t=>{const e=this.tabs.get(t);e&&(i!=t||e.container.visible?e.hide():e.show())}))}))}}class V extends Phaser.Scene{constructor(){super("LoadingGame")}create(t){this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"Loading...",{fontSize:"32px",color:"#fff"}).setOrigin(.5),this.time.delayedCall(100,(()=>{this.scene.start("Game",t)}))}}const j={type:s.AUTO,width:1920,height:1080,parent:"game-container",backgroundColor:"#121212",dom:{createContainer:!0},scale:{mode:s.Scale.FIT,autoCenter:s.Scale.CENTER_BOTH},scene:[S,N,V,y]},U=new Phaser.Game(j);document.addEventListener("DOMContentLoaded",(()=>{U.scene.start("Boot")}));
