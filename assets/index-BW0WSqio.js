var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{P as s,p as i}from"./phaser-hyM8z1KO.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var n=(t=>(t[t.red=0]="red",t[t.green=1]="green",t[t.blue=2]="blue",t[t.yellow=3]="yellow",t[t.orange=4]="orange",t[t.purple=5]="purple",t[t.pink=6]="pink",t[t.cyan=7]="cyan",t))(n||{}),a=(t=>(t[t.none=0]="none",t[t.All=1]="All",t[t.Horizontal=2]="Horizontal",t[t.Vertical=3]="Vertical",t))(a||{}),o=(t=>(t[t.Waiting=0]="Waiting",t[t.Active=1]="Active",t))(o||{}),r=(t=>(t[t.Play=0]="Play",t[t.Editor=1]="Editor",t[t.Endless=2]="Endless",t))(r||{});class l{constructor(t,s,i,n,a=0){e(this,"tile"),e(this,"transitionTile"),e(this,"color"),e(this,"colors"),e(this,"grid"),e(this,"pos"),this.color=n,this.grid=t;const{cellSize:o,scene:r}=t,{colors:l}=r.cache.json.get("config");this.colors=l,this.tile=r.add.shader("base",i*(o+a),s*(o+a),o,o,["celltexture","cellnoise","cellnoise_d","cellnoise_center"]).setOrigin(0,0),this.tile.setUniform("color.value",l[n].value),this.tile.setInteractive(),this.tile.on("pointerdown",this.onClick,this),this.tile.on("pointerover",this.onEnter,this),this.tile.on("pointerout",this.onLeave,this),this.pos={x:s,y:i};const c=r.add.shader("base",this.tile.x+o/2,this.tile.y+o/2,o,o);c.setUniform("color.value",{x:.949,y:.953,z:.827}),c.setUniform("active.value",1),c.setUniform("transparent.value",1),c.setVisible(!1),this.transitionTile=c}onEnter(){this.tile.setUniform("active.value",1)}onLeave(){this.tile.setUniform("active.value",0)}onClick(){this.grid.cellAction(this.pos.x,this.pos.y,this.color)}setColor(t){this.color=t,this.tile.setUniform("color.value",this.colors[t].value)}}const c=t=>s.Display.Color.GetColor(255*t.x,255*t.y,255*t.z);function h(t,e){const s=Object.keys(n).length/2;return((e+t)%s+s)%s}function d(t,e){const s=e[t].colorName;return`${s[0].toUpperCase()}${s.slice(1)}`}const u=t=>{const e=t.cache.json.get("localization"),s=localStorage.getItem("lang")??"en";return e.langs[s]},p=()=>{const t=localStorage.getItem("levels.cleared");return t?new Map(JSON.parse(t)):new Map};function g(t,e,s,i,n){return(t-e)*(n-i)/(s-e)+i}const m=[[1,0],[-1,0],[0,1],[0,-1]],v={Easy:.7,Medium:.5,Hard:.3,Mess:.1},f={color:{type:"3f",value:{x:1,y:1,z:1}},colorToTransform:{type:"3f",value:{x:1,y:1,z:1}},textureResolution:{type:"2f",value:{x:512,y:512}},isSimple:{type:"1f",value:0},transition:{type:"1f",value:0},active:{type:"1f",value:0}},y={1:{textureKey:"swapAll",text:"All way swap",hotkey:"Q",props:{}},2:{textureKey:"swapLine",hotkey:"W",text:"Vertical swap",props:{rotation:1.5708}},3:{textureKey:"swapLine",text:"Horizontal swap",hotkey:"E",props:{}}};function b(t,e,s,i){let n=Array.from({length:t},(()=>Array(e).fill(null))),a=v[i],o=[];for(let d=0;d<t;d++)for(let t=0;t<e;t++)o.push([d,t]);Phaser.Utils.Array.Shuffle(o);let r=o.slice(0,s);r.forEach((([t,e],s)=>{n[t][e]=s}));let l=[...r];const c=new Map,h=e*t;for(;l.length>0;){const[s,i]=l.pop();let o=n[s][i];const r=c.get(o)??0;m.forEach((([d,u])=>{const p=s+d,g=i+u;var m,v;v=g,(m=p)>=0&&m<t&&v>=0&&v<e&&r<h/2&&null===n[p][g]&&Math.random()<a&&(n[p][g]=o,c.set(o,(c.get(o)||0)+1),l.push([p,g]))}))}for(let d=0;d<t;d++)for(let t=0;t<e;t++)null===n[d][t]&&(n[d][t]=Math.floor(Math.random()*s));return n}function x(t,e,s,i){return{board:b(t,e,s,i),targetColor:Math.floor(Math.random()*s),turns:0}}class C{constructor(t,s,i,n){var r;e(this,"scene"),e(this,"grid"),e(this,"keyObj"),e(this,"activeCells"),e(this,"originPos"),e(this,"cell"),e(this,"activeTween"),this.scene=t,this.grid=s,this.scene.setGameState(o.Waiting);const l=this.scene.gameStates.selectedTool;this.cell=s.board[i][n];const{tile:c,color:h}=this.cell;this.originPos=[c.x,c.y];let d=m;switch(l){case a.Horizontal:d=[m[0],m[1]];break;case a.Vertical:d=[m[2],m[3]]}this.activeCells=[],d.forEach((t=>{const[e,a]=[i+t[0],n+t[1]],o=this.grid.board.length-1,r=this.grid.board[0].length-1;e<0||a<0||e>o||a>r||s.board[e][a].color!==h&&this.activeCells.push(this.createSwapPos(e,a))})),0!==this.activeCells.length?(this.activeTween=this.scene.tweens.add({targets:c,x:{value:()=>c.x+Phaser.Math.Between(-3,3),duration:150},y:{value:()=>c.y+Phaser.Math.Between(-3,3),duration:150},yoyo:!0,repeat:-1}),this.keyObj=null==(r=this.scene.input.keyboard)?void 0:r.addKey("ESC"),this.keyObj&&this.keyObj.on("down",(()=>{this.cancelSwapSelection()}))):this.scene.setGameState(o.Active)}cancelSwapSelection(){var t,e;this.scene.changeSelectedTool(a.none),this.activeCells.forEach((t=>t.destroy())),null==(t=this.keyObj)||t.destroy(),this.scene.setGameState(o.Active),null==(e=this.activeTween)||e.destroy(),this.cell.tile.setPosition(this.originPos[0],this.originPos[1]),this.grid.removeSwapSelection()}createSwapPos(t,e){const s=this.grid.board[t][e].tile.getWorldPoint(),i=this.scene.add.shader("base",s.x+this.grid.cellSize/2,s.y+this.grid.cellSize/2,this.grid.cellSize,this.grid.cellSize).setScale(1.2);return i.setUniform("color.value",{x:.949,y:.953,z:.827}),i.setUniform("active.value",1),i.setUniform("transparent.value",1),i.setInteractive(),i.on("pointerdown",(()=>{this.applySwap(t,e)})),i}applySwap(t,e){const s=this.grid.board[t][e],[i,n]=[s.tile.x-this.cell.tile.x,s.tile.y-this.cell.tile.y],a=this.scene.gameStates.selectedTool;this.cancelSwapSelection(),this.scene.time.delayedCall(150,(()=>{const t=s.color;s.setColor(this.cell.color),this.cell.setColor(t),this.scene.useTool(a)})),this.scene.tweens.add({targets:s.tile,x:"-="+i/2,y:"-="+n/2,yoyo:!0,duration:150}),this.scene.tweens.add({targets:this.cell.tile,x:"+="+i/2,y:"+="+n/2,yoyo:!0,duration:150})}}class S{constructor(t,s){var i;e(this,"scene"),e(this,"container"),e(this,"activeSwap"),e(this,"transitionSpeed",800),e(this,"transitionSpeedMinimum",50),e(this,"pendingCalls",0),e(this,"board",[]),e(this,"cellSize"),e(this,"defaultValues"),e(this,"history"),e(this,"border"),this.scene=t,this.defaultValues=s;const n=s.length,a=s[0].length,o=[],{game:{gridOptions:r},gameplay:c}=t.cache.json.get("config");this.transitionSpeed=c.transitionDefault,this.transitionSpeedMinimum=c.transitionMinimum;const h=Math.min((r.height-r.gap*(n-1))/n,(r.width-r.gap*(a-1))/a);this.cellSize=h;const d=r.width-r.borderPadding-a*(h+r.gap),u=r.height-r.borderPadding-n*(h+r.gap);this.border=t.add.nineslice(r.borderOffset.left,r.borderOffset.top,"grid_border",void 0,r.width-r.borderOffset.right-d,r.height-r.borderOffset.bottom-u,270,128,r.height/2.56,r.height/3).setOrigin(0,0).setTint(this.getColor());for(let e=0;e<n;e++)for(let t=0;t<a;t++){this.scene.gameStates.availableColors.add(s[e][t]);const n=new l(this,e,t,s[e][t],r.gap);o.push(n.tile),o.push(n.transitionTile),(i=this.board)[e]??(i[e]=[]),this.board[e][t]=n,s[e][t]!==this.scene.gameStates.targetColor&&(this.scene.gameStates.remains++,this.scene.gameStates.initialState.remains++)}this.container=this.scene.add.container(this.scene.cameras.main.width/2-r.width/2-r.offset.x,r.offset.y,[this.border,...o])}bfs(t,e,s,i,n,a,r){if(!this.board[t]||!this.board[t][e]||this.board[t][e].color==i||this.board[t][e].color!=s||n.has(this.board[t][e]))return;const{colors:l}=this.scene.cache.json.get("config");this.pendingCalls++;const c=this.board[t][e],h=this.board[t][e].tile;n.add(c);const d=c.transitionTile,u=this.transitionSpeedMinimum,p=Math.max(this.transitionSpeed*Math.pow(.8,a),u);this.scene.tweens.chain({targets:null,tweens:[{targets:h,x:{value:()=>h.x+Phaser.Math.Between(-5,5),duration:.1*p,repeat:1},y:{value:()=>h.y+Phaser.Math.Between(-5,5),duration:.1*p,repeat:1},onComplete:()=>{d.setVisible(!0).setDepth(10)},repeat:0,yoyo:!0,ease:"Sine.easeInOut"},{targets:d,alpha:.8,duration:p/2-10,repeat:0,scale:1.2,ease:"Linear"},{targets:d,alpha:0,scale:1.4,duration:p/2-10,repeat:0,ease:"Linear"}],onComplete:()=>{d.setVisible(!1),d.scale=1},delay:0,loop:0}),this.scene.tweens.addCounter({from:0,to:1,delay:.1*p,duration:p,ease:"Cubic.InOut",repeat:0,onStart:()=>{this.scene.sound.play("tileFlip",{detune:Math.min(50*a,600),volume:a?Math.min(.4,1-.9+.1*a):1}),this.board[t][e].tile.setUniform("colorToTransform.value",l[i].value),this.board[t][e].tile.setUniform("curPoint.value",{x:t,y:e}),this.board[t][e].tile.setUniform("startPoint.value",r)},onUpdate:s=>{this.board[t][e].tile.setUniform("transition.value",s.getValue())},onComplete:()=>{this.board[t][e].tile.scale=1,this.board[t][e].tile.depth=1,this.board[t][e].tile.setUniform("transition.value",0),this.board[t][e].tile.setUniform("color.value",l[i].value),this.board[t][e].color===this.scene.gameStates.targetColor&&this.scene.gameStates.remains++,this.board[t][e].color=Number(i),this.board[t][e].color===this.scene.gameStates.targetColor&&(this.scene.gameStates.remains-=1),this.pendingCalls--,0===this.pendingCalls&&this.scene.changeGameState(o.Active)}});for(const[o,g]of m)this.scene.time.delayedCall(p,(()=>{this.bfs(t+o,e+g,s,i,n,a+1,r)}))}flip(t,e,s){s!=this.scene.gameStates.selectedColor&&(this.scene.changeGameState(o.Waiting),this.bfs(t,e,s,this.scene.gameStates.selectedColor,new Set,0,{x:t,y:e}))}cellAction(t,e,s){const{mode:i,state:n,selectedTool:l}=this.scene.gameStates;i!=r.Editor?(n===o.Waiting&&this.activeSwap&&(this.activeSwap.cancelSwapSelection(),this.activeSwap=void 0),n!==o.Waiting&&(l===a.none?this.flip(t,e,s):this.swapSelection(t,e))):this.changeColor(t,e)}swapSelection(t,e){this.activeSwap=new C(this.scene,this,t,e)}removeSwapSelection(){this.activeSwap=void 0}changeColor(t,e){const{colors:s}=this.scene.cache.json.get("config");this.board[t][e].tile.setUniform("color.value",s[this.scene.gameStates.selectedColor].value),this.board[t][e].color=Number(this.scene.gameStates.selectedColor)}getColor(){const{colors:t}=this.scene.cache.json.get("config"),{x:e,y:s,z:i}=t[this.scene.gameStates.targetColor].value;return Phaser.Display.Color.GetColor(255*e,255*s,255*i)}updateBorderTint(){this.border.clearTint(),this.border.setTint(this.getColor())}resetBoard(){const t=this.defaultValues,e=t.length,s=t[0].length;for(let i=0;i<e;i++)for(let e=0;e<s;e++)this.board[i][e].setColor(t[i][e])}}const w={1:"NUMPAD_ONE,ONE",2:"NUMPAD_TWO,TWO",3:"NUMPAD_THREE,THREE",4:"NUMPAD_FOUR,FOUR",5:"NUMPAD_FIVE,FIVE",6:"NUMPAD_SIX,SIX",7:"NUMPAD_SEVEN,SEVEN",8:"NUMPAD_EIGHT,EIGHT",9:"NUMPAD_NINE,NINE"};class k{constructor(t,s,i,n,a,o,r){var l;e(this,"scene"),e(this,"gameObject"),e(this,"color"),e(this,"active"),e(this,"pointer"),this.scene=t;const c=this.scene.add.circle(s,i,n/2+5,16053492).setVisible(!1);this.active=c;const h=this.scene.add.triangle(n/2+20,10,s-5,i,s+10,i+10,s+10,i-10,16777215),d=this.scene.add.shader("base",s,i,n,n),u=this.scene.make.image({x:s,y:i+n/2,key:"uiatlas",frame:"hotkey_btn",scale:.25}),p=this.scene.make.text({x:s,y:u.y,text:`${o}`,style:{color:"#3e3e3e",font:"20px OpenSans_Bold"}}).setOrigin(.5,.5);r&&(r.add(c),r.add(d),r.add(u),r.add(p),r.add(h)),d.setUniform("color.value",a[1]),d.setUniform("radius.value",.5),d.setChannel0("celltexture"),d.setInteractive(),d.on("pointerdown",this.onClick,this),d.on("pointerover",this.onEnter,this),d.on("pointerout",this.onLeave,this);const g=null==(l=this.scene.input.keyboard)?void 0:l.addKeys(w[o]);if(g)for(const e of Object.keys(g))g[e].on("down",this.onClick,this);this.scene.tweens.add({targets:h,duration:1e3,x:"+=10",yoyo:!0,repeat:-1}),this.color=a,this.gameObject=d,this.pointer=h,this.update()}onEnter(){this.scene.sound.play("mouseOver"),this.active.setVisible(!0)}onLeave(){Number(this.scene.gameStates.selectedColor)!=Number(this.color[0])&&this.active.setVisible(!1)}update(){Number(this.scene.gameStates.selectedColor)===Number(this.color[0])?(this.active.setVisible(!0),this.pointer.setVisible(!0)):(this.active.setVisible(!1),this.pointer.setVisible(!1))}onClick(){this.scene.changeSelectedColor(this.color[0]),this.scene.sound.play("colorSelect")}}let B=class{constructor(t,s,i,n,a,o,r){e(this,"scene"),e(this,"leftButton"),e(this,"rightButton"),e(this,"container"),e(this,"text"),e(this,"value"),this.scene=t,this.container=t.add.container(s,i),this.value=a,this.leftButton=this.createButton(o,{x:-n/2,y:0,scale:.3,angle:180}),this.rightButton=this.createButton(r,{x:n/2,y:0,scale:.3,angle:0}),this.text=t.make.text({x:0,y:0,text:String(this.value),style:{color:"#ffffff",font:"20px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([t.add.rectangle(0,0,n,50,1710876,.6),t.add.circle(-n/2,0,25,1710876,.6),t.add.circle(n/2,0,25,1710876,.6),this.leftButton,this.text,this.rightButton])}createButton(t,e){const s=this.scene.add.container(e.x,0),i=this.scene.add.image(0,0,"uiatlas","arrow").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale),n=this.scene.add.image(0,0,"uiatlas","arrow_over").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale);return n.setVisible(!1),i.setInteractive(),i.on("pointerdown",(()=>{this.text.setText(String(t()))})),i.on("pointerover",(()=>{n.setScale(.35),n.setVisible(!0)})),i.on("pointerout",(()=>{n.setScale(.3),n.setVisible(!1)})),s.add([i,n]),s}};class E{constructor(t){e(this,"container"),e(this,"content");const s=document.createElement("section");s.classList.add("option-folder");const i=document.createElement("h2");i.classList.add("option-folder__title"),i.textContent=t;const n=document.createElement("div");n.classList.add("option-folder__content"),this.content=n,s.appendChild(i),s.appendChild(n),this.container=s}add(t){const e=document.createElement("div");e.classList.add("folder-content__item"),e.appendChild(t),this.content.appendChild(e)}}class L{constructor(t,s,i){e(this,"container"),e(this,"radios",[]);const n=document.createElement("div");n.className="switch-container";const a=this.createOption(t.text,t.value,i),o=this.createOption(s.text,s.value,i);this.radios.push(a.radio,o.radio),this.radios[0].checked=!0,n.appendChild(a.label),n.appendChild(o.label),this.container=n}createOption(t,e,s){const i=document.createElement("label");i.className="switch__option";const n=document.createElement("input");return n.setAttribute("type","radio"),n.setAttribute("name","radio-export"),n.setAttribute("value",e),n.checked=!1,i.textContent=t,i.prepend(n),n.addEventListener("change",(function(){this.checked&&s(this.value)})),{label:i,radio:n}}}class T{constructor(t){e(this,"viewBox"),e(this,"scene"),e(this,"container"),e(this,"share"),e(this,"stringInput"),e(this,"jsonInput"),e(this,"folderString"),e(this,"folderJson"),e(this,"selectedType","string"),this.scene=t,this.container=t.add.container(0,0);const{width:s,height:i}=t.cameras.main,{exportBlock:n}=u(t),a=t.add.rectangle(0,0,s,i,0,.6).setOrigin(0);this.viewBox=t.add.dom(t.cameras.main.width/2-8,0,"div",{width:"1000px",height:`${i}px`,fontSize:"24px",overflow:"auto"}).setOrigin(.5,0);const o=document.createElement("div");o.classList.add("wrapper","export-wrapper"),this.viewBox.node.appendChild(o),this.folderString=new E(n.folders.string),this.folderJson=new E(n.folders.json);const r=document.createElement("textarea");r.classList.add("export__base"),r.disabled=!0,this.folderString.add(r),this.stringInput=r;const l=document.createElement("pre");l.classList.add("export__json"),this.jsonInput=l,this.folderJson.add(l);const c=document.createElement("div");Object.assign(c.style,{display:"flex",justifyContent:"center",gap:"1rem",marginTop:"1rem"});const h=document.createElement("button");h.classList.add("primary-btn"),h.addEventListener("click",(()=>{this.hide()})),h.textContent=n.cancelBtn;const d=document.createElement("button");d.classList.add("primary-btn"),d.addEventListener("click",(()=>{this.copyToClipboard()})),d.textContent=n.copy,c.appendChild(h),c.appendChild(d);const p=new L({text:n.switch.string,value:"string"},{text:n.switch.json,value:"json"},(t=>{this.toggleFolders(t)})),g=document.createElement("div");g.textContent=n.title,g.className="block-title",o.appendChild(g),o.appendChild(p.container),o.appendChild(this.folderString.container),o.appendChild(this.folderJson.container),o.appendChild(c),this.container.add([a,this.viewBox]),this.viewBox.depth=10,this.update(),this.toggleFolders(this.selectedType),this.hide()}toggleFolders(t){"string"===t?(this.folderString.container.style.display="block",this.folderJson.container.style.display="none"):(this.folderString.container.style.display="none",this.folderJson.container.style.display="block"),this.selectedType=t}copyToClipboard(){navigator.clipboard.writeText("string"===this.selectedType?this.share.base64:this.share.json),this.hide()}createShareData(){const t=this.scene.gameStates.mode===r.Endless?this.scene.grid.defaultValues:this.scene.grid.board.map((t=>t.map((t=>t.color)))),e={targetColor:this.scene.gameStates.targetColor,turns:this.scene.gameStates.turns,tools:this.scene.gameStates.availableTools,board:t};this.share={json:JSON.stringify(e,null,"\t"),base64:btoa(JSON.stringify(e,null))}}update(){this.createShareData(),this.stringInput.textContent=this.share.base64,this.jsonInput.textContent=this.share.json}show(){this.scene.input.enabled=!1,this.scene.setGameState(o.Waiting),this.update(),this.container.setVisible(!0)}hide(){this.scene.input.enabled=!0,this.scene.setGameState(o.Active),this.container.setVisible(!1)}}class O{constructor(t,s){e(this,"scene"),e(this,"graphics"),e(this,"selectionBox"),e(this,"selectedObjects",[]),e(this,"isSelecting",!1),e(this,"startX"),e(this,"startY"),e(this,"objectList"),this.scene=s;const{selectionBox:i}=s.cache.json.get("config").game;this.graphics=s.add.graphics(i),this.objectList=t.flat(),s.input.on("pointerdown",this.onPointerDown,this),s.input.on("pointermove",this.onPointerMove,this),s.input.on("pointerup",this.onPointerUp,this)}onPointerDown(t){this.isSelecting=!0,this.startX=t.x,this.startY=t.y,this.selectionBox=new Phaser.Geom.Rectangle(this.startX,this.startY,0,0)}onPointerMove(t){this.isSelecting&&(this.selectionBox.width=t.x-this.startX,this.selectionBox.height=t.y-this.startY,this.redrawSelectionBox())}onPointerUp(){this.isSelecting=!1,this.graphics.clear(),this.selectedObjects=[];const t=this.selectionBox;if(!t)return;t.x=Math.min(t.x,t.x+t.width),t.width=Math.abs(t.width),t.y=Math.min(t.y,t.y+t.height),t.height=Math.abs(t.height);const e=this.scene.grid.cellSize/2;this.objectList.forEach((s=>{const{x:i,y:n}=s.tile.getWorldPoint();i+e>t.x&&i+e<t.x+t.width&&n+e>t.y&&n+e<t.y+t.height&&s.onClick()}))}redrawSelectionBox(){this.graphics.clear().fillRectShape(this.selectionBox)}}class _{constructor(t,s,i){e(this,"scene"),e(this,"container"),this.scene=i,this.container=i.add.container(t,s)}hide(){this.container.setVisible(!1)}show(){this.container.setVisible(!0)}}class I extends _{constructor(t,s,i,n,a,o,r,l){super(t,s,o),e(this,"btn"),e(this,"text"),e(this,"overlay"),this.btn=o.add.nineslice(0,0,"uiatlas","primary",n,a,0,55).setOrigin(.5,.5).setScale(.7),this.overlay=o.add.nineslice(0,0,"uiatlas","primary_over",n,a,0,0).setOrigin(.5,.5).setScale(.7),this.overlay.setVisible(!1),this.btn.setInteractive(),r&&this.btn.on("pointerdown",r,l),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),this.text=o.make.text({x:this.btn.x,y:this.btn.y,text:i,style:{color:"#000000",font:"24px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([this.btn,this.overlay,this.text])}onEnter(){this.scene.input.setDefaultCursor("pointer"),this.overlay.setVisible(!0)}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default")}}class M{constructor(t,s,i,n,a){e(this,"container"),e(this,"value");const o=document.createElement("div");o.classList.add(i);const r=document.createElement("label");r.classList.add(n),r.textContent=t;const l=document.createElement("p");l.classList.add(a),l.textContent=s,o.appendChild(r),o.appendChild(l),this.value=l,this.container=o}}class P extends _{constructor(t){t.cameras.main.postFX.addBlur(1);const{width:s,height:i}=t.cameras.main;super(s/2-s/2,i/2-i/2,t),e(this,"scene"),e(this,"nextLevelData"),e(this,"local"),this.scene=t,t.gameStates.state=o.Waiting;const{resultScreen:n}=u(t);this.local=n;const a=this.scene.gameStates.levelKey,l=new Date(t.time.now-t.startTime).toISOString().slice(11,19);this.saveRecordAboutLevel(a,l);const c=t.add.dom(0,0,"div",{width:`${s}px`,height:`${i}px`}).setOrigin(0);c.depth=2;const h=this.createResultContent(c.node,l),d=this.createButtonsBlock(h);let p;if(p=this.scene.gameStates.mode===r.Endless?this.generateNextLevel():this.findNextLevel(),p){const t=document.createElement("button");t.classList.add("primary-btn"),t.addEventListener("click",(()=>{this.scene.scene.start("LoadingGame",this.nextLevelData)})),t.textContent=n.btnNext,d.append(t)}t.input.enabled=!1,t.setGameState(o.Waiting)}generateNextLevel(){if(!this.scene.gameStates.endlessOptions)return!1;const{rows:t,columns:e,colorsCount:s,difficulty:i}=this.scene.gameStates.endlessOptions;return this.nextLevelData={mode:r.Endless,levelData:x(t,e,s,i),endlessOptions:this.scene.gameStates.endlessOptions},!0}createResultContent(t,e){const s=document.createElement("div");s.classList.add("wrapper","results-screen__wrapper");const i=document.createElement("div");i.classList.add("result-screen"),s.appendChild(i);const n=document.createElement("div");n.classList.add("result-screen__cleared"),n.textContent=this.local.win;const a=document.createElement("div");a.classList.add("cleared-bg"),n.append(a),i.appendChild(n);const o=document.createElement("div");o.classList.add("results"),i.appendChild(o);const l=this.addRecord(this.local.time,e);if(o.appendChild(l),this.scene.gameStates.mode===r.Endless){const t=this.addRecord(this.local.movesUsed,String(this.scene.gameStates.turns));o.appendChild(t)}return t.appendChild(s),s}createButtonsBlock(t){const e=document.createElement("div");e.classList.add("results_buttons");const s=this.createPrimiryBtn(this.local.btnMain,(()=>{this.scene.scene.start("MainMenu")}));if(e.append(s),this.scene.gameStates.mode===r.Endless){const t=this.createShareButton();e.append(t)}return t.appendChild(e),e}createPrimiryBtn(t,e){const s=document.createElement("button");return s.classList.add("primary-btn"),s.textContent=t,s.addEventListener("click",(()=>{e()})),s}createShareButton(){return this.createPrimiryBtn(this.local.btnShare,(()=>{this.scene.exportBlock.show()}))}saveRecordAboutLevel(t,e){if(!t)return;const s=p();s.set(t,{time:e}),localStorage.setItem("levels.cleared",JSON.stringify(Array.from(s)))}addRecord(t,e){return new M(t,e,"results__item","results__label","results__value").container}createNextLevelBtn(t,e){this.container.add(new I(t,e,this.local.btnNext,300,50,this.scene,(()=>{this.scene.scene.start("LoadingGame",this.nextLevelData),this.scene.cameras.main.postFX.clear()})).container)}findNextLevel(){const t=this.scene.gameStates.levelKey;if(!t)return!1;const[e,s,i]=t.split(".");if(!e||!s||!i)return!1;const n=this.scene.cache.json.get("levels"),a=n.findIndex((t=>t.folderName===e)),o=n[a],l=o.categories.findIndex((t=>t.categoryName===s)),c=o.categories[l].levels.length;let h=a,d=l,u=Number(i)-1;if(u<c-1?u++:(u=0,d++),o.categories[d]||(d=0,h++),!n[h])return!1;const p=n[h],g=p.categories[d],m=`${p.folderName}.${p.categories[d].categoryName}.${u+1}`;return this.nextLevelData={mode:r.Play,levelKey:m,levelData:g.levels[u]},!0}}class V{constructor(t){const e=t.cameras.main.width,s=t.cameras.main.height,{current:i}=t.cache.json.get("config").background,n=t.add.shader("distortion",e/2,s/2,e,s,[i.key]);i&&(n.setUniform("radius.value",i.distortion?.3:0),n.setUniform("darkOverlay.value",i.overlay?.7:0))}}class N{constructor(t,s,i,n,a,o){var r;e(this,"scene"),e(this,"container"),e(this,"btnOverlay"),e(this,"icon"),e(this,"initialCount"),e(this,"currentCount"),e(this,"currentCountText"),e(this,"isSelected",!1),e(this,"toolKey"),this.scene=t,this.toolKey=o,this.initialCount=n,this.currentCount=n,this.container=t.add.container(s,i);const l=t.add.image(0,0,"btnRound").setScale(.8),c=t.add.image(0,0,"btnRoundOver").setScale(.8);c.setVisible(!1),this.btnOverlay=c;const h=t.make.image({key:"uiatlas",frame:"hotkey_btn",scale:.3,y:l.y+50}),{textureKey:d,props:u}=y[o];this.icon=t.make.image({rotation:0,key:d,...u}).setScale(.6).setAlpha(.8);const p=t.make.text({text:a,style:{color:"#3e3e3e",font:"24px OpenSans_Bold"},x:h.x,y:h.y}).setOrigin(.5);this.currentCountText=t.make.text({x:0,y:-65,text:`Uses: ${this.currentCount}`,style:{font:"24px OpenSans_ExtraBold"}}).setOrigin(.5);const g=null==(r=t.input.keyboard)?void 0:r.addKey(a);g&&g.on("down",this.onClick,this),l.setInteractive(),l.on("pointerdown",this.onClick,this),l.on("pointerover",(()=>{0!=this.currentCount&&c.setVisible(!0)})),l.on("pointerout",(()=>{this.isSelected||c.setVisible(!1)})),this.container.add([l,c,this.icon,this.currentCountText,h,p])}onClick(){if(this.scene.grid.activeSwap)return this.scene.grid.activeSwap.cancelSwapSelection(),void this.scene.changeSelectedTool(a.none);0!==this.currentCount&&(this.isSelected?this.deselect():this.select())}select(){this.scene.sound.play("colorSelect"),this.scene.changeSelectedTool(this.toolKey),this.isSelected=!0,this.icon.setTintFill(16764223),this.btnOverlay.setVisible(!0)}deselect(){this.scene.sound.play("colorSelect",{detune:100}),this.scene.changeSelectedTool(a.none),this.isSelected=!1,this.icon.clearTint(),this.btnOverlay.setVisible(!1)}update(){this.scene.gameStates.selectedTool===this.toolKey?(this.isSelected=!0,this.btnOverlay.setVisible(!0)):(this.isSelected=!1,this.icon.clearTint(),this.btnOverlay.setVisible(!1)),this.currentCountText.setText(`Uses: ${this.currentCount}`)}reset(){this.currentCount=this.initialCount,this.update()}decrease(){this.currentCount--,this.update()}}class U extends i.Scene{constructor(){super("Game"),e(this,"grid"),e(this,"colorSelectionButtons"),e(this,"toolsButtons",[]),e(this,"btnContainer"),e(this,"gameStates"),e(this,"turnCounter"),e(this,"selectionBox"),e(this,"notification"),e(this,"startTime"),e(this,"colors"),e(this,"exportBlock")}preload(){}create({mode:t,levelKey:e,levelData:s,endlessOptions:i}){const{colors:l,gameplay:c}=this.cache.json.get("config");this.colors=l,new V(this),function(t,e,s,i){const r={levelKey:i,turns:s.turns,targetColor:s.targetColor,availableTools:s.tools??[0,0,0],selectedColor:n.red,availableColors:new Set,state:o.Active,remains:0,mode:e,initialState:{turns:s.turns,remains:0},selectedTool:a.none};t.gameStates=r,t.grid=new S(t,s.board),t.colorSelectionButtons=[],t.btnContainer=t.add.container(1500,400,[])}(this,t,s,e??""),t===r.Editor&&(this.selectionBox=new O(this.grid.board,this)),t==r.Endless&&(this.gameStates.endlessOptions=i,new I(1250,990,"Skip Level",350,50,this,(()=>{this.scene.start("LoadingGame",{mode:t,levelKey:e,levelData:x(i.rows,i.columns,i.colorsCount,i.difficulty),endlessOptions:i})}))),this.initTextUI(this),this.initButtons(),this.sound.setVolume((c.sound??50)/100),this.exportBlock=new T(this),this.startTime=this.time.now,this.cameras.main.fadeIn(500,0,0,0)}changeGameState(t){const e=this.gameStates.mode===r.Endless;if(t===o.Waiting)return this.gameStates.turns=e?this.gameStates.turns+1:this.gameStates.turns-1,this.turnCounter.text=String(this.gameStates.turns),void(this.gameStates.state=o.Waiting);if(t===o.Active){if(0===this.gameStates.remains)return this.gameStates.state=o.Waiting,void new P(this);e||0!==this.gameStates.turns||this.resetGame(),this.gameStates.state=o.Active}}setGameState(t){this.gameStates.state=t}changeSelectedColor(t){this.gameStates.selectedColor=t,this.colorSelectionButtons.forEach((t=>t.update()))}initButtons(){this.gameStates.mode!=r.Editor&&this.gameStates.availableTools&&this.createToolsButtons(),this.createColorSelectionButtons(),function(t){var e;const{resetBtn:s}=t.cache.json.get("config").game.ui,i=u(t),n=t.add.image(t.btnContainer.x,t.cameras.main.height-140,"uiatlas","reset").setScale(.8),a=t.add.image(t.btnContainer.x,t.cameras.main.height-140,"uiatlas","reset_over").setScale(.8);a.setVisible(!1);const r=t.make.image({...s.hotkeyBtn,x:n.x-30,y:n.y+80});t.make.text({...s.hotkeyText,text:"R",x:r.x,y:r.y}),t.make.text({...s.text,text:i.game.ui.resetBtn,x:r.x+60,y:r.y});const l=null==(e=t.input.keyboard)?void 0:e.addKey("R");l&&l.on("down",t.resetGame,t),n.setInteractive(),n.on("pointerdown",(()=>{t.gameStates.state!==o.Waiting&&t.resetGame()})),n.on("pointerover",(()=>{a.setVisible(!0)})),n.on("pointerout",(()=>{a.setVisible(!1)}))}(this),function(t){const{game:{ui:e}}=t.cache.json.get("config"),s=t.add.image(t.cameras.main.width-e.closeBtn.offset.x,0+e.closeBtn.offset.y,"uiatlas","close").setScale(e.closeBtn.scale);s.setInteractive(),s.on("pointerdown",(()=>{t.cameras.main.fadeOut(500,0,0,0),t.time.delayedCall(500,(()=>{t.scene.start("MainMenu")}))})),s.on("pointerover",(()=>{s.setScale(e.closeBtn.scale+.1)})),s.on("pointerout",(()=>{s.setScale(e.closeBtn.scale)}))}(this)}createColorSelectionButtons(){const t=this,{game:{ui:e},colors:s}=t.cache.json.get("config"),i=e.colorButtons.size,n=t.gameStates.mode===r.Editor;t.gameStates.availableColors.add(t.gameStates.targetColor);const a=n?8:t.gameStates.availableColors.size;Object.entries(s).filter((([e])=>n||t.gameStates.availableColors.has(Number(e)))).forEach((([s,n],o)=>{const r=Number(s),l=a>4&&o>=4?i+2*e.colorButtons.gap:0,c=(o+4)%4*(i+e.colorButtons.gap),h=new k(t,l,c,i,[r,n.value],o+1,t.btnContainer);t.colorSelectionButtons.push(h)})),t.btnContainer.y-=t.colorSelectionButtons.length*i/4}createToolsButtons(){var t;let e=0;null==(t=this.gameStates.availableTools)||t.forEach(((t,s)=>{0!=t&&(this.toolsButtons.push(new N(this,150,600+160*e,t,y[s+1].hotkey,s+1)),e++)}))}changeSelectedTool(t){var e;if(this.gameStates.selectedTool!==t){if(null==(e=this.notification)||e.destroy(),t!==a.none){const{width:t}=this.cameras.main,e=this.add.container(t/2,100);this.notification=e,this.notification.add(this.add.rectangle(0,0,300,60,0,.4)),this.notification.add(this.add.text(0,0,"Swap tool  is Selected ",{font:"24px OpenSans_Bold"}).setOrigin(.5))}this.gameStates.selectedTool=t,this.toolsButtons.forEach((t=>t.update()))}}useTool(t){var e;null==(e=this.toolsButtons.find((e=>e.toolKey===t)))||e.decrease()}resetGame(){this.sound.play("reset"),this.grid.resetBoard();const{initialState:t}=this.gameStates;this.gameStates.mode!==r.Editor&&(this.gameStates.turns=t.turns,this.gameStates.remains=t.remains,this.turnCounter.text=String(this.gameStates.turns),this.gameStates.state=o.Active,this.toolsButtons.forEach((t=>t.reset())))}initTextUI(t){const{game:{ui:e}}=t.cache.json.get("config"),s=u(t);t.gameStates.mode==r.Editor?this.loadEditorUI(t,e):this.loadPlayUI(t,e),this.time.delayedCall(50,(()=>{this.createTitle(t,s.game.ui.mode)})),this.createTriangles(t,e)}loadEditorUI(t,e){const s=u(t);t.make.text({x:60,y:110,text:s.game.ui.movesCount,style:{color:"#fff",font:"22px OpenSans_Regular"}}),t.make.text({x:60,y:200,text:s.game.ui.targetColorEditor,style:{color:"#fff",font:"22px OpenSans_Regular"}}),new B(t,e.turnsValueSelector.x,e.turnsValueSelector.y,e.turnsValueSelector.width,t.gameStates.turns,(()=>(t.gameStates.turns=Math.max(1,t.gameStates.turns-1),t.gameStates.turns)),(()=>(t.gameStates.turns=Math.min(50,t.gameStates.turns+1),t.gameStates.turns))),new I(150,650,"Export",300,50,this,(()=>{this.exportBlock.show()})),new B(t,e.targetValueSelector.x,e.targetValueSelector.y,e.targetValueSelector.width,d(t.gameStates.targetColor,this.colors),(()=>j(-1,t)),(()=>j(1,t))),t.make.text({x:60,y:290,text:"Tools:",style:{color:"#fff",font:"22px OpenSans_Regular"}}),Object.entries(y).forEach((([s,i],n)=>{t.make.text({x:60,y:e.tools.y+e.tools.offset*n-50,text:i.text,style:{color:"#fff",font:"22px OpenSans_Regular"}}),new B(t,e.tools.x,e.tools.y+e.tools.offset*n,e.targetValueSelector.width,t.gameStates.availableTools[n],(()=>(this.gameStates.availableTools[n]=Phaser.Math.Clamp(this.gameStates.availableTools[n]-1,0,100),this.gameStates.availableTools[n])),(()=>(this.gameStates.availableTools[n]=Phaser.Math.Clamp(this.gameStates.availableTools[n]+1,0,100),this.gameStates.availableTools[n])))}))}loadPlayUI(t,e){const s=t.colors,i=u(t);t.add.rectangle(50,100,230,40,0,.8).setOrigin(0);const n=t.make.text({x:60,y:110,text:this.gameStates.mode===r.Endless?i.game.ui.movesUsed:i.game.ui.movesRemain,style:{color:"#fff",font:"22px OpenSans_Regular"}});t.turnCounter=t.make.text({x:60+n.width+5,y:105,text:`${t.gameStates.turns}`,style:{color:"#ffcd3f",font:"26px OpenSans_ExtraBold"}}),t.add.rectangle(e.targetUI.x-100,e.targetUI.y-10,550,50,0,.8).setOrigin(0);const a=t.make.text({x:e.targetUI.x,y:e.targetUI.y,text:i.game.ui.targetColor,style:{color:"#cbcbcc",font:"30px OpenSans_Regular"}}),o=s[t.gameStates.targetColor].colorName;t.make.text({x:a.x+a.width+5,y:e.targetUI.y,text:`${o[0].toUpperCase()}${o.slice(1)}`,style:{color:`rgb(${255*s[t.gameStates.targetColor].value.x},${255*s[t.gameStates.targetColor].value.y},${255*s[t.gameStates.targetColor].value.z} )`,font:"30px OpenSans_Regular"}})}createTitle(t,e){const s=t.add.image(60,50,"uiatlas","icon").setScale(.5).setOrigin(0);t.make.text({x:s.x+50,y:s.y,text:"Overflowing Palette "+(t.gameStates.mode===r.Editor?`| ${e}`:""),style:{color:"#ab9c6b",font:"26px OpenSans_Bold"}})}createTriangles(t,e){const s=[0,30,-20,0,20,0],i=[80,0,25,-15,0,15,0,9733196],n=[0,-20,-10,0,10,0,16777215,.2];t.add.triangle(e.targetUI.x-45,e.targetUI.y+15,...s,16777215),t.add.triangle(e.targetUI.x-5,e.targetUI.y+15,...s,9733196),t.add.triangle(t.btnContainer.x-10,...i),t.add.triangle(t.btnContainer.x+20,...i),t.add.triangle(t.btnContainer.x+10,t.cameras.main.height-240,...n),t.add.triangle(t.btnContainer.x+10,t.cameras.main.height-220,...n)}}function j(t,e){let s=h(t,e.gameStates.targetColor);return e.gameStates.targetColor=s,e.grid.updateBorderTint(),d(s,e.colors)}class A{constructor(t){e(this,"bgShader"),e(this,"textShader");const s=t.cameras.main.width,i=t.cameras.main.height,n=t.add.shader("loading",0,0,s,i,["celltexture","cellnoise"]).setOrigin(0);t.add.tileSprite(0,0,s,i,"cellMask").setOrigin(0).setTileScale(1.15);const a={x:s/2,y:i/2,text:"LOADING"};t.make.text({...a,style:{font:"bold 20rem Cinzel",stroke:"#000000",strokeThickness:10}}).setOrigin(.5);const o=t.make.text({...a,style:{font:"bold 20rem Cinzel",color:"#ffffff"}}).setOrigin(.5),r=t.add.bitmapMask(o),l=t.add.shader("loading",0,0,s,i,["celltexture","cellnoise"]).setOrigin(0).setMask(r);l.setUniform("isSimple.value",1),n.setUniform("transition.value",1.1),l.setUniform("transition.value",1.1),this.bgShader=n,this.textShader=l,t.cameras.main.postFX.addVignette(.5,.5,.68,.5)}}class D extends i.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"glsl",key:"loading",url:"assets/shaders/loading.glsl"},{type:"image",key:"cellMask",url:"assets/textures/shaders/cellMask.png"},{type:"image",key:"celltexture",url:"assets/textures/shaders/celltexture.webp"},{type:"image",key:"cellnoise",url:"assets/textures/shaders/cellnoise.webp"}]}})}preload(){const t=this.cameras.main.width,e=this.cameras.main.height;this.cache.shader.get("loading").uniforms={...f,screenResolution:{type:"2f",value:{x:t,y:e}}},this.showLoading(),this.cameras.main.fadeIn(300,0,0,0),this.load.pack("assets_pack","assets/data/assets.json"),this.cache.json.exists("config")||this.load.json("config","assets/data/config.json")}create(){const t=this.cameras.main.width,e=this.cameras.main.height;this.loadUserConfig("colors",R),this.loadUserConfig("background"),this.loadUserConfig("gameplay"),this.checkOldSavedData(),this.initShaderConfig({x:t,y:e}),this.cameras.main.fadeOut(300,0,0,0),this.time.delayedCall(300,(()=>{this.scene.start("MainMenu")}))}checkOldSavedData(){const t=localStorage.getItem("clearedLevels");if(!t)return;let e;try{e=JSON.parse(t)}catch{localStorage.removeItem("clearedLevels"),e=void 0}if(!e)return;const s=Array.from(e),i=new Map;s.forEach((t=>{i.set(t,{time:""})})),localStorage.setItem("levels.cleared",JSON.stringify(Array.from(i))),localStorage.removeItem("clearedLevels")}initShaderConfig(t){const e=this.cache,s=e.shader.get("base"),{shaders:i,gameplay:n}=e.json.get("config");s.uniforms={...i.base.init,lightenFactor:{type:"1f",value:n.fluidColors?.2:1},activeOffset:{type:"2f",value:{x:n.highlightIntensity?0:.4,y:.7}},screenResolution:{type:"2f",value:t}};const a=e.shader.get("distortion");a.uniforms={...a.uniforms,darkOverlay:{type:"1f",value:.7},radius:{type:"1f",value:.3}}}loadUserConfig(t,e){const s=this.cache.json.get("config"),i=localStorage.getItem(t);if(!i)return;const n=JSON.parse(i);e&&!e(n)||(s[t]={...s[t],...n})}showLoading(){const t=this,e=this.load,s=t.cameras.main.width,i=t.cameras.main.height,n=new A(this),a=t.make.text({x:s/2,y:i-150,text:"0%",style:{font:"2rem cinzel",color:"#ffffff"}});a.setOrigin(.5,.5);const o=t.make.text({x:s/2,y:i-100,text:"",style:{font:"2rem cinzel",color:"#ffffff"}});o.setOrigin(.5,.5),n.bgShader.setUniform("transition.value",-.1),n.textShader.setUniform("transition.value",-.1),e.on("progress",(function(t){a.setText(100*t+" %"),n.bgShader.setUniform("transition.value",t),n.textShader.setUniform("transition.value",t)})),e.on("fileprogress",(function(t){o.setText(`Loading asset: ${t.src}`)})),e.on("complete",(()=>{n.bgShader.setUniform("transition.value",1.1),n.textShader.setUniform("transition.value",1.1)}))}}const R=t=>{var e;return"object"==typeof t&&null!==t&&(null==(e=Object.entries(t))?void 0:e.every((([,t])=>"object"==typeof t&&null!=t&&"colorName"in t&&"value"in t)))};class z extends _{constructor(t,s,i,n,a,o){var r;super(s,i,t),e(this,"btn"),e(this,"overlay"),e(this,"active"),e(this,"text"),e(this,"key");const l=this.container;this.key=a;const{menuBtn:c}=t.cache.json.get("config").mainMenu,h=t.add.container(0,0);this.active=h;const d=t.add.image(-50,0,"MainBtnActiveCircle").setOrigin(.5,.5).setScale(.8),u=t.add.image(c.btn.offset,0,"MainBtnActive").setOrigin(0,.5);h.add([d,u]),this.btn=t.add.image(c.btn.offset,0,"uiatlas","menuBtn").setOrigin(0,.5),this.text=t.make.text({...c.text,text:n}).setFixedSize(275,60).setOrigin(0,.5),this.overlay=t.add.image(this.btn.x,this.btn.y,"uiatlas","menuBtn_overlay").setOrigin(0,.5),null==(r=this.overlay.preFX)||r.addBloom(16777215,1,1,1.5),this.overlay.setVisible(!1),this.btn.setInteractive(),this.btn.on("pointerdown",o,this),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),this.scene.tweens.add({targets:d,angle:360,repeat:-1,duration:5e4}),l.add([this.btn,this.overlay,h,this.text]),this.active.setVisible(!1),this.container.setVisible(!1),this.scene.time.delayedCall(50,(()=>{this.text.updateText(),this.container.setVisible(!0)})),this.container=l}update(t){t?(this.active.setVisible(!0),this.text.setTintFill(0)):(this.active.setVisible(!1),this.text.clearTint())}onEnter(){this.overlay.setVisible(!0),this.scene.input.setDefaultCursor("pointer"),this.text.setColor("#ffffff")}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default"),this.text.setColor("#a4a4a4")}}class $ extends _{constructor({key:t,x:s,y:i,scene:n,width:a,height:o}){super(s,i,n),e(this,"key"),e(this,"width"),e(this,"height"),e(this,"defaultPos"),e(this,"actionBtn"),e(this,"viewBox"),e(this,"contentContainer"),this.key=t,this.defaultPos={x:s,y:i},this.width=a,this.height=o,this.viewBox=n.add.dom(0,0,"div",{width:`${a}px`,height:`${o}px`,fontSize:"24px",overflow:"auto"}).setOrigin(0),this.contentContainer=document.createElement("div"),this.viewBox.node.append(this.contentContainer),this.container.setVisible(!1),this.container.add(n.add.rectangle(0,0,a,o,0,.6).setOrigin(0,0));const r=n.add.rectangle(s,i,a,o,16777215).setOrigin(0,0).setVisible(!1).createGeometryMask();this.container.setMask(r),this.actionBtn=new I(a-180,o-200,"Start",350,0,n),this.actionBtn.container,this.container.add([this.viewBox,this.actionBtn.container])}show(){this.container.visible||(this.container.setVisible(!0),this.scene.tweens.add({duration:300,targets:this.container,x:{from:this.defaultPos.x-100,to:this.defaultPos.x},alpha:{from:0,to:1},yoyo:!1}))}hide(t){const e=this.container.x;this.scene.tweens.add({duration:t?0:300,targets:this.container,x:{from:this.defaultPos.x,to:this.defaultPos.x-100},alpha:{from:1,to:0},onComplete:()=>{this.container.setVisible(!1),this.container.setX(e)}})}}class G extends _{constructor(t,s,i,n,a,o){super(t,s,o),e(this,"previewBlock"),e(this,"levelInfo"),e(this,"emptyBlock"),e(this,"actionBtn"),e(this,"width"),this.width=i;const{selectedLevelInfo:r}=o.cache.json.get("config").mainMenu.levelSelection;this.container.add([o.add.rectangle(0,0,i,n,0,.7).setOrigin(0,0),o.add.rectangle(0,0,i,45,0,.6).setOrigin(0,0),o.make.text({x:i/2,y:0,text:"Preview",style:{color:"#fff",font:"32px OpenSans_Bold"}}).setOrigin(.5,0)]),this.emptyBlock=o.make.text({...r.emptyText,x:i/2}).setOrigin(.5,0),this.previewBlock=new F(10,60,o),this.levelInfo=new K(0,40,o),this.container.add([this.emptyBlock,this.levelInfo.container,this.previewBlock.container]),a&&(this.actionBtn=a,a.container.setPosition(i/2+70,n-50),a.container.parentContainer.remove(a.container),a.container.setScale(1),this.container.add(a.container),a.hide()),this.previewBlock.hide(),this.levelInfo.hide()}updateInfo(t,e,s){if(!t)return this.actionBtn.hide(),this.previewBlock.hide(),this.levelInfo.hide(),void this.emptyBlock.setVisible(!0);this.actionBtn.container.setVisible(!0),this.levelInfo.update(String(t.turns),t,s),this.levelInfo.container.setVisible(!0),this.previewBlock.updatePreview(t.board),this.previewBlock.container.setVisible(!0),this.actionBtn.btn.on("pointerdown",(()=>{this.scene.scene.start("LoadingGame",{mode:r.Play,levelKey:e,levelData:t})})),this.emptyBlock.setVisible(!1)}}class F extends _{constructor(t,s,i){super(t,s,i),e(this,"graphics"),this.graphics=i.add.graphics(),this.container.add(this.graphics)}updatePreview(t){const{selectedLevelInfo:e}=this.scene.cache.json.get("config").mainMenu.levelSelection,{colors:s}=this.scene.cache.json.get("config"),i=t.length,n=t[0].length,a=n*e.previewBlock.cellSize,o=i*e.previewBlock.cellSize,r=e.previewBlock.width/a,l=e.previewBlock.height/o,h=Math.min(r,l),d=this.graphics;d.setScale(h),this.container.setPosition((e.previewBlock.width-a*h)/2,this.container.y),d.clear();for(let u=0;u<i;u++)for(let e=0;e<n;e++){const i=s[t[u][e]].value;d.fillStyle(c(i)),d.fillRect(50*e,50*u,50,50)}}}class K{constructor(t,s,i){e(this,"scene"),e(this,"container"),e(this,"turnsText"),e(this,"tartgetColorText"),e(this,"author"),e(this,"gridSize"),e(this,"clearedBlock"),this.scene=i;const n=i.add.dom(t,380,"div",{width:"420px",height:"500px",fontSize:"24px",overflow:"auto"}).setOrigin(0);this.container=n;const a=document.createElement("div");a.classList.add("info-block"),n.node.append(a),this.tartgetColorText=this.addRecord("Target Color:","red"),this.turnsText=this.addRecord("Moves:","0"),this.author=this.addRecord("Author:",""),this.gridSize=this.addRecord("Grid Size:",""),this.clearedBlock=new W,this.clearedBlock.hide(),a.appendChild(this.turnsText),a.appendChild(this.tartgetColorText),a.appendChild(this.author),a.appendChild(this.gridSize),a.appendChild(this.clearedBlock.container)}addRecord(t,e,s){return new M(t,e,s??"preview-item","preview-item__label","preview-item__value").container}update(t,e,s){const{colors:i}=this.scene.cache.json.get("config");this.tartgetColorText.childNodes[1].textContent=`${i[e.targetColor].colorName}`;const{x:n,y:a,z:o}=i[e.targetColor].value;this.tartgetColorText.childNodes[1].style.color=Phaser.Display.Color.RGBToString(255*n,255*a,255*o),this.turnsText.childNodes[1].textContent=t,this.gridSize.childNodes[1].textContent=`${e.board.length}x${e.board[0].length} `,e.author?(this.author.style.display="flex",this.author.childNodes[1].textContent=e.author):this.author.style.display="none",s?(this.clearedBlock.show(),this.clearedBlock.time.textContent=s.time):this.clearedBlock.hide()}hide(){this.container.setVisible(!1)}}class W{constructor(){e(this,"container"),e(this,"time");const t=document.createElement("div"),s=document.createElement("p");s.classList.add("preview-item-cleared"),s.textContent="CLEARED";const i=new M("Time","A long time ago","preview-item","preview-item__label","preview-item__value");t.appendChild(s),t.appendChild(i.container),this.time=i.value,this.container=t}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}}class J extends _{constructor(t){super(0,0,t),e(this,"viewBox"),e(this,"applyBtn"),e(this,"previewBlock");const s=t.cameras.main.height;this.viewBox=t.add.dom(500,0,"div",{width:"1000px",height:`${s}px`,fontSize:"24px",overflow:"auto",display:"flex",justifyContent:"center",alignItems:"center"}).setOrigin(0);const i=document.createElement("textarea");i.classList.add("import-block__text");const n=document.createElement("div");n.classList.add("wrapper"),n.classList.add("import-block"),this.viewBox.node.appendChild(n),this.applyBtn=new I(t.cameras.main.width/2,t.cameras.main.height/2+50,"Start",350,50,t),this.container.add([this.applyBtn.container,this.viewBox]);const a=new E("Import level");a.add(i);const o=document.createElement("div");o.classList.add("import-block__btns");const r=document.createElement("button");r.classList.add("primary-btn"),r.textContent="Load",r.addEventListener("click",(()=>{const t=this.parseString(i.value);t&&(this.previewBlock.show(),this.previewBlock.updateInfo(t))}));const l=document.createElement("button");l.classList.add("primary-btn"),l.textContent="Cancel",l.addEventListener("click",(()=>{i.value="",this.hide()})),o.appendChild(l),o.appendChild(r),this.previewBlock=new G(1500,0,420,s,this.applyBtn,t),n.appendChild(a.container),n.appendChild(o),this.container.add(this.previewBlock.container),this.hide()}parseString(t){try{const e=JSON.parse(atob(t));if(!("turns"in e)||!("board"in e))return;return e}catch(e){console.warn("Not correct string")}}hide(){super.hide(),this.viewBox.node.value="",this.previewBlock.hide()}}class H{constructor(t,s,i,n){e(this,"container"),e(this,"value"),e(this,"options"),e(this,"isCycle"),e(this,"leftBtn"),e(this,"rightBtn"),e(this,"text"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s;const a=document.createElement("span");a.classList.add("value-selector__label"),a.textContent=t;const o=document.createElement("div");o.classList.add("value-selector__input-wrapper");const r=this.createButton();r.classList.add("value-selector__button--left"),r.addEventListener("click",(()=>{this.update(i())}));const l=document.createElement("span");l.classList.add("value-selector__value"),l.textContent=String(s);const c=this.createButton();c.addEventListener("click",(()=>{this.update(n())})),this.leftBtn=r,this.rightBtn=c,this.text=l,o.appendChild(r),o.appendChild(l),o.appendChild(c),this.container.appendChild(a),this.container.appendChild(o)}createButton(){const t=document.createElement("button");t.classList.add("value-selector__button");const e=document.createElement("div");return e.classList.add("icon"),t.appendChild(e),t}update(t){this.text.textContent=String(t)}}class X{constructor(t,s,i,n,a,o,r){e(this,"key"),e(this,"btn"),e(this,"tab"),this.key=t;const l=this.createButton(i,o,r),c=this.createTab(t);n.appendChild(l),a.append(c),this.btn=l,this.tab=c,s&&this.activate()}createButton(t,e,s){const i=document.createElement("button");return i.textContent=t,i.classList.add("option-tab__button"),i.addEventListener("click",(()=>{e.call(s,this.key)})),i}createTab(t){const e=document.createElement("div");return e.classList.add("option-tab"),e.setAttribute("data-id",t),e}disable(){this.btn.classList.remove("active"),this.tab.classList.remove("active")}activate(){this.btn.classList.add("active"),this.tab.classList.add("active")}}class Y extends X{constructor(t,s,i,n,a,o,r,l,c){super(s,i,n,o,r,l,c),e(this,"colorInputs",{names:[],values:[]});const{colors:h}=t.cache.json.get("config"),{options:d}=u(t),p=document.createElement("div");p.classList.add("colors");const g=new E(d.colorsTab.folderName);g.add(p),this.tab.appendChild(g.container),Object.entries(h).forEach((([,t],e)=>{p.appendChild(this.createColorSelector(e+1,t.colorName,t.value))}))}createColorSelector(t,e,i){const n=document.createElement("div");n.classList.add("selector");const a=document.createElement("div");a.classList.add("selector__index");const o=document.createElement("span");o.textContent=`${t}`,a.append(o);const r=document.createElement("input");r.classList.add("selector__name"),r.defaultValue=e;const l=document.createElement("input");var c;return l.setAttribute("type","color"),l.defaultValue=`${c=i,s.Display.Color.RGBToString(255*c.x,255*c.y,255*c.z)}`,n.appendChild(a),n.appendChild(r),n.appendChild(l),this.colorInputs.names.push(r),this.colorInputs.values.push(l),n}getValues(){const t={};return this.colorInputs.names.forEach(((e,s)=>{const i=Phaser.Display.Color.HexStringToColor(this.colorInputs.values[s].value);t[s]={colorName:e.value,value:{x:i.red/255,y:i.green/255,z:i.blue/255}}})),t}}class Z{constructor(t,s,i,n,a){e(this,"container"),e(this,"value"),e(this,"options"),e(this,"isCycle"),e(this,"leftBtn"),e(this,"rightBtn"),e(this,"text"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s,this.options=i,this.isCycle=n;const o=document.createElement("span");o.classList.add("value-selector__label"),o.textContent=t;const r=document.createElement("div");r.classList.add("value-selector__input-wrapper");const l=this.createButton();l.classList.add("value-selector__button--left"),l.addEventListener("click",(()=>{this.back(),this.update(),a(this.value)}));const c=document.createElement("span");c.classList.add("value-selector__value"),c.textContent=String(this.options[s]);const h=this.createButton();h.addEventListener("click",(()=>{this.forward(),this.update(),a(this.value)})),this.leftBtn=l,this.rightBtn=h,this.text=c,r.appendChild(l),r.appendChild(c),r.appendChild(h),this.container.appendChild(o),this.container.appendChild(r),this.update()}createButton(){const t=document.createElement("button");t.classList.add("value-selector__button");const e=document.createElement("div");return e.classList.add("icon"),t.appendChild(e),t}update(){this.rightBtn.disabled=!this.isCycle&&this.value===this.options.length-1,this.leftBtn.disabled=!this.isCycle&&0===this.value,this.text.textContent=this.options[this.value]}getValue(t){const e=this.options.length-1;return this.isCycle?(t+e)%e:Phaser.Math.Clamp(t,0,e)}forward(){this.value=this.getValue(this.value+1)}back(){this.value=this.getValue(this.value-1)}}class q{constructor(t,s,i,n,a){e(this,"container"),e(this,"value"),e(this,"text"),e(this,"valueText"),e(this,"input"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s;const o=document.createElement("span");o.classList.add("value-selector__label"),o.textContent=t;const r=document.createElement("div");r.classList.add("range-slider");const l=document.createElement("span");l.classList.add("range-slider__value"),l.textContent=String(s);const c=document.createElement("input");c.setAttribute("type","range"),c.setAttribute("min",`${i}`),c.setAttribute("max",`${n}`),c.value=String(s),c.className="range-slider__input",c.addEventListener("input",(t=>{const e=t.target;this.update(Number(e.value)),a(Number(e.value))})),this.input=c,this.text=l,r.appendChild(c),r.appendChild(l),this.container.appendChild(o),this.container.appendChild(r),this.update(s)}update(t){this.text.textContent=String(t),console.log(),this.input.style.background=`linear-gradient(to right, var( --clr-slider) ${t}%, #e0e0e0 ${t}%)`}}class Q extends X{constructor(t,s,i,n,a,o,r,l,c){super(s,i,n,o,r,l,c),e(this,"currentConfig");const h=t.cache.json.get("config");this.currentConfig=h.gameplay;const{gameplayTab:d}=u(t).options,p=new E(d.folderName),m=new Z(d.fluidColors.text,this.currentConfig.fluidColors,d.fluidColors.options,!1,(t=>{this.currentConfig.fluidColors=t})),v=new Z(d.highlightIntensity.text,this.currentConfig.highlightIntensity,d.highlightIntensity.options,!1,(t=>{this.currentConfig.highlightIntensity=t})),f=new q(d.animationSpeed,100-g(this.currentConfig.transitionDefault,h.gameplay.transitionMinimum,h.gameplay.transitionMax,0,100),0,100,(t=>{this.currentConfig.transitionDefault=g(100-t,0,100,h.gameplay.transitionMinimum,h.gameplay.transitionMax)})),y=new q(d.soundVolume,this.currentConfig.sound,0,100,(t=>{this.currentConfig.sound=t}));p.add(m.container),p.add(v.container),p.add(f.container),p.add(y.container),this.tab.appendChild(p.container)}getValues(){return this.currentConfig}}class tt{constructor(t,s,i,n,a){e(this,"container"),this.container=document.createElement("div"),this.container.classList.add("select");const o=document.createElement("div");o.classList.add("select-wrapper");const r=document.createElement("select"),l=document.createElement("label");l.textContent=t,l.classList.add("select__label");const c=document.createElement("div");c.classList.add("icon"),o.appendChild(r),o.appendChild(c),this.container.appendChild(l),this.container.appendChild(o),i.forEach(((t,e)=>{const s=document.createElement("option");s.value=a?a[e]:t.toLowerCase(),s.textContent=t,r.appendChild(s)})),r.value=s,r.addEventListener("change",n)}}class et extends X{constructor(t,s,i,n,a,o,r,l,c){super(s,i,n,o,r,l,c),e(this,"scene"),e(this,"currentConfig",{background:{current:{distortion:0,overlay:0,key:""},options:[]},lang:""}),this.scene=t;const h=t.cache.json.get("config");this.currentConfig.background=h.background,this.currentConfig.lang=localStorage.getItem("lang")??"en",this.createTextSection(),this.createBackgroundSection()}createTextSection(){const{meta:t}=this.scene.cache.json.get("localization"),{generalTab:e}=u(this.scene).options,s=new tt(e.languageSelection,this.currentConfig.lang,t.langsAvailable.map((t=>t.name)),(t=>{const e=t.target;this.currentConfig.background.current.key=null==e?void 0:e.value}),t.langsAvailable.map((t=>t.key))),i=new E(e.languageBlock);i.add(s.container),this.tab.appendChild(i.container)}createBackgroundSection(){const{generalTab:t,defaultToggle:e}=u(this.scene).options,s=new tt(t.image,this.currentConfig.background.current.key,this.currentConfig.background.options.map((t=>t.name)),(t=>{const e=t.target;this.currentConfig.background.current.key=null==e?void 0:e.value}),this.currentConfig.background.options.map((t=>t.key))),i=new Z(t.distortion,this.currentConfig.background.current.distortion,e,!1,(t=>{this.currentConfig.background.current.distortion=t})),n=new Z(t.overlay,this.currentConfig.background.current.overlay,e,!1,(t=>{this.currentConfig.background.current.overlay=t})),a=new E(t.background);a.add(s.container),a.add(i.container),a.add(n.container),this.tab.appendChild(a.container)}getValues(){return this.currentConfig}}const st=[{key:"LevelSelector",props:{width:1e3},type:class extends ${constructor(t){super(t),e(this,"selectedLevelData"),e(this,"selectedFolder"),e(this,"selectedLevelInfo"),e(this,"levelsList"),e(this,"clearedLevels"),e(this,"importBlock");const{x:s,y:i,scene:n,width:a,height:o}=t;this.levelsList=n.add.dom(0,0,"div",{width:`${a}px`,height:`${o}px`,fontSize:"24px",overflow:"auto"}).setOrigin(0,0),this.levelsList.node.id="boxid",this.container.add(this.levelsList);const r=document.createElement("div");this.selectedLevelInfo=new G(s+a,i,n.cameras.main.width-s-a,o,this.actionBtn,n),this.importBlock=new J(this.scene),this.importBlock.hide(),this.selectedLevelInfo.container.add(new I(80,this.actionBtn.container.y,"Back",200,0,n,(()=>{this.showFolders(),this.selectedLevelInfo.hide()})).container),this.levelsList.node.append(r),this.levelsList.node.id="boxid",this.selectedLevelInfo.hide(),this.showFolders()}showSelectedFolder(t){if(!this.scene.cache.json.get("levels"))return;this.levelsList.node.replaceChildren();const e=document.createElement("div");e.classList.add("folder-container"),this.levelsList.node.appendChild(e),this.selectedFolder=t.folderName,this.selectedLevelInfo.show();const s=p();this.clearedLevels=s;for(const i of t.categories)e.append(this.createCategory(i))}showFolders(){const t=this.scene.cache.json.get("levels");if(!t)return;this.levelsList.node.replaceChildren();const e=document.createElement("div");e.classList.add("level-container"),this.levelsList.node.appendChild(e);for(const i of t)e.appendChild(this.createFolderBtn(i.folderName,i));const s=this.createBtn("Import");s.addEventListener("click",(()=>{this.importBlock.show()})),e.appendChild(s)}createLvlBtn(t,e,s){const i=this.createBtn(t);return s&&this.clearedLevels.has(s)&&i.classList.add("cleared"),i.addEventListener("click",(()=>{this.selectedLevelInfo.updateInfo(e,s,this.clearedLevels.get(s))})),i}createFolderBtn(t,e){const s=this.createBtn(t);return s.addEventListener("click",(()=>{this.showSelectedFolder(e)})),s}createBtn(t){const e=document.createElement("div"),s=document.createElement("div");return s.innerText=t,s.classList.add("text"),e.classList.add("level-card"),e.append(s),e}createCategory(t){const e=document.createElement("div"),s=document.createElement("h3");s.classList.add("folder-text"),s.innerText=t.categoryName,e.append(s);const i=document.createElement("div");return i.classList.add("container"),t.levels.forEach(((e,s)=>{i.append(this.createLvlBtn(String(s+1),e,`${this.selectedFolder}.${t.categoryName}.${s+1}`))})),e.append(i),e.classList.add("folder"),e}show(){super.show(),this.showFolders()}hide(t){super.hide(),this.selectedLevelInfo.hide(),this.selectedLevelInfo.updateInfo(void 0)}}},{key:"LevelEditor",type:class extends ${constructor(t){super(t),e(this,"selectedFillColor",0),e(this,"rows",8),e(this,"columns",10);const{scene:s,width:i,height:n}=t,{colors:a}=s.cache.json.get("config"),o=s.add.dom(0,0,"div",{width:`${i}px`,height:`${n}px`}).setOrigin(0),l=new E("Grid Options");o.node.appendChild(l.container);const c=new H("Columns",this.columns,(()=>(this.columns=Phaser.Math.Clamp(this.columns-1,2,100),this.columns)),(()=>(this.columns=Phaser.Math.Clamp(this.columns+1,2,100),this.columns))),h=new H("Rows",this.rows,(()=>(this.rows=Phaser.Math.Clamp(this.rows-1,2,100),this.rows)),(()=>(this.rows=Phaser.Math.Clamp(this.rows+1,2,100),this.rows))),u=new H("Fill Color",d(this.selectedFillColor,a),(()=>this.changeTargetColor(-1)),(()=>this.changeTargetColor(1)));l.add(c.container),l.add(h.container),l.add(u.container),this.actionBtn.btn.setInteractive(),this.actionBtn.btn.on("pointerdown",(()=>{this.scene.scene.start("LoadingGame",{mode:r.Editor,levelData:{board:this.generateField(this.rows,this.columns,this.selectedFillColor),targetColor:0,turns:1}})})),this.container.add([o])}generateField(t,e,s){const i=[];for(let n=0;n<t;n++){i[n]??(i[n]=[]);for(let t=0;t<e;t++)i[n][t]=s}return i}changeTargetColor(t){const{colors:e}=this.scene.cache.json.get("config");let s=h(t,this.selectedFillColor);return this.selectedFillColor=s,d(s,e)}}},{key:"EndlessZen",type:class extends ${constructor(t){super(t),e(this,"selectedFillColor",0),e(this,"rows",8),e(this,"columns",10),e(this,"difficulty",1),e(this,"colorsCount",4);const{scene:s,width:i,height:n}=t,{endlessZen:a}=u(s),o=s.add.dom(0,0,"div",{width:`${i}px`,height:`${n}px`}).setOrigin(0),l=new E(a.folderName);o.node.appendChild(l.container);const c=new H(a.columnsCount,this.columns,(()=>(this.columns=Phaser.Math.Clamp(this.columns-1,2,100),this.columns)),(()=>(this.columns=Phaser.Math.Clamp(this.columns+1,2,100),this.columns))),h=new H(a.rowsCount,this.rows,(()=>(this.rows=Phaser.Math.Clamp(this.rows-1,2,100),this.rows)),(()=>(this.rows=Phaser.Math.Clamp(this.rows+1,2,100),this.rows))),d=new H(a.colorsCount,this.colorsCount,(()=>(this.colorsCount=Phaser.Math.Clamp(this.colorsCount-1,2,8),this.colorsCount)),(()=>(this.colorsCount=Phaser.Math.Clamp(this.colorsCount+1,2,8),this.colorsCount))),p=a.difficulties,g=new Z(a.difficulty,this.difficulty,p,!1,(t=>{this.difficulty=t}));l.add(c.container),l.add(h.container),l.add(d.container),l.add(g.container),this.actionBtn.btn.setInteractive(),this.actionBtn.btn.on("pointerdown",(()=>{this.scene.scene.start("LoadingGame",{mode:r.Endless,endlessOptions:{rows:this.rows,columns:this.columns,colorsCount:this.colorsCount,difficulty:this.difficulty},levelData:x(this.rows,this.columns,this.colorsCount,this.difficulty)})})),this.container.add([o])}}},{key:"Options",type:class extends ${constructor(t){super(t),e(this,"inputs",[]),e(this,"isSimpleColors"),e(this,"strongerHighlight"),e(this,"colorTab"),e(this,"generalTab"),e(this,"gameplayTab"),e(this,"tabs",[]),e(this,"activeTab","general");const s=this.scene,{options:i}=u(s);this.actionBtn.text.setText(i.btnSave),this.actionBtn.btn.on("pointerdown",this.saveUserConfig,this);const n=new I(980,880,i.btnReset,350,50,this.scene,this.resetUserConfig,this);this.container.add(n.container);const a=document.createElement("div"),o=document.createElement("div");this.contentContainer.appendChild(a),this.contentContainer.appendChild(o),this.generalTab=new et(s,"general",!0,i.tabs.general,800,a,o,this.updateActiveTab,this),this.colorTab=new Y(s,"colors",!1,i.tabs.colors,800,a,o,this.updateActiveTab,this),this.gameplayTab=new Q(s,"gameplay",!1,i.tabs.gameplay,800,a,o,this.updateActiveTab,this),this.tabs.push(this.generalTab,this.colorTab,this.gameplayTab),this.contentContainer.classList.add("menu-options")}updateActiveTab(t){this.activeTab=t,this.tabs.forEach((t=>{t.key!==this.activeTab?t.disable():t.activate()}))}addText(t,e,s){const i=document.createElement("p");i.textContent=t,s&&i.classList.add(s),e.append(i)}addCheckbox(t,e,s){const i=document.createElement("div");i.style="display:flex;justify-content:space-between;align-items:center;padding:1rem;",this.addText(t,i);const n=document.createElement("input");return localStorage.getItem(s)&&(n.checked=!0),i.append(n),n.setAttribute("type","checkbox"),e.append(i),n}show(){super.show(),this.update()}update(){const{colors:t}=this.scene.cache.json.get("config");this.inputs.forEach(((e,s)=>{const i=t[s],n=Phaser.Display.Color.RGBToString(255*i.x,255*i.y,255*i.z);e.style.background=n,e.value=n}))}resetUserConfig(){Object.keys(localStorage).forEach((t=>{"levels.cleared"!==t&&localStorage.removeItem(t)})),this.hide(),this.scene.cache.json.remove("config"),this.scene.scene.start("Boot")}saveUserConfig(){const t=this.colorTab.getValues(),e=this.generalTab.getValues(),s=this.gameplayTab.getValues();localStorage.setItem("colors",JSON.stringify(t)),localStorage.setItem("background",JSON.stringify(e.background)),localStorage.setItem("gameplay",JSON.stringify(s)),localStorage.setItem("lang",e.lang),this.hide(),this.scene.scene.start("Boot")}}}];class it extends i.Scene{constructor(){super("MainMenu"),e(this,"activeTab"),e(this,"tabs",new Map),e(this,"tabBtns",new Map)}create(){const t=this.cameras.main.width-500,e=this.cameras.main.height;this.createBackground(),this.makeMenuBtns(),st.forEach((s=>{const i=new s.type({x:500,y:0,scene:this,width:t,height:e,key:s.key,...s.props});this.tabs.set(s.key,i)})),this.cameras.main.fadeIn(1e3,0,0,0)}createBackground(){const t=this.cameras.main.width,e=this.cameras.main.height;if(new V(this),!this.textures.exists("gradient")){const s=this.textures.createCanvas("gradient",800,e);if(s){const i=s.getContext(),n=i.createLinearGradient(0,0,800,0);n.addColorStop(0,"black"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=n,i.fillRect(0,0,t,e),s.refresh()}}this.add.image(0,0,"gradient").setOrigin(0),this.add.graphics().fillStyle(1447446,1).lineStyle(4,4473924,.6).lineBetween(50,0,50,this.cameras.main.height)}makeMenuBtns(){const{x:t,y:e,gap:s}=this.cache.json.get("config").mainMenu.buttonsBlock,i=u(this),n=this.add.container(t,e),a=100+s;[{key:"LevelSelector",text:i.mainMenu.selectLevel},{key:"EndlessZen",text:i.mainMenu.endlessZen},{key:"LevelEditor",text:i.mainMenu.createLevel},{key:"Options",text:i.mainMenu.options}].forEach((({key:t,text:e},s)=>{const i=this.createButton(0,s*a,e,t);this.tabBtns.set(t,i),n.add(i.container)}));const o=this.createButton(0,this.cameras.main.height-300,i.mainMenu.gitHub,"Git");o.btn.on("pointerdown",(()=>{window.open("https://github.com/XirTelan/overflowing_palette","GitHubProject")})),o.text.setFontSize(24),n.add(o.container)}createButton(t,e,s,i){return new z(this,t,e,s,i,(()=>{st.forEach((({key:t})=>{var e;const s=this.tabs.get(t);if(!s)return;const n=i==t&&!s.container.visible;null==(e=this.tabBtns.get(t))||e.update(n),n?s.show():s.hide()}))}))}}class nt extends Phaser.Scene{constructor(){super("LoadingGame")}create(t){new A(this),this.time.delayedCall(100,(()=>{this.scene.start("Game",t)}))}}const at={type:i.AUTO,width:1920,height:1080,parent:"game-container",backgroundColor:"#121212",dom:{createContainer:!0},scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH},scene:[D,it,nt,U]},ot=new Phaser.Game(at);document.addEventListener("DOMContentLoaded",(()=>{ot.scene.start("Boot")}));
