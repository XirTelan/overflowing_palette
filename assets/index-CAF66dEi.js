var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{P as s,p as i}from"./phaser-hyM8z1KO.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var n=(t=>(t[t.block=-1]="block",t[t.red=0]="red",t[t.green=1]="green",t[t.blue=2]="blue",t[t.yellow=3]="yellow",t[t.orange=4]="orange",t[t.purple=5]="purple",t[t.pink=6]="pink",t[t.cyan=7]="cyan",t))(n||{}),o=(t=>(t[t.none=-1]="none",t[t.All=0]="All",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t))(o||{}),a=(t=>(t[t.Waiting=0]="Waiting",t[t.Active=1]="Active",t))(a||{}),r=(t=>(t[t.Play=0]="Play",t[t.Editor=1]="Editor",t[t.Endless=2]="Endless",t))(r||{});const l=t=>s.Display.Color.RGBToString(Math.floor(255*t.x),Math.floor(255*t.y),Math.floor(255*t.z)),c=t=>s.Display.Color.GetColor(Math.floor(255*t.x),Math.floor(255*t.y),Math.floor(255*t.z));function h(t,e){const s=Math.floor((Object.keys(n).length-1)/2);return((e+t)%s+s)%s}function d(t,e){const s=e[t].colorName;return`${s[0].toUpperCase()}${s.slice(1)}`}const u=150,p=[[1,0],[-1,0],[0,1],[0,-1]],m={0:.7,1:.5,2:.3,3:.1},g="overflowingPalette_",v={color:{type:"3f",value:{x:0,y:0,z:0}},colorToTransform:{type:"3f",value:{x:1,y:1,z:1}},textureResolution:{type:"2f",value:{x:512,y:512}},isSimple:{type:"1f",value:0},transition:{type:"1f",value:0},active:{type:"1f",value:0}},f=t=>t.cache.json.get("localization"),y=t=>t.cache.json.get("config"),C=()=>localStorage.getItem("lang")??"en",b=()=>{const t=localStorage.getItem(`${g}levels.cleared`);return t?new Map(JSON.parse(t)):new Map};function x(t,e,s,i,n){return(t-e)*(n-i)/(s-e)+i}function S(t,e,s,i){let n=Array.from({length:t},(()=>Array(e).fill(null))),o=m[i],a=[];for(let d=0;d<t;d++)for(let t=0;t<e;t++)a.push([d,t]);Phaser.Utils.Array.Shuffle(a);let r=a.slice(0,s);r.forEach((([t,e],s)=>{n[t][e]=s}));let l=[...r];const c=new Map,h=e*t;for(;l.length>0;){const[s,i]=l.pop();let a=n[s][i];const r=c.get(a)??0;p.forEach((([d,u])=>{const p=s+d,m=i+u;var g,v;v=m,(g=p)>=0&&g<t&&v>=0&&v<e&&r<.6*h&&null===n[p][m]&&Math.random()<o&&(n[p][m]=a,c.set(a,(c.get(a)||0)+1),l.push([p,m]))}))}for(let d=0;d<t;d++)for(let t=0;t<e;t++)null===n[d][t]&&(n[d][t]=Math.floor(Math.random()*s));return n}function w(t,e,s,i){return{board:S(t,e,s,i),targetColor:Math.floor(Math.random()*s),turns:0}}class k{constructor(t,s,i,n){var r;e(this,"scene"),e(this,"grid"),e(this,"keyObj"),e(this,"activeCells"),e(this,"originPos"),e(this,"cell"),e(this,"activeTween"),this.scene=t,this.grid=s,this.scene.setGameState(a.Waiting);const l=this.scene.gameStates.selectedTool;this.cell=s.board[i][n];const{tile:c,color:h}=this.cell;this.originPos=[c.x,c.y];let d=p;switch(l){case o.Horizontal:d=[p[0],p[1]];break;case o.Vertical:d=[p[2],p[3]]}this.activeCells=[],d.forEach((t=>{const[e,o]=[i+t[0],n+t[1]],a=this.grid.board.length-1,r=this.grid.board[0].length-1;if(e<0||o<0||e>a||o>r)return;const l=s.board[e][o];l.color!==h&&-1!==l.color&&this.activeCells.push(this.createSwapPos(e,o))})),0!==this.activeCells.length?(this.activeTween=this.scene.tweens.add({targets:c,x:{value:()=>c.x+Phaser.Math.Between(-3,3),duration:150},y:{value:()=>c.y+Phaser.Math.Between(-3,3),duration:150},yoyo:!0,repeat:-1}),this.keyObj=null==(r=this.scene.input.keyboard)?void 0:r.addKey("ESC"),this.keyObj&&this.keyObj.on("down",(()=>{this.cancelSwapSelection()}))):this.scene.setGameState(a.Active)}cancelSwapSelection(){var t,e;this.scene.changeSelectedTool(o.none),this.activeCells.forEach((t=>t.destroy())),null==(t=this.keyObj)||t.destroy(),this.scene.setGameState(a.Active),null==(e=this.activeTween)||e.destroy(),this.cell.tile.setPosition(this.originPos[0],this.originPos[1]),this.grid.removeSwapSelection()}createSwapPos(t,e){const s=this.grid.board[t][e].tile.getWorldPoint(),i=this.scene.add.shader("base",s.x+this.grid.cellSize/2,s.y+this.grid.cellSize/2,this.grid.cellSize,this.grid.cellSize).setScale(1.2);return i.setUniform("color.value",{x:.949,y:.953,z:.827}),i.setUniform("active.value",1),i.setUniform("transparent.value",1),i.setInteractive(),i.on("pointerup",(()=>{this.applySwap(t,e)})),i}applySwap(t,e){const s=this.grid.board[t][e],{x:i,y:n}=s.tile.getWorldPoint(),{x:o,y:a}=this.cell.tile.getWorldPoint(),[r,l]=[i-o,n-a],c=this.scene.gameStates.selectedTool;this.cancelSwapSelection(),this.scene.time.delayedCall(50,(()=>{const t=s.color;s.setColor(this.cell.color),this.cell.setColor(t),this.scene.useTool(c)})),this.scene.tweens.add({targets:s.tile,x:"-="+r/2,y:"-="+l/2,yoyo:!0,duration:50}),this.scene.tweens.add({targets:this.cell.tile,x:"+="+r/2,y:"+="+l/2,yoyo:!0,duration:50})}}class B{constructor(t,s,i,n,o,a,r){e(this,"scene"),e(this,"cellSize"),e(this,"tileScale"),e(this,"container"),e(this,"tile"),e(this,"transitionTile"),e(this,"portal"),e(this,"linkendCell"),e(this,"timedText"),e(this,"timedCounter"),e(this,"_color"),e(this,"colors"),e(this,"action"),e(this,"pos"),this.scene=t,this._color=n,this.cellSize=a,this.tileScale=this.cellSize/64,this.container=t.add.container(i*(a+o),s*(a+o)),this.action=r;const{colors:l}=y(t);this.colors=l,this.pos={x:s,y:i},this.scene.events.on("shutdown",this.onDestroy,this)}get color(){return this._color}createTransitionTile(){const t=this.scene.add.image(this.tile.x+this.cellSize/2,this.tile.y+this.cellSize/2,"transitionTile").setScale(this.tileScale).setBlendMode(i.BlendModes.ADD);t.setVisible(!1),this.transitionTile=t,this.container.add(t)}onClick(){this.action(this.pos.x,this.pos.y)}setTimedCell(t,e){this.timedText&&this.clearTimed(),this.timedCounter=t;const s=this.scene.add.text(0,0,`${t}`,{font:.9*this.cellSize+"px Arial",color:l(this.colors[e].value),align:"center",stroke:"#000000",strokeThickness:4});s.setOrigin(.5,.5),s.setPosition(this.cellSize/2,this.cellSize/2),this.container.add(s),this.timedText=s,this.scene.events.on("turn",this.updateTurns,this)}updateTurns(){var t;this.timedCounter--;try{null==(t=this.timedText)||t.setText(`${this.timedCounter}`)}catch(e){console.warn(e)}this.timedCounter<=0&&this.clearTimed()}setTileInteractions(){this.tile.setInteractive(),this.tile.on("pointerup",this.onClick,this),this.tile.on("pointerover",this.onEnter,this),this.tile.on("pointerout",this.onLeave,this)}setLinkedCell(t,e){const s=this.scene.add.image(this.tile.x,this.tile.y,"portalMask").setOrigin(0).setScale(this.tileScale);e&&s.setTintFill(e),s.name="portalMask",this.linkendCell=t,this.container.add(s)}unlink(){this.linkendCell=void 0;const t=this.container.getByName("portalMask");this.container.remove(t,!0)}onDestroy(){this.container.destroy(!0),this.clearTimed()}clearTimed(){var t;this.timedCounter=0,null==(t=this.timedText)||t.destroy(),this.scene.events.off("turn",this.updateTurns,this)}isLinked(){return!!this.linkendCell}isTimed(){return!!this.timedCounter}}class T extends B{constructor(t,s,i,n,o,a,r){super(t,s,i,n,o,a,r),e(this,"tile"),this.tile=t.add.image(0,0,"tile").setOrigin(0,0).setScale(this.tileScale).setTintFill(E(this.colors[n].value)),this.container.add(this.tile),this.createTransitionTile(),this.setTileInteractions()}transitionStart(t){this._color=Number(t),this.tile.setTintFill(E(this.colors[t].value))}transitionEnd(){}transitionUpdate(t){}onEnter(){this.transitionTile.setVisible(!0)}onLeave(){this.transitionTile.setVisible(!1)}setColor(t){this._color=t,this.tile.setTintFill(E(this.colors[t].value))}}function E({x:t,y:e,z:s}){return Math.round(255*t)<<16|Math.round(255*e)<<8|Math.round(255*s)}class L extends B{constructor(t,s,i,n,o=0,a,r){super(t,s,i,n,o,a,r),e(this,"newColor"),e(this,"tile"),this.tile=t.add.shader("base",0,0,a,a,["celltexture","cellnoise","cellnoise_d","cellnoise_center"]).setOrigin(0,0),this.tile.setUniform("color.value",this.colors[n].value),this.tile.setUniform("curPoint.value",{x:s,y:i}),this.container.add(this.tile),this.createTransitionTile(),this.setTileInteractions()}transitionStart(t,e){this.newColor=t,this.tile.setUniform("colorToTransform.value",this.colors[t].value),this.tile.setUniform("startPoint.value",e)}transitionEnd(){this._color=this.newColor,this.tile.scale=1,this.tile.depth=1,this.tile.setUniform("transition.value",0),this.tile.setUniform("color.value",this.colors[this.newColor].value)}transitionUpdate(t){this.tile.setUniform("transition.value",t)}onEnter(){this.tile.setUniform("active.value",1)}onLeave(){this.tile.setUniform("active.value",0)}setColor(t){this._color=t,this.tile.setUniform("color.value",this.colors[t].value)}}class M extends B{onEnter(){}onLeave(){}setColor(t){}transitionStart(t){}transitionEnd(){}transitionUpdate(t){}constructor(t,e,s,i,n,o,a){super(t,e,s,i,n,o,a),this.tile=t.add.image(0,0,"blockedTile").setOrigin(0,0).setScale(this.tileScale),this.container.add(this.tile),this.setTileInteractions()}}class O{constructor(t,s){e(this,"scene"),e(this,"container"),e(this,"activeSwap"),e(this,"isPerformanceMode",!1),e(this,"transitionSpeed",800),e(this,"transitionSpeedMinimum",50),e(this,"pendingCalls",0),e(this,"board",[]),e(this,"cellSize"),e(this,"defaultValues"),e(this,"portals"),e(this,"timedCells"),e(this,"timedCellsQueue"),e(this,"history",[]),e(this,"border"),e(this,"gridOptions"),this.scene=t,this.defaultValues=s.board,this.portals=s.portals,this.timedCells=s.timed;const i=y(t);this.gridOptions=i.game.gridOptions,this.loadConfig(),this.calculateCellSize(),this.createBorder(),this.createBoard(s),this.setupTimedCells(s.timed),this.createContainer()}loadConfig(){const{game:{gridOptions:t},gameplay:e}=y(this.scene);this.gridOptions=t,this.transitionSpeed=e.transitionDefault,this.transitionSpeedMinimum=e.transitionMinimum,this.isPerformanceMode=e.performanceMode}calculateCellSize(){const{height:t,width:e,gap:s}=this.gridOptions,i=this.defaultValues.length,n=this.defaultValues[0].length;this.cellSize=Math.min((t-s*(i-1))/i,(e-s*(n-1))/n)}createBorder(){const t=this.defaultValues.length,e=this.defaultValues[0].length,{height:s,width:i,gap:n,borderPadding:o,borderOffset:a}=this.gridOptions,r=i-o-e*(this.cellSize+n),l=s-o-t*(this.cellSize+n);this.border=this.scene.add.nineslice(a.left,a.top,"grid_border",void 0,i-a.right-r,s-a.bottom-l,270,128,s/2.56,s/3).setOrigin(0,0).setTint(this.getColor())}createBoard(t){var e;const{board:s,portals:i}=t,n=s.length,o=s[0].length,{gap:a}=this.gridOptions;this.scene.gameStates.remains=n*o,this.scene.gameStates.initialState.remains=n*o;for(let r=0;r<n;r++)for(let t=0;t<o;t++){const i=s[r][t];this.scene.gameStates.availableColors.add(i);const n=this.createCell(r,t,i,a);(e=this.board)[r]??(e[r]=[]),this.board[r][t]=n,-1!=i&&i!==this.scene.gameStates.targetColor||(this.scene.gameStates.remains--,this.scene.gameStates.initialState.remains--)}for(const{pair:r}of i??[]){const[[t,e],[s,i]]=r,n=this.board[t][e],o=this.board[s][i],a=Math.floor(16777215*Math.random());n&&o&&(n.setLinkedCell(o,a),o.setLinkedCell(n,a))}}setupTimedCells(t){this.timedCellsQueue=[],null==t||t.sort(((t,e)=>e.turns-t.turns));for(const{pos:e,turns:s,color:i}of t??[])this.board[e[0]][e[1]].setTimedCell(s,i),this.timedCellsQueue.push({pos:e,color:i,turns:this.scene.gameStates.initialState.turns-s})}createCell(t,e,s,i){const n=[this.scene,t,e,s,i,this.cellSize,this.cellAction.bind(this)];return-1===s?new M(...n):this.isPerformanceMode?new T(...n):new L(...n)}createContainer(){const{width:t,offset:e}=this.gridOptions,s=this.board.flat().map((t=>t.container));this.container=this.scene.add.container(this.scene.cameras.main.width/2-t/2-e.x,e.y,[this.border,...s])}shouldSkipCell(t,e,s,i,n){var o;const a=null==(o=this.board[t])?void 0:o[e];return!a||a.color===i||a.color!==s||n.has(a)}bfs(t,e,s,i,n,o,a){if(this.shouldSkipCell(t,e,s,i,n))return;const r=this.board[t][e];n.add(r),this.pendingCalls++;const l=Math.max(this.transitionSpeed*Math.pow(.8,o),this.transitionSpeedMinimum);this.startTransitionAnimation(a,r,o,i,l);for(const[c,h]of p)this.scene.time.delayedCall(l,(()=>{this.bfs(t+c,e+h,s,i,n,o+1,a)}));r.linkendCell&&!n.has(r.linkendCell)&&this.scene.time.delayedCall(l,(()=>{this.bfs(r.linkendCell.pos.x,r.linkendCell.pos.y,s,i,n,o+1,a)}))}flip(t,e,s,i=this.scene.gameStates.selectedColor){this.scene.changeGameState(a.Waiting),this.bfs(t,e,s,i,new Set,0,{x:t,y:e})}cellAction(t,e){const{mode:s,state:i,selectedTool:n}=this.scene.gameStates,l=this.board[t][e];if(s===r.Editor){const s=this.scene.gameStates.selectedColor,{gap:i}=this.gridOptions;return-1===s?(l.container.destroy(),this.board[t][e]=this.createCell(t,e,-1,i),void this.container.add(this.board[t][e].container)):-1===l.color?(l.container.destroy(),this.board[t][e]=this.createCell(t,e,s,i),void this.container.add(this.board[t][e].container)):void this.board[t][e].setColor(s)}i!==a.Waiting?n===o.none?-1!==l.color&&l.color!==this.scene.gameStates.selectedColor&&this.flip(t,e,l.color):this.swapSelection(t,e):this.activeSwap&&(this.activeSwap.cancelSwapSelection(),this.activeSwap=void 0)}swapSelection(t,e){this.activeSwap=new k(this.scene,this,t,e)}removeSwapSelection(){this.activeSwap=void 0}getColor(){const{colors:t}=y(this.scene),{x:e,y:s,z:i}=t[this.scene.gameStates.targetColor].value;return Phaser.Display.Color.GetColor(255*e,255*s,255*i)}updateBorderTint(){this.border.clearTint(),this.border.setTint(this.getColor())}resetBoard(){for(let t=0;t<this.defaultValues.length;t++)for(let e=0;e<this.defaultValues[0].length;e++)this.board[t][e].setColor(this.defaultValues[t][e]);this.setupTimedCells(this.timedCells)}startTransitionAnimation(t,e,s,i,n){const o=e.tile,r=e.color,l=e.transitionTile,c=l.scale;this.scene.tweens.chain({targets:null,tweens:[{targets:o,x:{value:()=>o.x+Phaser.Math.Between(-5,5),duration:.1*n,repeat:1},y:{value:()=>o.y+Phaser.Math.Between(-5,5),duration:.1*n,repeat:1},onComplete:()=>l.setVisible(!0).setDepth(10),yoyo:!0,ease:"Sine.easeInOut"},{targets:l,alpha:1,scale:c+.2*c,duration:n/2-10,ease:"Linear"},{targets:l,alpha:0,scale:c+.4*c,duration:n/2-10,ease:"Linear"}],onComplete:()=>{l.setVisible(!1),l.alpha=1,l.scale=c}}),this.scene.tweens.addCounter({from:0,to:1,delay:.5*n,duration:n,ease:"Cubic.InOut",onStart:()=>{this.scene.audioManager.playSFX("tileFlip",{detune:Math.min(50*s,600),volume:s?Math.min(.4,1-.9+.1*s):1}),e.transitionStart(i,t)},onUpdate:t=>e.transitionUpdate(t.getValue()),onComplete:()=>{const t=this.scene.gameStates.targetColor;if(r===t&&this.scene.gameStates.remains++,e.transitionEnd(),e.color===t&&this.scene.gameStates.remains--,this.pendingCalls--,0===this.pendingCalls){for(;this.timedCellsQueue.length>0&&this.timedCellsQueue[this.timedCellsQueue.length-1].turns===this.scene.gameStates.turns;){const{pos:t,color:e}=this.timedCellsQueue.pop();if(this.board[t[0]][t[1]].color!==e)return void this.flip(t[0],t[1],this.board[t[0]][t[1]].color,e)}this.scene.changeGameState(a.Active)}}})}}class I{constructor(t,s){e(this,"container"),e(this,"content");const i=document.createElement("section");i.classList.add("option-folder");const n=document.createElement("div");n.className="option-folder__title folder-title";const o=document.createElement("h2");if(o.classList.add("folder-title__text"),o.textContent=t,n.appendChild(o),s){const t=document.createElement("div");t.classList.add("folder-title__icon"),t.setAttribute("icon",s),n.appendChild(t)}const a=document.createElement("div");a.classList.add("option-folder__content"),this.content=a,i.appendChild(n),i.appendChild(a),this.container=i}add(t){const e=document.createElement("div");e.classList.add("folder-content__item"),e.appendChild(t),this.content.appendChild(e)}}class V{constructor(t,s,i){e(this,"container"),e(this,"radios",[]);const n=document.createElement("div");n.className="switch-container";const o=this.createOption(t.text,t.value,i),a=this.createOption(s.text,s.value,i);this.radios.push(o.radio,a.radio),this.radios[0].checked=!0,n.appendChild(o.label),n.appendChild(a.label),this.container=n}createOption(t,e,s){const i=document.createElement("label");i.className="switch__option";const n=document.createElement("input");return n.setAttribute("type","radio"),n.setAttribute("name","radio-export"),n.setAttribute("value",e),n.checked=!1,i.textContent=t,i.prepend(n),n.addEventListener("change",(function(){this.checked&&s(this.value)})),{label:i,radio:n}}}const _=[];for(let It=0;It<256;++It)_.push((It+256).toString(16).slice(1));let P;const U=new Uint8Array(16),A={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function N(t,e,s){var i;if(A.randomUUID&&!t)return A.randomUUID();const n=(t=t||{}).random??(null==(i=t.rng)?void 0:i.call(t))??function(){if(!P){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");P=crypto.getRandomValues.bind(crypto)}return P(U)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(t,e=0){return(_[t[e+0]]+_[t[e+1]]+_[t[e+2]]+_[t[e+3]]+"-"+_[t[e+4]]+_[t[e+5]]+"-"+_[t[e+6]]+_[t[e+7]]+"-"+_[t[e+8]]+_[t[e+9]]+"-"+_[t[e+10]]+_[t[e+11]]+_[t[e+12]]+_[t[e+13]]+_[t[e+14]]+_[t[e+15]]).toLowerCase()}(n)}class D{constructor(t){e(this,"viewBox"),e(this,"scene"),e(this,"container"),e(this,"share"),e(this,"stringInput"),e(this,"jsonInput"),e(this,"folderString"),e(this,"folderJson"),e(this,"selectedType","string"),this.scene=t,this.container=t.add.container(0,0);const{width:s,height:i}=t.cameras.main,{exportBlock:n}=f(t),o=t.add.rectangle(0,0,s,i,0,.6).setOrigin(0);this.viewBox=t.add.dom(t.cameras.main.width/2-8,0,"div",{width:"1000px",height:`${i}px`,fontSize:"24px",overflow:"auto"}).setOrigin(.5,0);const a=document.createElement("div");a.classList.add("wrapper","export-wrapper"),this.viewBox.node.appendChild(a),this.folderString=new I(n.folders.string),this.folderJson=new I(n.folders.json);const r=document.createElement("textarea");r.classList.add("export__base"),r.disabled=!0,this.folderString.add(r),this.stringInput=r;const l=document.createElement("pre");l.classList.add("export__json"),this.jsonInput=l,this.folderJson.add(l);const c=document.createElement("div");Object.assign(c.style,{display:"flex",justifyContent:"center",gap:"1rem",marginTop:"1rem"});const h=document.createElement("button");h.classList.add("primary-btn"),h.addEventListener("click",(()=>{this.hide()})),h.textContent=n.cancelBtn;const d=document.createElement("button");d.classList.add("primary-btn"),d.addEventListener("click",(()=>{this.copyToClipboard()})),d.textContent=n.copy,c.appendChild(h),c.appendChild(d);const u=new V({text:n.switch.string,value:"string"},{text:n.switch.json,value:"json"},(t=>{this.toggleFolders(t)})),p=document.createElement("div");p.textContent=n.title,p.className="block-title",a.appendChild(p),a.appendChild(u.container),a.appendChild(this.folderString.container),a.appendChild(this.folderJson.container),a.appendChild(c),this.container.add([o,this.viewBox]),this.viewBox.depth=10,this.toggleFolders(this.selectedType),this.hide()}toggleFolders(t){"string"===t?(this.folderString.container.style.display="block",this.folderJson.container.style.display="none"):(this.folderString.container.style.display="none",this.folderJson.container.style.display="block"),this.selectedType=t}copyToClipboard(){navigator.clipboard.writeText("string"===this.selectedType?this.share.base64:this.share.json),this.hide()}createShareData(){var t,e;const s=this.scene.gameStates.mode===r.Endless?this.scene.grid.defaultValues:this.scene.grid.board.map((t=>t.map((t=>t.color)))),i={id:N(),folderName:"generated",categoryName:"generated1"};i.levelData={targetColor:this.scene.gameStates.targetColor,turns:this.scene.gameStates.turns,tools:this.scene.gameStates.availableTools,portals:null==(t=this.scene.editor)?void 0:t.getValues("portal"),timed:null==(e=this.scene.editor)?void 0:e.getValues("timed"),board:s},this.share={json:JSON.stringify(i,null,"\t"),base64:btoa(JSON.stringify(i.levelData,null))}}update(){this.createShareData(),this.stringInput.textContent=this.share.base64,this.jsonInput.textContent=this.share.json}show(){this.scene.input.enabled=!1,this.scene.setGameState(a.Waiting),this.update(),this.container.setVisible(!0)}hide(){this.scene.input.enabled=!0,this.scene.setGameState(a.Active),this.container.setVisible(!1)}}class j{constructor(t,s){e(this,"scene"),e(this,"board"),e(this,"graphics"),e(this,"selectionBox"),e(this,"selectedObjects",[]),e(this,"isSelecting",!1),e(this,"startX"),e(this,"startY"),e(this,"objectList"),this.scene=s,this.board=t;const{selectionBox:i}=s.cache.json.get("config").game;this.graphics=s.add.graphics(i),s.input.on("pointerdown",this.onPointerDown,this),s.input.on("pointermove",this.onPointerMove,this),s.input.on("pointerup",this.onPointerUp,this)}onPointerDown(t){t.x<250||t.x>1400||(this.isSelecting=!0,this.startX=t.x,this.startY=t.y,this.selectionBox=new Phaser.Geom.Rectangle(this.startX,this.startY,0,0))}onPointerMove(t){this.selectionBox&&this.isSelecting&&(this.selectionBox.width=t.x-this.startX,this.selectionBox.height=t.y-this.startY,this.redrawSelectionBox())}onPointerUp(){if(!this.selectionBox)return;if(this.isSelecting=!1,this.graphics.clear(),this.selectionBox=this.normalizeRect(this.selectionBox),this.selectionBox.width<50||this.selectionBox.height<50)return;const t=this.scene.grid.cellSize/2,e=[];for(const s of this.board.flat()){const{x:i,y:n}=s.tile.getWorldPoint(),o=new Phaser.Geom.Point(i+t,n+t);Phaser.Geom.Rectangle.ContainsPoint(this.selectionBox,o)&&(s.onClick(),e.push(s))}this.selectedObjects=e,this.selectionBox=void 0}redrawSelectionBox(){this.selectionBox&&(this.graphics.clear(),this.graphics.fillStyle(0,.4).fillRectShape(this.selectionBox).lineStyle(2,16777215).strokeRectShape(this.selectionBox))}normalizeRect(t){const e=Math.min(t.x,t.x+t.width),s=Math.min(t.y,t.y+t.height),i=Math.abs(t.width),n=Math.abs(t.height);return new Phaser.Geom.Rectangle(e,s,i,n)}destroy(){this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.graphics.destroy()}}class F{constructor(t,s,i){e(this,"scene"),e(this,"container"),this.scene=i,this.container=i.add.container(t,s)}hide(){this.container.setVisible(!1)}show(){this.container.setVisible(!0)}setActive(t){t?this.show():this.hide()}}class z extends F{constructor(t,s,i,n,o,a,r,l){super(t,s,a),e(this,"btn"),e(this,"text"),e(this,"overlay"),this.btn=a.add.nineslice(0,0,"uiatlas","primary",n,o,0,55).setOrigin(.5,.5).setScale(.7),this.overlay=a.add.nineslice(0,0,"uiatlas","primary_over",n,o,0,0).setOrigin(.5,.5).setScale(.7),this.overlay.setVisible(!1),this.btn.setInteractive(),r&&this.btn.on("pointerup",r,l),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),this.text=a.make.text({x:this.btn.x,y:this.btn.y,text:i,style:{color:"#000000",font:"24px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([this.btn,this.overlay,this.text])}onEnter(){this.scene.input.setDefaultCursor("pointer"),this.overlay.setVisible(!0)}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default")}}class R{constructor(t,s,i,n,o){e(this,"container"),e(this,"value");const a=document.createElement("div");a.classList.add(i);const r=document.createElement("label");r.classList.add(n),r.textContent=t;const l=document.createElement("p");l.classList.add(o),l.textContent=s,a.appendChild(r),a.appendChild(l),this.value=l,this.container=a}}class $ extends F{constructor(t){const{width:s,height:i}=t.cameras.main;super(s/2-s/2,i/2-i/2,t),e(this,"scene"),e(this,"nextLevelData"),e(this,"local"),this.scene=t,this.local=f(t).resultScreen,this.scene.cameras.main.postFX.addBlur(1),this.scene.setGameState(a.Waiting);const n=new Date(t.time.now-t.startTime).toISOString().slice(11,19);this.saveRecordAboutLevel(this.scene.gameStates.levelKey,n);const o=t.add.dom(0,0,"div",{width:`${s}px`,height:`${i}px`}).setOrigin(0);o.depth=2;const l=this.createResultContent(o.node,n),c=this.createButtonsBlock(l),h=t.cache.json.get("levels")||[],d=this.scene.gameStates.mode===r.Endless?this.generateNextLevel():!!(this.nextLevelData=function(t,e){if(!t||!(null==e?void 0:e.length))return;const s=e.findIndex((e=>e.id===t));if(-1===s)return;const i=s+1;if(i>=e.length)return;const n=e[i];return n?{mode:r.Play,levelKey:n.id,levelData:n.levelData}:void 0}(this.scene.gameStates.levelKey,h));if(d){const t=this.createPrimaryBtn(this.local.btnNext,(()=>{this.scene.scene.start("LoadingGame",this.nextLevelData)}));c.append(t)}this.scene.input.enabled=!1}generateNextLevel(){const t=this.scene.gameStates.endlessOptions;return!!t&&(this.nextLevelData={mode:r.Endless,levelData:w(t.rows,t.columns,t.colorsCount,t.difficulty),endlessOptions:t},!0)}createResultContent(t,e){const s=document.createElement("div");s.classList.add("wrapper","results-screen__wrapper");const i=document.createElement("div");i.classList.add("result-screen"),s.appendChild(i);const n=document.createElement("div");n.classList.add("result-screen__cleared"),n.textContent=this.local.win;const o=document.createElement("div");o.classList.add("cleared-bg"),n.append(o),i.appendChild(n);const a=document.createElement("div");return a.classList.add("results"),i.appendChild(a),a.appendChild(this.addRecord(this.local.time,e)),this.scene.gameStates.mode===r.Endless&&a.appendChild(this.addRecord(this.local.movesUsed,String(this.scene.gameStates.turns))),t.appendChild(s),s}createButtonsBlock(t){const e=document.createElement("div");e.classList.add("results_buttons");const s=this.createPrimaryBtn(this.local.btnMain,(()=>{this.scene.scene.start("MainMenu")}));if(e.append(s),this.scene.gameStates.mode===r.Endless){const t=this.createPrimaryBtn(this.local.btnShare,(()=>{this.scene.exportBlock.show()}));e.append(t)}return t.appendChild(e),e}createPrimaryBtn(t,e){const s=document.createElement("button");return s.classList.add("primary-btn"),s.textContent=t,s.addEventListener("click",e),s}saveRecordAboutLevel(t,e){if(!t)return;const s=b();s.set(t,{time:e}),localStorage.setItem(`${g}levels.cleared`,JSON.stringify(Array.from(s)))}addRecord(t,e){return new R(t,e,"results__item","results__label","results__value").container}createNextLevelBtn(t,e){this.container.add(new z(t,e,this.local.btnNext,300,50,this.scene,(()=>{this.scene.scene.start("LoadingGame",this.nextLevelData),this.scene.cameras.main.postFX.clear()})).container)}}class G{constructor(t){const e=t.cameras.main.width,s=t.cameras.main.height,{current:i}=y(t).background;if(!i||!t.textures.exists(i.key))return;const n=t.add.shader("distortion",e/2,s/2,e,s,[i.key]);n.setUniform("radius.value",i.distortion?.3:0),n.setUniform("darkOverlay.value",i.overlay?.7:0)}}class K{constructor(t){e(this,"scene"),e(this,"bgm"),e(this,"masterVolume",1),e(this,"sfxVolume",1),e(this,"bgmVolume",1),e(this,"isLocked",!0),this.scene=t,this.loadFromLocalStorage(),t.input.once("pointerup",(()=>{this.isLocked=!1,this.playBGM("bg1")}))}loadFromLocalStorage(){const t=localStorage.getItem(`${g}sound`);if(t)try{const{master:e,bgm:s,sfx:i}=JSON.parse(t);this.masterVolume=e,this.sfxVolume=i,this.bgmVolume=s}catch{console.warn("Failed to parse sound settings from localStorage.")}}saveToLocalStorage(){const t={master:this.masterVolume,sfx:this.sfxVolume,bgm:this.bgmVolume};localStorage.setItem(`${g}sound`,JSON.stringify(t))}playSFX(t,e={}){return!this.isLocked&&this.scene.sound.play(t,{...e,volume:(e.volume??1)*this.sfxVolume*this.masterVolume})}playBGM(t,e={}){this.bgm&&this.bgm.stop(),this.bgm=this.scene.sound.add(t,{loop:!0,...e,volume:(e.volume??1)*this.bgmVolume*this.masterVolume}),this.bgm.play()}setMasterVolume(t){this.masterVolume=t,this.saveToLocalStorage(),this.updateBGMVolume()}setSFXVolume(t){this.sfxVolume=t,this.saveToLocalStorage()}setBGMVolume(t){this.bgmVolume=t,this.saveToLocalStorage(),this.updateBGMVolume()}getMasterVolume(){return this.masterVolume}getBGMVolume(){return this.bgmVolume}getSFXVolume(){return this.sfxVolume}setScene(t){return this.scene=t,this}updateBGMVolume(){var t;(null==(t=this.bgm)?void 0:t.isPlaying)&&this.bgm.setVolume(this.bgmVolume*this.masterVolume)}}let X=class{constructor(t,s,i,n,o,a,r){e(this,"scene"),e(this,"leftButton"),e(this,"rightButton"),e(this,"container"),e(this,"text"),e(this,"value"),this.scene=t,this.container=t.add.container(s,i),this.value=o,this.leftButton=this.createButton(a,{x:-n/2,y:0,scale:.3,angle:180}),this.rightButton=this.createButton(r,{x:n/2,y:0,scale:.3,angle:0}),this.text=t.make.text({x:0,y:0,text:String(this.value),style:{color:"#ffffff",font:"20px OpenSans_Regular"}}).setOrigin(.5,.5),this.container.add([t.add.rectangle(0,0,n,50,1710876,.6),t.add.circle(-n/2,0,25,1710876,.6),t.add.circle(n/2,0,25,1710876,.6),this.leftButton,this.text,this.rightButton])}createButton(t,e){const s=this.scene.add.container(e.x,0),i=this.scene.add.image(0,0,"uiatlas","arrow").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale),n=this.scene.add.image(0,0,"uiatlas","arrow_over").setRotation(Phaser.Math.DegToRad(e.angle)).setScale(e.scale);return n.setVisible(!1),i.setInteractive(),i.on("pointerup",(()=>{this.text.setText(String(t()))})),i.on("pointerover",(()=>{n.setScale(.35),n.setVisible(!0)})),i.on("pointerout",(()=>{n.setScale(.3),n.setVisible(!1)})),s.add([i,n]),s}};class H{constructor(t,s,i,n="btnRound",o="btnRoundOver"){e(this,"scene"),e(this,"btnImage"),e(this,"btnOverlay"),e(this,"container"),e(this,"hotkeyContainer"),e(this,"registeredKeys",[]),this.scene=t,this.container=t.add.container(s,i),this.btnImage=t.add.image(0,0,n),this.btnOverlay=t.add.image(0,0,o),this.btnOverlay.setVisible(!1),this.container.add([this.btnImage,this.btnOverlay])}setInteractive(t,e=()=>!0){this.btnImage.setInteractive(),this.btnImage.on("pointerup",(()=>{e()&&t()})),this.btnImage.on("pointerover",(()=>{e()&&this.btnOverlay.setVisible(!0)})),this.btnImage.on("pointerout",(()=>{var t;(null==(t=this.btnImage.input)?void 0:t.enabled)&&this.btnOverlay.setVisible(!1)}))}setHotkey(t,e,s){const i=this.scene.add.container(0,this.btnImage.y+this.btnImage.height/2),n=this.scene.make.image({x:0,y:0,key:"uiatlas",frame:"hotkey_btn",scale:.3}),o=this.scene.make.text({x:n.x,y:n.y,text:t,style:{color:"#3e3e3e",font:"20px OpenSans_Bold"}}).setOrigin(.5);(Array.isArray(e)?e:[e]).forEach((t=>{var e;const i=null==(e=this.scene.input.keyboard)?void 0:e.addKey(t),n=s||(()=>this.btnImage.emit("pointerup"));i&&(i.on("down",n,this),this.registeredKeys.push(i))})),i.add([n,o]),this.hotkeyContainer=i,this.container.add(i),this.container.once(Phaser.GameObjects.Events.DESTROY,(()=>this.cleanupKeys()))}cleanupKeys(){this.registeredKeys.forEach((t=>{var e,s;null==(s=null==(e=this.scene.input)?void 0:e.keyboard)||s.removeKey(t,!0,!0)})),this.registeredKeys=[]}setSelected(t){this.btnOverlay.setVisible(t)}}class W{constructor(t,s){e(this,"scene"),e(this,"ui"),e(this,"local"),e(this,"editor"),this.scene=t,this.ui=s,this.local=f(t),this.addStaticTexts(),this.createTurnSelector(),this.createExportButton(),this.createTargetColorSelector(),this.createToolsSection(),this.createBlockedTileButton()}addStaticTexts(){this.addText(60,110,this.local.game.ui.movesCount),this.addText(60,200,this.local.game.ui.targetColorEditor),this.addText(60,this.ui.tools.y-80,this.local.game.ui.tools)}addText(t,e,s){this.scene.make.text({x:t,y:e,text:s,style:{color:"#fff",font:"22px OpenSans_Regular"}})}createTurnSelector(){new X(this.scene,this.ui.turnsValueSelector.x,this.ui.turnsValueSelector.y,this.ui.turnsValueSelector.width,this.scene.gameStates.turns,(()=>(this.scene.gameStates.turns=Math.max(1,this.scene.gameStates.turns-1),this.scene.gameStates.turns)),(()=>(this.scene.gameStates.turns=Math.min(50,this.scene.gameStates.turns+1),this.scene.gameStates.turns)))}createExportButton(){new z(150,850,this.local.game.ui.export,300,50,this.scene,(()=>this.scene.exportBlock.show()))}createTargetColorSelector(){new X(this.scene,this.ui.targetValueSelector.x,this.ui.targetValueSelector.y,this.ui.targetValueSelector.width,d(this.scene.gameStates.targetColor,this.scene.colors),(()=>this.scene.changeTargetColor(-1)),(()=>this.scene.changeTargetColor(1)))}createToolsSection(){const{game:{ui:t}}=y(this.scene);t.tools.options.forEach(((t,e)=>{this.addText(60,this.ui.tools.y+80*e-50,this.local.game.tools[t.textKey]),new X(this.scene,this.ui.tools.x,this.ui.tools.y+80*e,this.ui.targetValueSelector.width,this.scene.gameStates.availableTools[e],(()=>(this.scene.gameStates.availableTools[e]=Phaser.Math.Clamp(this.scene.gameStates.availableTools[e]-1,0,100),this.scene.gameStates.availableTools[e])),(()=>(this.scene.gameStates.availableTools[e]=Phaser.Math.Clamp(this.scene.gameStates.availableTools[e]+1,0,100),this.scene.gameStates.availableTools[e])))}))}createBlockedTileButton(){const t=new H(this.scene,0,500,"blockedTile","blockedTileOver");t.setHotkey("0",["NUMPAD_ZERO","ZERO"]),t.setInteractive((()=>{this.scene.changeSelectedColor(-1),this.scene.audioManager.playSFX("colorSelect")})),this.scene.btnContainer.add(t.container)}}class J{constructor(t,s){e(this,"scene"),e(this,"ui"),this.scene=t,this.ui=s,this.createTurnCounter(),this.createTargetColorDisplay(),this.createResetButton()}createTurnCounter(){const{scene:t}=this,e=f(t);t.add.rectangle(50,100,230,40,0,.8).setOrigin(0);const s=t.make.text({x:60,y:110,text:t.gameStates.mode===r.Endless?e.game.ui.movesUsed:e.game.ui.movesRemain,style:{color:"#fff",font:"22px OpenSans_Regular"}});t.turnCounter=t.make.text({x:s.x+s.width+5,y:s.y-5,text:`${t.gameStates.turns}`,style:{color:"#ffcd3f",font:"26px OpenSans_ExtraBold"}})}createTargetColorDisplay(){const{scene:t,ui:e}=this,s=f(t),i=t.gameStates.targetColor,n=t.colors[i],o=t.add.rectangle(e.targetUI.x-100,e.targetUI.y-10,550,50,0,.8).setOrigin(0),a=t.make.text({x:e.targetUI.x,y:e.targetUI.y,text:s.game.ui.targetColor,style:{color:"#cbcbcc",font:"30px OpenSans_Regular"}}),r=t.make.text({x:a.x+a.width+5,y:a.y,text:this.formatColorName(n.colorName),style:{color:`rgb(${255*n.value.x}, ${255*n.value.y}, ${255*n.value.z})`,font:"30px OpenSans_Regular"}});o.displayWidth=a.width+r.width+120}createResetButton(){const{scene:t}=this,e=f(t),{resetBtn:s}=t.cache.json.get("config").game.ui,i=new H(t,t.btnContainer.x,t.cameras.main.height-140);i.setInteractive((()=>{t.gameStates.state!==a.Waiting&&t.resetGame()})),i.setHotkey("R","R"),i.btnImage.setTexture("uiatlas","reset"),i.btnOverlay.setTexture("uiatlas","reset_over"),i.container.setScale(.8);const n=t.make.text({...s.text,text:e.game.ui.resetBtn,x:0,y:0});n.setPosition(n.width,0),i.hotkeyContainer.add(n),i.hotkeyContainer.setPosition(i.hotkeyContainer.x-32,i.hotkeyContainer.y+20)}formatColorName(t){return t.charAt(0).toUpperCase()+t.slice(1)}}const Z={0:"NUMPAD_ZERO,ZERO",1:"NUMPAD_ONE,ONE",2:"NUMPAD_TWO,TWO",3:"NUMPAD_THREE,THREE",4:"NUMPAD_FOUR,FOUR",5:"NUMPAD_FIVE,FIVE",6:"NUMPAD_SIX,SIX",7:"NUMPAD_SEVEN,SEVEN",8:"NUMPAD_EIGHT,EIGHT",9:"NUMPAD_NINE,NINE"};class Q extends H{constructor(t,s,i,n,o,a,r){super(t,s,i),e(this,"color"),e(this,"pointer"),this.container.removeAll(!0);const l=t.add.circle(0,0,n/2+5,16053492).setVisible(!1),c=t.add.shader("base",0,0,n,n);c.setUniform("color.value",o[1]),c.setUniform("radius.value",.5),c.setChannel0("celltexture");const h=t.add.triangle(n/2+20,10,-5,0,10,10,10,-10,16777215);h.setVisible(!1),this.container.add([l,c,h]);const d=Z[a];this.setHotkey(a.toString(),d.split(","),(()=>c.emit("pointerup"))),this.hotkeyContainer.y-=15,this.color=o,this.pointer=h,c.setInteractive(),c.on("pointerup",this.onClick,this),c.on("pointerover",this.onEnter,this),c.on("pointerout",this.onLeave,this),t.tweens.add({targets:h,duration:1e3,x:"+=10",yoyo:!0,repeat:-1}),r&&r.add(this.container),this.btnOverlay=l,this.update()}onEnter(){this.scene.audioManager.playSFX("mouseOver"),this.btnOverlay.setVisible(!0)}onLeave(){this.scene.gameStates.selectedColor!==this.color[0]&&this.btnOverlay.setVisible(!1)}onClick(){this.scene.changeSelectedColor(this.color[0]),this.scene.audioManager.playSFX("colorSelect")}update(){const t=this.scene.gameStates.selectedColor===this.color[0];this.btnOverlay.setVisible(t),this.pointer.setVisible(t)}}class Y{constructor(t){e(this,"container"),e(this,"background"),e(this,"label");const{scene:s,x:i,y:n,text:o,style:a,padding:r=20,radius:l=15,backgroundColor:c=0,backgroundAlpha:h=1,borderColor:d=16777215,borderThickness:u=0}=t,p=s.add.text(0,0,o,{...a}).setOrigin(.5),m=p.width+2*r,g=p.height+r,v=t.key??`textbox-${m}x${g}-${c}-${d}-${u}`;if(!s.textures.exists(v)){const t=s.add.graphics();t.fillStyle(c,h),u>0&&(t.lineStyle(u,d),t.strokeRoundedRect(0,0,m,g,l)),t.fillRoundedRect(0,0,m,g,l),t.generateTexture(v,m,g),t.destroy()}const f=s.add.image(0,0,v).setOrigin(.5),y=s.add.container(i,n,[f,p]);this.container=y,this.background=f,this.label=p}setText(t){return this.label.setText(t),this}setVisible(t){return this.container.setVisible(t),this}destroy(){this.container.destroy()}}class q extends H{constructor(t,s,i,n,o,a){super(t,s,i),e(this,"scene"),e(this,"icon"),e(this,"currentCountText"),e(this,"toolKey"),e(this,"localText"),e(this,"initialCount"),e(this,"currentCount"),e(this,"isSelected",!1);const{game:{ui:r}}=f(t),{ui:{tools:l}}=y(t).game;this.scene=t,this.toolKey=a,this.localText=r.toolUses,this.initialCount=n,this.currentCount=n;const{textureKey:c,...h}=l.options[a];this.btnImage.setTintFill(0).setAlpha(.3),this.btnOverlay.setTintFill(0).setAlpha(.3),this.icon=t.make.image({key:c,...h.props}).setScale(.6).setTintFill(16777215).setAlpha(.8);const d=new Y({scene:this.scene,x:0,y:-55,padding:10,style:{stroke:"#000000",fontSize:"18px",fontStyle:"900",fontFamily:"Segoe UI, Arial, sans-serif",strokeThickness:2},text:`${this.currentCount}/${this.initialCount}`,backgroundColor:7633790});this.currentCountText=d.label,this.container.add([this.icon,d.container]),this.setInteractive((()=>this.onClick()),(()=>this.currentCount>0)),this.container.setScale(.8),this.setHotkey(o,o)}onClick(){if(this.scene.grid.activeSwap)return this.scene.grid.activeSwap.cancelSwapSelection(),void this.scene.changeSelectedTool(o.none);0!==this.currentCount&&(this.isSelected?this.deselect():this.select())}select(){this.scene.audioManager.playSFX("colorSelect"),this.scene.changeSelectedTool(this.toolKey),this.isSelected=!0,this.icon.setTintFill(16764223),this.setSelected(!0)}deselect(){this.scene.audioManager.playSFX("colorSelect",{detune:100}),this.scene.changeSelectedTool(o.none),this.isSelected=!1,this.icon.setTintFill(16777215),this.setSelected(!1)}update(){this.isSelected=this.scene.gameStates.selectedTool===this.toolKey,this.setSelected(this.isSelected),this.isSelected||this.icon.setTintFill(16777215),this.currentCountText.setText(`${this.currentCount}/${this.initialCount}`)}reset(){this.currentCount=this.initialCount,this.update()}decrease(){this.currentCount--,this.update()}}class tt{constructor(t){e(this,"scene"),e(this,"ui"),this.scene=t,this.ui=y(t).game.ui;const s=f(t);t.gameStates.mode!==r.Editor&&t.gameStates.availableTools&&this.createToolButtons(),this.createColorButtons(),this.createCloseButton(),this.createTriangles(),t.time.delayedCall(50,(()=>{this.createTitle(s.game.ui.mode)}))}createCloseButton(){const{scene:t,ui:e}=this,s=e.closeBtn,i=t.add.image(t.cameras.main.width-s.offset.x,s.offset.y,"uiatlas","close").setScale(s.scale).setInteractive();i.on("pointerup",(()=>{t.cameras.main.fadeOut(u,0,0,0),t.time.delayedCall(u,(()=>t.scene.start("MainMenu")))})),i.on("pointerover",(()=>i.setScale(s.scale+.1))),i.on("pointerout",(()=>i.setScale(s.scale)))}createColorButtons(){const{scene:t}=this,{colorButtons:e}=this.ui,{colors:s}=y(t),i=e.size,n=t.gameStates.mode===r.Editor;t.gameStates.availableColors.add(t.gameStates.targetColor),Object.entries(s).filter((([e])=>n||t.gameStates.availableColors.has(Number(e)))).forEach((([s,{value:n}],o)=>{const a=Number(s),r=o%4,l=o>=4?i+2*e.gap:0,c=r*(i+e.gap),h=new Q(t,l,c,i,[a,n],o+1,t.btnContainer);t.colorSelectionButtons.push(h)})),t.btnContainer.y-=t.colorSelectionButtons.length*i/4}createToolButtons(){var t;const{scene:e}=this,s=this.ui.tools;let i=0;null==(t=e.gameStates.availableTools)||t.forEach(((t,n)=>{if(0===t)return;const o=new q(e,s.x,s.y+i*s.offset,t,s.options[n].hotkey,n);e.toolsButtons.push(o),i++}))}createTitle(t){const{scene:e}=this,s=e.add.image(60,50,"uiatlas","icon").setScale(.5).setOrigin(0);e.make.text({x:s.x+50,y:s.y,text:"Overflowing Palette"+(e.gameStates.mode===r.Editor?` | ${t}`:""),style:{color:"#ab9c6b",font:"26px OpenSans_Bold"}})}createTriangles(){const{scene:t}=this,{targetUI:e}=this.ui,s=[0,30,-20,0,20,0],i=[80,0,25,-15,0,15,0,9733196],n=[0,-20,-10,0,10,0,16777215,.2];t.add.triangle(e.x-45,e.y+15,...s,16777215),t.add.triangle(e.x-5,e.y+15,...s,9733196),t.add.triangle(t.btnContainer.x-10,...i),t.add.triangle(t.btnContainer.x+20,...i),t.add.triangle(t.btnContainer.x+10,t.cameras.main.height-240,...n),t.add.triangle(t.btnContainer.x+10,t.cameras.main.height-220,...n)}}class et{constructor(t,s){e(this,"scene"),e(this,"manager"),e(this,"board"),e(this,"tileSize"),e(this,"container"),this.scene=t,this.manager=s,this.board=t.grid.board,this.tileSize=t.grid.cellSize,this.container=this.scene.add.container(this.scene.grid.container.x,this.scene.grid.container.y),this.renderBoard(),this.container.setVisible(!1)}setVisible(t){this.container.setVisible(t)}renderBoard(){const t=this.board.length,e=this.board[0].length,s=this.scene.cache.json.get("config").game.gridOptions.gap;for(let n=0;n<t;n++)for(let t=0;t<e;t++){const e=t*(this.tileSize+s),o=n*(this.tileSize+s),a=this.scene.add.rectangle(e,o,this.tileSize,this.tileSize,11184810).setOrigin(0).setInteractive({useHandCursor:!0}).setBlendMode(i.BlendModes.MULTIPLY);a.on("pointerover",(()=>a.setFillStyle(13421772))),a.on("pointerout",(()=>a.setFillStyle(11184810))),a.on("pointerdown",(()=>this.handleTileClick(n,t))),this.container.add(a)}}}class st extends et{constructor(t,s){super(t,s),e(this,"portals",[]),e(this,"selected",[]),e(this,"selectionUI"),this.portals=t.grid.portals??[]}handleTileClick(t,e){const s=[t,e];this.tryRemoveExistingPortal(s)||this.manager.isCellAvailable(s)&&(1===this.selected.length&&s[0]===this.selected[0][0]&&s[1]===this.selected[0][1]||(this.selected.push(s),2===this.selected.length&&this.createPortalFromSelection()))}tryRemoveExistingPortal(t){const e=this.portals.findIndex((({pair:e})=>e.some((e=>e[0]===t[0]&&e[1]===t[1]))));if(-1!==e){const[t]=this.portals.splice(e,1);return this.unlink(t.pair[0],t.pair[1]),this.selected=[],!0}return!1}createPortalFromSelection(){const[t,e]=this.selected;this.portals.push({pair:[t,e]}),this.link(t,e),this.selected=[]}link(t,e){this.board[t[0]][t[1]].setLinkedCell(this.board[e[0]][e[1]]),this.board[e[0]][e[1]].setLinkedCell(this.board[t[0]][t[1]])}unlink(t,e){this.board[t[0]][t[1]].unlink(),this.board[e[0]][e[1]].unlink()}isCellAvailable(t,e){return this.board[t][e].isLinked()}clearPortals(){for(const{pair:[t,e]}of this.portals)this.unlink(t,e);this.portals=[],this.selected=[]}getValues(){return this.portals}}class it extends et{constructor(t,s){super(t,s),e(this,"timedCells"),e(this,"turnsCount",1),this.timedCells=t.grid.timedCells??[],this.createTurnAndColorUI()}createTurnAndColorUI(){const t=this.scene.add.dom(850,-60).createFromHTML('\n      <div style="display: flex; gap: 10px; align-items: center;">\n        <input type="number" class="card timed-cell-turn" id="turnsCount" value="1" min="1"/>\n      </div>\n    ');t.getChildByID("turnsCount").addEventListener("input",(t=>{this.turnsCount=parseInt(t.target.value)})),this.container.add(t)}handleTileClick(t,e){const s=[t,e],i=this.board[t][e];i.isTimed()?this.removeTimedCell(s):this.manager.isCellAvailable(s)&&(i.setTimedCell(this.turnsCount,this.scene.gameStates.selectedColor),this.timedCells.push({pos:s,turns:this.turnsCount,color:this.scene.gameStates.selectedColor}))}removeTimedCell(t){var e,s;const i=this.timedCells.findIndex((e=>e.pos[0]===t[0]&&e.pos[1]===t[1]));-1!==i&&(null==(s=(e=this.board[t[0]][t[1]]).clearTimed)||s.call(e),this.timedCells.splice(i,1))}isCellAvailable(t,e){return this.board[t][e].isTimed()}clearTimedCells(){var t,e;for(const{pos:s}of this.timedCells)null==(e=(t=this.board[s[0]][s[1]]).clearTimed)||e.call(t);this.timedCells=[]}getValues(){return this.timedCells}}class nt{constructor(t){e(this,"scene"),e(this,"editors"),e(this,"activeEditorKey","portal"),e(this,"openerBtn"),e(this,"modeSwitcher"),e(this,"container"),this.scene=t,this.editors={portal:new st(t,this),timed:new it(t,this)},this.container=t.add.container(0,0).setVisible(!1),this.createOpener(),this.createModeSwitcher(),this.container.add(this.modeSwitcher),this.showEditor(this.activeEditorKey)}createOpener(){const t=this.scene.cameras.main.height-140,e=new H(this.scene,this.scene.btnContainer.x,t);e.container.setScale(.8);const s=this.scene.add.image(0,0,"portalMask").setTintFill(0).setScale(1.4);e.container.add(s),e.setInteractive((()=>this.toggleEditorUI())),e.setHotkey("E","E"),this.openerBtn=e}createModeSwitcher(){this.modeSwitcher=this.scene.add.dom(this.scene.cameras.main.width/2,60).createFromHTML('\n      <div class="card tab-wrapper">\n        <div id="portalTab" class="tab">Portal</div>\n        <div id="timedTab" class="tab">Timed</div>\n      </div>\n    '),["portal","timed"].forEach((t=>{const e=this.modeSwitcher.getChildByID(`${t}Tab`);null==e||e.addEventListener("click",(()=>this.switchToEditor(t)))})),this.updateTabClasses(this.activeEditorKey)}switchToEditor(t){this.showEditor(t),this.updateTabClasses(t)}updateTabClasses(t){["portal","timed"].forEach((e=>{const s=this.modeSwitcher.getChildByID(`${e}Tab`);null==s||s.classList.toggle("active",e===t)}))}toggleEditorUI(){const t=!this.container.visible;this.container.setVisible(t),Object.values(this.editors).forEach((t=>{t.container.setVisible(!1)})),t&&this.showEditor(this.activeEditorKey)}showEditor(t){this.activeEditorKey=t,Object.entries(this.editors).forEach((([e,s])=>{s.container.setVisible(e===t&&this.container.visible)}))}getValues(t){var e;return(null==(e=this.editors[t])?void 0:e.getValues())??[]}isCellAvailable(t){return!Object.entries(this.editors).some((([e,s])=>{var i;return e!==this.activeEditorKey&&(null==(i=s.isCellAvailable)?void 0:i.call(s,t[0],t[1]))}))}}class ot extends i.Scene{constructor(){super("Game"),e(this,"grid"),e(this,"colorSelectionButtons"),e(this,"toolsButtons"),e(this,"btnContainer"),e(this,"gameStates"),e(this,"turnCounter"),e(this,"selectionBox"),e(this,"editor"),e(this,"audioManager"),e(this,"notification"),e(this,"startTime"),e(this,"colors"),e(this,"exportBlock")}create({mode:t,levelKey:e,levelData:s,endlessOptions:i}){const{colors:n}=y(this),{game:{ui:o}}=f(this);this.colors=n,this.toolsButtons=[],new G(this),this.initGame(t,s,e??""),this.initAudioManager(),t===r.Editor&&(this.editor=new nt(this),this.selectionBox=new j(this.grid.board,this)),t==r.Endless&&(this.gameStates.endlessOptions=i,new z(1250,990,o.skipBtn,350,50,this,(()=>{this.scene.start("LoadingGame",{mode:t,levelKey:e,levelData:w(i.rows,i.columns,i.colorsCount,i.difficulty),endlessOptions:i})}))),this.initTextUI(),new tt(this),this.exportBlock=new D(this),this.startTime=this.time.now,this.cameras.main.fadeIn(u,0,0,0)}initAudioManager(){var t;const e=this.registry.get("audioManager");this.audioManager=(null==(t=null==e?void 0:e.setScene)?void 0:t.call(e,this))??new K(this),this.registry.set("audioManager",this.audioManager)}changeGameState(t){if(this.gameStates.state===t)return;const e=this.gameStates.mode===r.Endless;if(t===a.Waiting)return this.gameStates.turns=e?this.gameStates.turns+1:this.gameStates.turns-1,this.turnCounter.text=String(this.gameStates.turns),this.gameStates.state=a.Waiting,void this.events.emit("turn",this.gameStates.turns);if(t===a.Active){if(0===this.gameStates.remains)return this.gameStates.state=a.Waiting,void new $(this);e||0!==this.gameStates.turns||this.resetGame(),this.gameStates.state=a.Active}}setGameState(t){this.gameStates.state=t}changeSelectedColor(t){this.gameStates.selectedColor=t,this.colorSelectionButtons.forEach((t=>t.update()))}initGame(t,e,s){const i={levelKey:s,turns:e.turns,targetColor:e.targetColor,availableTools:e.tools??[0,0,0],selectedColor:n.red,availableColors:new Set,state:a.Active,remains:0,mode:t,initialState:{turns:e.turns,remains:0},selectedTool:o.none};this.gameStates=i,this.grid=new O(this,e),this.colorSelectionButtons=[],this.btnContainer=this.add.container(1500,400,[])}changeSelectedTool(t){var e;if(this.gameStates.selectedTool!==t){if(null==(e=this.notification)||e.destroy(),t!==o.none){const{game:{ui:t}}=f(this),{width:e}=this.cameras.main,s=this.add.container(e/2,100);this.notification=s;const i=this.add.rectangle(0,0,300,60,0,.4),n=this.add.text(0,0,t.toolSelected,{font:"24px OpenSans_Bold"}).setOrigin(.5);this.notification.add(i),this.notification.add(n),i.displayWidth=n.width+30}this.gameStates.selectedTool=t,this.toolsButtons.forEach((t=>t.update()))}}useTool(t){var e;null==(e=this.toolsButtons.find((e=>e.toolKey===t)))||e.decrease()}resetGame(){this.audioManager.playSFX("reset"),this.grid.resetBoard();const{initialState:t}=this.gameStates;this.gameStates.turns=t.turns,this.gameStates.remains=t.remains,this.turnCounter.text=String(this.gameStates.turns),this.gameStates.state=a.Active,this.toolsButtons.forEach((t=>t.reset()))}initTextUI(){const{game:{ui:t}}=y(this);this.gameStates.mode==r.Editor?new W(this,t):new J(this,t)}changeTargetColor(t){let e=h(t,this.gameStates.targetColor);return this.gameStates.targetColor=e,this.grid.updateBorderTint(),d(e,this.colors)}}class at{constructor(t){e(this,"bgShader"),e(this,"textShader");const s=t.cameras.main.width,i=t.cameras.main.height,n=f(t),o=t.add.shader("loading",0,0,s,i,["celltexture","cellnoise"]).setOrigin(0);t.add.tileSprite(0,0,s,i,"cellMask").setOrigin(0).setTileScale(1.15);const a={x:s/2,y:i/2,text:(null==n?void 0:n.loading)??"LOADING"};t.make.text({...a,style:{font:"bold 16rem Cinzel",stroke:"#000000",strokeThickness:10}}).setOrigin(.5);const r=t.make.text({...a,style:{font:"bold 16rem Cinzel",color:"#ffffff"}}).setOrigin(.5),l=t.add.bitmapMask(r),c=t.add.shader("loading",0,0,s,i,["celltexture","cellnoise"]).setOrigin(0).setMask(l);c.setUniform("isSimple.value",1),o.setUniform("transition.value",1.1),c.setUniform("transition.value",1.1),this.bgShader=o,this.textShader=c,t.cameras.main.postFX.addVignette(.5,.5,.68,.5)}}class rt extends i.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"glsl",key:"loading",url:"assets/shaders/loading.glsl"},{type:"image",key:"cellMask",url:"assets/textures/shaders/cellMask.png"},{type:"image",key:"celltexture",url:"assets/textures/shaders/celltexture.webp"},{type:"image",key:"cellnoise",url:"assets/textures/shaders/cellnoise.webp"},{type:"json",key:"langs",url:"assets/data/langs.json"}]}})}preload(){const t=this.cameras.main.width,e=this.cameras.main.height;this.cache.shader.get("loading").uniforms={...v,screenResolution:{type:"2f",value:{x:t,y:e}}},this.loadLocalization(),this.showLoading(),this.cameras.main.fadeIn(300,0,0,0),this.load.pack("assets_pack","assets/data/assets.json"),this.cache.json.exists("config")||this.load.json("config","assets/data/config.json")}create(){const t=this.cameras.main.width,e=this.cameras.main.height;this.loadDefaultLocalColors(),this.loadUserConfig("colors",lt),this.loadUserConfig("background"),this.loadUserConfig("gameplay"),this.initShaderConfig({x:t,y:e}),this.cameras.main.fadeOut(300,0,0,0),this.time.delayedCall(300,(()=>{this.scene.start("MainMenu")}))}loadLocalization(){this.cache.json.remove("localization");const t=this.cache.json.get("langs"),e=C();this.load.json("localization",t[e].path)}loadDefaultLocalColors(){const t=y(this),e=f(this);t.colors=Object.fromEntries(Object.entries(t.colors).map((([t,s])=>[t,{...s,colorName:e.colors[Number(t)]}])))}initShaderConfig(t){const e=this.cache,s=e.shader.get("base"),{shaders:i,gameplay:n}=y(this);s.uniforms={...i.base.init,lightenFactor:{type:"1f",value:n.fluidColors?.2:1},activeOffset:{type:"2f",value:{x:n.highlightIntensity?0:.4,y:.7}},screenResolution:{type:"2f",value:t}};const o=e.shader.get("distortion");o.uniforms={...o.uniforms,darkOverlay:{type:"1f",value:.7},radius:{type:"1f",value:.3}}}loadUserConfig(t,e){const s=y(this),i=localStorage.getItem(`${g}${t}`);if(!i)return;const n=JSON.parse(i);e&&!e(n)||(s[t]={...s[t],...n})}showLoading(){const t=this,e=this.load,s=t.cameras.main.width,i=t.cameras.main.height,n=new at(this),o=t.make.text({x:s/2,y:i-150,text:"0%",style:{font:"2rem cinzel",color:"#ffffff"}});o.setOrigin(.5,.5);const a=t.make.text({x:s/2,y:i-100,text:"",style:{font:"2rem cinzel",color:"#ffffff"}});a.setOrigin(.5,.5),n.bgShader.setUniform("transition.value",-.1),n.textShader.setUniform("transition.value",-.1),e.on("progress",(function(t){o.setText(100*t+" %"),n.bgShader.setUniform("transition.value",t),n.textShader.setUniform("transition.value",t)})),e.on("fileprogress",(function(t){a.setText(`Loading asset: ${t.src}`)})),e.on("complete",(()=>{n.bgShader.setUniform("transition.value",1.1),n.textShader.setUniform("transition.value",1.1)}))}}const lt=t=>{var e;return"object"==typeof t&&null!==t&&(null==(e=Object.entries(t))?void 0:e.every((([,t])=>"object"==typeof t&&null!=t&&"colorName"in t&&"value"in t)))};class ct extends F{constructor({key:t,x:s,y:i,scene:n,width:o,height:a}){super(s,i,n),e(this,"key"),e(this,"width"),e(this,"height"),e(this,"defaultPos"),e(this,"actionBtn"),e(this,"viewBox"),e(this,"contentContainer"),this.key=t,this.defaultPos={x:s,y:i},this.width=o,this.height=a;const{mainMenu:r}=f(n);this.viewBox=n.add.dom(0,0,"div",{width:`${o}px`,height:`${a}px`,fontSize:"24px",overflow:"auto"}).setOrigin(0),this.contentContainer=document.createElement("div"),this.viewBox.node.append(this.contentContainer),this.container.setVisible(!1),this.container.add(n.add.rectangle(0,0,o,a,0,.6).setOrigin(0,0));const l=n.add.rectangle(s,i,o,a,16777215).setOrigin(0,0).setVisible(!1).createGeometryMask();this.container.setMask(l),this.actionBtn=new z(o-140,a-50,r.startBtn,350,0,n),this.actionBtn.container,this.container.add([this.viewBox,this.actionBtn.container])}destroy(){this.contentContainer.remove()}show(){this.container.visible||(this.container.setVisible(!0),this.scene.tweens.add({duration:u,targets:this.container,x:{from:this.defaultPos.x-100,to:this.defaultPos.x},alpha:{from:0,to:1},yoyo:!1}))}hide(t){const e=this.container.x;this.scene.tweens.add({duration:t?0:u,targets:this.container,x:{from:this.defaultPos.x,to:this.defaultPos.x-100},alpha:{from:1,to:0},onComplete:()=>{this.container.setVisible(!1),this.container.setX(e)}})}}class ht{constructor(t,s,i,n){e(this,"container"),e(this,"value"),e(this,"options"),e(this,"isCycle"),e(this,"leftBtn"),e(this,"rightBtn"),e(this,"text"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s;const o=document.createElement("span");o.classList.add("value-selector__label"),o.textContent=t;const a=document.createElement("div");a.classList.add("value-selector__input-wrapper");const r=this.createButton();r.classList.add("value-selector__button--left"),r.addEventListener("click",(()=>{this.update(i())}));const l=document.createElement("span");l.classList.add("value-selector__value"),l.textContent=String(s);const c=this.createButton();c.addEventListener("click",(()=>{this.update(n())})),this.leftBtn=r,this.rightBtn=c,this.text=l,a.appendChild(r),a.appendChild(l),a.appendChild(c),this.container.appendChild(o),this.container.appendChild(a)}createButton(){const t=document.createElement("button");t.classList.add("value-selector__button");const e=document.createElement("div");return e.classList.add("icon"),t.appendChild(e),t}update(t){this.text.textContent=String(t)}}class dt{constructor(t,s,i,n,o){e(this,"container"),e(this,"value"),e(this,"options"),e(this,"isCycle"),e(this,"leftBtn"),e(this,"rightBtn"),e(this,"text"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s,this.options=i,this.isCycle=n;const a=document.createElement("span");a.classList.add("value-selector__label"),a.textContent=t;const r=document.createElement("div");r.classList.add("value-selector__input-wrapper");const l=this.createButton();l.classList.add("value-selector__button--left"),l.addEventListener("click",(()=>{this.back(),this.update(),o(this.value)}));const c=document.createElement("span");c.classList.add("value-selector__value"),c.textContent=String(this.options[s]);const h=this.createButton();h.addEventListener("click",(()=>{this.forward(),this.update(),o(this.value)})),this.leftBtn=l,this.rightBtn=h,this.text=c,r.appendChild(l),r.appendChild(c),r.appendChild(h),this.container.appendChild(a),this.container.appendChild(r),this.update()}createButton(){const t=document.createElement("button");t.classList.add("value-selector__button");const e=document.createElement("div");return e.classList.add("icon"),t.appendChild(e),t}update(){this.rightBtn.disabled=!this.isCycle&&this.value===this.options.length-1,this.leftBtn.disabled=!this.isCycle&&0===this.value,this.text.textContent=this.options[this.value]}getValue(t){const e=this.options.length-1;return this.isCycle?(t+e)%e:Phaser.Math.Clamp(t,0,e)}forward(){this.value=this.getValue(this.value+1)}back(){this.value=this.getValue(this.value-1)}}class ut{constructor(t,s,i){e(this,"scene"),e(this,"container"),e(this,"turnsText"),e(this,"tartgetColorText"),e(this,"author"),e(this,"gridSize"),e(this,"clearedBlock"),this.scene=i;const{previewBlock:n}=f(i),o=i.add.dom(t,s,"div",{width:"420px",height:"500px",fontSize:"24px",overflow:"auto"}).setOrigin(0);this.container=o;const a=document.createElement("div");a.classList.add("info-block"),o.node.append(a),this.tartgetColorText=this.addRecord(n.targetColor,"red"),this.turnsText=this.addRecord(n.moves,"0"),this.author=this.addRecord(n.author,""),this.gridSize=this.addRecord(n.gridSize,""),this.clearedBlock=new pt(n),this.clearedBlock.hide(),a.appendChild(this.turnsText),a.appendChild(this.tartgetColorText),a.appendChild(this.author),a.appendChild(this.gridSize),a.appendChild(this.clearedBlock.container)}addRecord(t,e,s){return new R(t,e,s??"preview-item","preview-item__label","preview-item__value").container}update(t,e,s){const{colors:i}=y(this.scene);this.tartgetColorText.childNodes[1].textContent=`${i[e.targetColor].colorName}`;const{x:n,y:o,z:a}=i[e.targetColor].value;this.tartgetColorText.childNodes[1].style.color=Phaser.Display.Color.RGBToString(255*n,255*o,255*a),this.turnsText.childNodes[1].textContent=t,this.gridSize.childNodes[1].textContent=`${e.board[0].length}x${e.board.length} `,e.author?(this.author.style.display="flex",this.author.childNodes[1].textContent=e.author):this.author.style.display="none",s?(this.clearedBlock.show(),this.clearedBlock.time.textContent=s.time):this.clearedBlock.hide()}hide(){this.container.setVisible(!1)}}class pt{constructor(t){e(this,"container"),e(this,"time");const s=document.createElement("div"),i=document.createElement("p");i.classList.add("preview-item-cleared"),i.textContent=t.cleared;const n=new R(t.time,t.timeDefault,"preview-item","preview-item__label","preview-item__value");s.appendChild(i),s.appendChild(n.container),this.time=n.value,this.container=s}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}}const mt=50;class gt extends F{constructor(t,s,i){super(t,s,i),e(this,"graphics"),this.graphics=i.add.graphics(),this.container.add(this.graphics)}updatePreview(t){const{selectedLevelInfo:e}=this.scene.cache.json.get("config").mainMenu.levelSelection,{colors:s}=y(this.scene),i=t.length,n=t[0].length,o=n*e.previewBlock.cellSize,a=i*e.previewBlock.cellSize,r=e.previewBlock.width/o,l=e.previewBlock.height/a,h=Math.min(r,l),d=this.graphics;d.setScale(h),this.container.setPosition((e.previewBlock.width-o*h)/2,this.container.y),d.clear();for(let u=0;u<i;u++)for(let e=0;e<n;e++){const i=e*mt,n=u*mt,o=t[u][e];if(-1===o)vt(d,i,n);else{const t=s[o].value;ft(d,i,n,c(t))}}}}function vt(t,e,s){t.fillStyle(0),t.lineStyle(4,0),t.lineBetween(e,s,e+mt,s+mt),t.lineBetween(e,s+mt,e+mt,s),t.strokeRect(e,s,46,46)}function ft(t,e,s,i){t.fillStyle(i),t.fillRect(e,s,mt,mt)}class yt extends F{constructor(t,s,i,n,o,a){super(t,s,a),e(this,"previewBlock"),e(this,"levelInfo"),e(this,"emptyBlock"),e(this,"actionBtn"),e(this,"width"),this.width=i;const r=y(a).mainMenu.levelSelection.selectedLevelInfo,{previewBlock:l}=f(a);this.container.add([a.make.text({x:i/2,y:0,text:l.preview,style:{color:"#fff",font:"32px OpenSans_Bold"}}).setOrigin(.5,0)]),this.emptyBlock=a.make.text({...r.emptyText,x:i/2,text:l.empty}).setOrigin(.5,0),this.previewBlock=new gt(10,60,a),this.levelInfo=new ut(0,380,a),this.container.add([this.emptyBlock,this.levelInfo.container,this.previewBlock.container]),o&&(this.actionBtn=o,o.container.setPosition(i/2+70,n-50),o.container.parentContainer.remove(o.container),o.container.setScale(1),this.container.add(o.container),o.hide()),this.previewBlock.hide(),this.levelInfo.hide()}hide(){super.hide(),this.container.setVisible(!1),this.updateInfo(void 0)}updateInfo(t,e,s){if(!t)return this.actionBtn.hide(),this.previewBlock.hide(),this.levelInfo.hide(),void this.emptyBlock.setVisible(!0);this.emptyBlock.setVisible(!1),this.actionBtn.container.setVisible(!0),this.levelInfo.update(String(t.turns),t,s),this.levelInfo.container.setVisible(!0),this.previewBlock.updatePreview(t.board),this.previewBlock.container.setVisible(!0),this.actionBtn.btn.on("pointerup",(()=>{this.scene.time.delayedCall(100,(()=>{this.scene.scene.start("LoadingGame",{mode:r.Play,levelKey:e,levelData:t})}))}))}}class Ct extends F{constructor(t,s){super(0,0,t),e(this,"viewBox"),e(this,"applyBtn"),e(this,"selectedLevelInfo");const i=t.cameras.main.height,{importBlock:n}=f(t);s?this.selectedLevelInfo=s:(this.selectedLevelInfo=new yt(1500,0,420,i,this.applyBtn,t),this.container.add(this.selectedLevelInfo.container)),this.viewBox=t.add.dom(500,0,"div",{width:"1000px",height:`${i}px`,fontSize:"24px",overflow:"auto",display:"flex",justifyContent:"center",alignItems:"center"}).setOrigin(0);const o=document.createElement("textarea");o.classList.add("import-block__text"),o.setAttribute("placeholder","Paste string here");const a=document.createElement("div");a.classList.add("wrapper"),a.classList.add("import-block"),this.viewBox.node.appendChild(a),this.applyBtn=new z(t.cameras.main.width/2,t.cameras.main.height/2+50,n.startBtn,350,50,t),this.container.add([this.applyBtn.container,this.viewBox]);const r=new I(n.folderName);r.add(o),o.addEventListener("input",(()=>{const t=this.parseString(o.value);t&&(this.selectedLevelInfo.show(),this.selectedLevelInfo.updateInfo(t))})),a.appendChild(r.container),this.hide()}parseString(t){try{const e=JSON.parse(atob(t));if(!("turns"in e)||!("board"in e))return;return e}catch(e){console.warn("Not correct string")}}hide(){super.hide(),this.viewBox.node.value="",this.selectedLevelInfo.hide()}}class bt{constructor(t,s,i,n,o,a,r){e(this,"key"),e(this,"btn"),e(this,"tab"),e(this,"_callback"),this.key=t;const l=this.createButton(i,a,r),c=this.createTab(t);n.appendChild(l),o.append(c),this.btn=l,this.tab=c,s&&this.activate()}createButton(t,e,s){const i=document.createElement("button");i.textContent=t,i.classList.add("option-tab__button");const n=()=>e.call(s,this.key);return i.addEventListener("click",n),this._callback=n,i}createTab(t){const e=document.createElement("div");return e.classList.add("option-tab"),e.setAttribute("data-id",t),e}disable(){this.btn.classList.remove("active"),this.tab.classList.remove("active")}activate(){this.btn.classList.add("active"),this.tab.classList.add("active")}destroy(){this._callback&&this.btn.removeEventListener("click",this._callback),this.btn.remove(),this.tab.remove()}}class xt{constructor(t,s,i,n,o){e(this,"container"),e(this,"value"),e(this,"text"),e(this,"valueText"),e(this,"input"),this.container=document.createElement("div"),this.container.classList.add("value-selector"),this.value=s;const a=document.createElement("span");a.classList.add("value-selector__label"),a.textContent=t;const r=document.createElement("div");r.classList.add("range-slider");const l=document.createElement("span");l.classList.add("range-slider__value"),l.textContent=String(s);const c=document.createElement("input");c.setAttribute("type","range"),c.setAttribute("min",`${i}`),c.setAttribute("max",`${n}`),c.value=String(s),c.className="range-slider__input",c.addEventListener("input",(t=>{const e=t.target;this.update(Number(e.value)),o(Number(e.value))})),this.input=c,this.text=l,r.appendChild(c),r.appendChild(l),this.container.appendChild(a),this.container.appendChild(r),this.update(s)}update(t){this.text.textContent=String(t),this.input.style.background=`linear-gradient(to right, var( --clr-slider) ${t}%,transparent ${t}%)`}}class St{constructor(t,s,i,n,o){e(this,"container"),this.container=document.createElement("div"),this.container.classList.add("select");const a=document.createElement("div");a.classList.add("select-wrapper");const r=document.createElement("select"),l=document.createElement("label");l.textContent=t,l.classList.add("select__label");const c=document.createElement("div");c.classList.add("icon"),a.appendChild(r),a.appendChild(c),this.container.appendChild(l),this.container.appendChild(a),i.forEach(((t,e)=>{const s=document.createElement("option");s.value=o?o[e]:t.toLowerCase(),s.textContent=t,r.appendChild(s)})),r.value=s,r.addEventListener("change",n)}}const wt=[{key:"general",TabClass:class extends bt{constructor(t,s,i,n,o,a,r,l){super(s,i,n,o,a,r,l),e(this,"scene"),e(this,"currentConfig",{background:{current:{distortion:0,overlay:0,key:""},options:[]},lang:""}),this.scene=t;const c=y(t);this.currentConfig.background=c.background,this.currentConfig.lang=C(),this.createTextSection(),this.createBackgroundSection()}createTextSection(){const t=Object.entries(this.scene.cache.json.get("langs")),{generalTab:e}=f(this.scene).options,s=new St(e.languageSelection,this.currentConfig.lang,t.map((([t,e])=>e.name)),(t=>{const e=t.target;this.currentConfig.lang=null==e?void 0:e.value}),t.map((([t,e])=>e.key))),i=new I(e.languageBlock,"lang");i.add(s.container),this.tab.appendChild(i.container)}createBackgroundSection(){const{options:{generalTab:t,defaultToggle:e},backgounds:s}=f(this.scene),i=new St(t.image,this.currentConfig.background.current.key,this.currentConfig.background.options.map((t=>s[t])),(t=>{const e=t.target;this.currentConfig.background.current.key=null==e?void 0:e.value}),this.currentConfig.background.options),n=new dt(t.distortion,this.currentConfig.background.current.distortion,e,!1,(t=>{this.currentConfig.background.current.distortion=t})),o=new dt(t.overlay,this.currentConfig.background.current.overlay,e,!1,(t=>{this.currentConfig.background.current.overlay=t})),a=new I(t.background);a.add(i.container),a.add(n.container),a.add(o.container),this.tab.appendChild(a.container)}getValues(){return this.currentConfig}}},{key:"colors",TabClass:class extends bt{constructor(t,s,i,n,o,a,r,l){super(s,i,n,o,a,r,l),e(this,"isDirty",!1),e(this,"colorInputs",{names:[],values:[]});const{colors:c}=t.cache.json.get("config"),{options:h}=f(t),d=document.createElement("div");d.classList.add("colors");const u=new I(h.colorsTab.folderName);u.add(d),this.tab.appendChild(u.container),Object.entries(c).forEach((([,t],e)=>{d.appendChild(this.createColorSelector(e+1,t.colorName,t.value))}))}createColorSelector(t,e,s){const i=document.createElement("div");i.classList.add("selector");const n=document.createElement("div");n.classList.add("selector__index");const o=document.createElement("span");o.textContent=`${t}`,n.append(o);const a=()=>{this.isDirty=!0},r=document.createElement("input");r.classList.add("selector__name"),r.defaultValue=e,r.addEventListener("input",a);const c=document.createElement("input");return c.setAttribute("type","color"),c.defaultValue=`${l(s)}`,c.addEventListener("input",a),i.appendChild(n),i.appendChild(r),i.appendChild(c),this.colorInputs.names.push(r),this.colorInputs.values.push(c),i}getValues(){const t={};return this.colorInputs.names.forEach(((e,s)=>{const i=Phaser.Display.Color.HexStringToColor(this.colorInputs.values[s].value);t[s]={colorName:e.value,value:{x:Math.round(i.red/255*1e3)/1e3,y:Math.round(i.green/255*1e3)/1e3,z:Math.round(i.blue/255*1e3)/1e3}}})),t}}},{key:"sound",TabClass:class extends bt{constructor(t,e,s,i,n,o,a,r){super(e,s,i,n,o,a,r);const{soundTab:l}=f(t).options,c=new I(l.folderName),h=t.registry.get("audioManager"),d=Math.round(100*h.getMasterVolume()),u=Math.round(100*h.getBGMVolume()),p=Math.round(100*h.getSFXVolume()),m=new xt(l.master,d,0,100,(t=>{h.setMasterVolume(t/100)})),g=new xt(l.bgm,u,0,100,(t=>{h.setBGMVolume(t/100)})),v=new xt(l.sfx,p,0,100,(t=>{h.setSFXVolume(t/100)}));c.add(m.container),c.add(g.container),c.add(v.container),this.tab.appendChild(c.container)}}},{key:"gameplay",TabClass:class extends bt{constructor(t,s,i,n,o,a,r,l){super(s,i,n,o,a,r,l),e(this,"currentConfig");const c=y(t);this.currentConfig=c.gameplay;const{gameplayTab:h}=f(t).options,d=new I(h.folderName),u=new dt(h.fluidColors.text,this.currentConfig.fluidColors,h.fluidColors.options,!1,(t=>{this.currentConfig.fluidColors=t})),p=new dt(h.performanceMode.text,Number(this.currentConfig.performanceMode),h.performanceMode.options,!1,(t=>{this.currentConfig.performanceMode=!!t})),m=new dt(h.highlightIntensity.text,this.currentConfig.highlightIntensity,h.highlightIntensity.options,!1,(t=>{this.currentConfig.highlightIntensity=t})),g=new xt(h.animationSpeed,100-x(this.currentConfig.transitionDefault,c.gameplay.transitionMinimum,c.gameplay.transitionMax,0,100),0,100,(t=>{this.currentConfig.transitionDefault=x(100-t,0,100,c.gameplay.transitionMinimum,c.gameplay.transitionMax)}));d.add(u.container),d.add(m.container),d.add(g.container),d.add(p.container),this.tab.appendChild(d.container)}getValues(){return this.currentConfig}}}];function kt(t,e){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||!t||!e)return!1;const s=Object.keys(t),i=Object.keys(e);return s.length===i.length&&s.every((s=>kt(t[s],e[s])))}class Bt extends F{constructor(t,s,i,n,o){var a;super(s,i,t),e(this,"audioManager"),e(this,"btn"),e(this,"overlay"),e(this,"active"),e(this,"text"),e(this,"tweenAnimation");const r=this.container,{menuBtn:l}=t.cache.json.get("config").mainMenu,c=t.add.container(0,0);this.active=c;const h=t.add.image(-50,0,"MainBtnActiveCircle").setOrigin(.5,.5).setScale(.8),d=t.add.image(l.btn.offset,0,"MainBtnActive").setOrigin(0,.5);c.add([h,d]),this.btn=t.add.image(l.btn.offset,0,"uiatlas","menuBtn").setOrigin(0,.5),this.text=t.make.text({...l.text,text:n}).setFixedSize(275,60).setOrigin(0,.5),this.overlay=t.add.image(this.btn.x,this.btn.y,"uiatlas","menuBtn_overlay").setOrigin(0,.5),null==(a=this.overlay.preFX)||a.addBloom(16777215,1,1,1.5),this.overlay.setVisible(!1),this.btn.setInteractive(),this.btn.on("pointerup",o,this),this.btn.on("pointerup",this.onClick,this),this.btn.on("pointerover",this.onEnter,this),this.btn.on("pointerout",this.onLeave,this),this.tweenAnimation=this.scene.tweens.add({targets:h,angle:360,repeat:-1,duration:5e4}),r.add([this.btn,this.overlay,c,this.text]),this.active.setVisible(!1),this.container.setVisible(!1),this.audioManager=this.scene.registry.get("audioManager"),this.scene.time.delayedCall(50,(()=>{this.text.updateText(),this.container.setVisible(!0)})),this.container=r}update(t){t?(this.active.setVisible(!0),this.text.setTintFill(0),this.tweenAnimation.resume()):(this.active.setVisible(!1),this.text.clearTint(),this.tweenAnimation.pause())}onClick(){var t;null==(t=this.audioManager)||t.playSFX("colorSelect")}onEnter(){var t;this.overlay.setVisible(!0),this.scene.input.setDefaultCursor("pointer"),this.text.setColor("#ffffff"),null==(t=this.audioManager)||t.playSFX("colorSelect",{detune:100,volume:.5})}onLeave(){this.overlay.setVisible(!1),this.scene.input.setDefaultCursor("default"),this.text.setColor("#a4a4a4")}}const Tt=[{key:"LevelSelector",type:class extends ct{constructor(t){super(t),e(this,"selectedLevelData"),e(this,"selectedFolder"),e(this,"selectedLevelInfo"),e(this,"levelsContainer"),e(this,"localCache"),e(this,"clearedLevels"),e(this,"importBlock"),e(this,"levels"),e(this,"groupedLevels"),e(this,"cleanupCallbacks",[]);const{scene:s,width:i,height:n}=t;this.levels=s.cache.json.get("levels")||[],this.groupedLevels=this.groupLevels(this.levels),this.localCache=f(s),this.levelsContainer=s.add.dom(0,0,"div",{width:`${i}px`,height:`${n}px`,fontSize:"24px",overflow:"hidden"}).setOrigin(0,0),this.levelsContainer.node.id="level-scroll-container",this.container.add(this.levelsContainer),this.selectedLevelInfo=new yt(1500,0,420,n,this.actionBtn,s),this.importBlock=new Ct(s,this.selectedLevelInfo),this.addBackButton(),this.selectedLevelInfo.hide()}show(){super.show(),this.showFolders()}hide(){super.hide(),this.cleanup(),this.selectedLevelInfo.hide(),this.selectedLevelInfo.updateInfo(void 0),this.importBlock.hide()}showFolders(){if(this.cleanup(),this.clearedLevels=b(),!this.levels.length)return;const t=this.createElem("level-container"),e=this.createElem("folder-row");for(const[i,n]of this.groupedLevels.entries()){const e=[...n.values()].reduce(((t,e)=>t+e.length),0),s=[...n.values()].reduce(((t,e)=>t+this.countCleared(e)),0),o=`${this.localCache.levels[i]}`.toUpperCase(),a=`${s}/${e}`,r=this.createFolderBtn(o,i,a);t.appendChild(r)}const s=this.createBtn(this.localCache.mainMenu.importBtn);s.addEventListener("click",(()=>{this.selectedLevelInfo.show(),this.levelsContainer.node.replaceChildren(),this.importBlock.show()})),s.className="card folder-card",s.setAttribute("data-folder","import"),this.levelsContainer.node.replaceChildren(t),t.appendChild(e),t.appendChild(s),this.scene.events.on("shutdown",(()=>{t.replaceChildren()}))}showSelectedFolder(t){if(this.cleanup(),!this.levels.length)return;this.clearedLevels=b(),this.selectedFolder=t;const e=this.groupedLevels.get(t);if(!e)return;this.selectedLevelInfo.show(),this.levelsContainer.node.replaceChildren();const s=this.createElem("folder-container","div");for(const[i,n]of e.entries()){const{cleared:t,total:e}=this.countClearedStats(n),o=this.createElem("folder","div"),a=`${this.localCache.levels[i]} (${t}/${e})`;o.appendChild(this.createElem("folder-text","p",a));const r=this.createElem("container");n.forEach(((t,e)=>{const s=this.createLevelBtn(`${e+1}`,t.levelData,t.id);r.appendChild(s)})),o.appendChild(r),s.appendChild(o),this.scene.events.on("shutdown",(()=>{s.replaceChildren()}))}this.levelsContainer.node.appendChild(s)}groupLevels(t){const e=new Map;for(const{folderName:s,categoryName:i}of t){e.has(s)||e.set(s,new Map);const t=e.get(s);t.has(i)||t.set(i,[])}return t.forEach((t=>{e.get(t.folderName).get(t.categoryName).push(t)})),e}countCleared(t){return t.filter((t=>this.clearedLevels.has(t.id))).length}countClearedStats(t){return{cleared:this.countCleared(t),total:t.length}}createLevelBtn(t,e,s){const i=this.createBtn(t);return this.clearedLevels.has(s)&&i.classList.add("cleared"),i.addEventListener("click",(()=>{this.selectedLevelInfo.updateInfo(e,s,this.clearedLevels.get(s)),this.selectedLevelInfo.show()})),i}createFolderBtn(t,e,s){const i=this.createElem("card folder-card","button"),n=this.createElem("text","label",t),o=this.createElem("folder__progress","label",s),a=this.createElem("folder-card__img");i.append(a,n,o),i.setAttribute("data-folder",e);const r=()=>this.showSelectedFolder(e);return i.addEventListener("click",r),this.cleanupCallbacks.push((()=>i.removeEventListener("click",r))),i}createBtn(t){const e=this.createElem("card level-card"),s=this.createElem("text","div",t);return e.appendChild(s),e}createElem(t,e="div",s){const i=document.createElement(e);return i.className=t,s&&(i.innerText=s),i}addBackButton(){const t=new z(80,this.actionBtn.container.y,this.localCache.mainMenu.backBtn,200,0,this.scene,(()=>{this.showFolders(),this.selectedLevelInfo.hide(),this.importBlock.hide()}));this.selectedLevelInfo.container.add(t.container)}cleanup(){this.cleanupCallbacks.forEach((t=>t())),this.cleanupCallbacks=[]}}},{key:"LevelEditor",type:class extends ct{constructor(t){super(t),e(this,"selectedFillColor",0),e(this,"rows",8),e(this,"columns",10);const{scene:s,width:i,height:n}=t,{colors:o}=y(s),{levelEditor:a}=f(s),l=s.add.dom(0,0,"div",{width:`${i}px`,height:`${n}px`}).setOrigin(0),c=new I(a.folderName);l.node.appendChild(c.container);const h=new ht(a.gridColumns,this.columns,(()=>(this.columns=Phaser.Math.Clamp(this.columns-1,2,100),this.columns)),(()=>(this.columns=Phaser.Math.Clamp(this.columns+1,2,100),this.columns))),u=new ht(a.gridRows,this.rows,(()=>(this.rows=Phaser.Math.Clamp(this.rows-1,2,100),this.rows)),(()=>(this.rows=Phaser.Math.Clamp(this.rows+1,2,100),this.rows))),p=new ht(a.gridColor,d(this.selectedFillColor,o),(()=>this.changeTargetColor(-1)),(()=>this.changeTargetColor(1)));c.add(h.container),c.add(u.container),c.add(p.container),this.actionBtn.btn.setInteractive(),this.actionBtn.btn.on("pointerup",(()=>{this.scene.scene.start("LoadingGame",{mode:r.Editor,levelData:{board:this.generateField(this.rows,this.columns,this.selectedFillColor),targetColor:0,turns:1}})})),this.container.add([l])}generateField(t,e,s){const i=[];for(let n=0;n<t;n++){i[n]??(i[n]=[]);for(let t=0;t<e;t++)i[n][t]=s}return i}changeTargetColor(t){const{colors:e}=y(this.scene);let s=h(t,this.selectedFillColor);return this.selectedFillColor=s,d(s,e)}}},{key:"EndlessZen",type:class extends ct{constructor(t){super(t),e(this,"selectedFillColor",0),e(this,"rows",8),e(this,"columns",10),e(this,"difficulty",1),e(this,"colorsCount",4);const{scene:s,width:i,height:n}=t,{endlessZen:o}=f(s),a=s.add.dom(0,0,"div",{width:`${i}px`,height:`${n}px`}).setOrigin(0),r=new I(o.folderName);a.node.appendChild(r.container);const l=new ht(o.columnsCount,this.columns,(()=>(this.columns=Phaser.Math.Clamp(this.columns-1,2,100),this.columns)),(()=>(this.columns=Phaser.Math.Clamp(this.columns+1,2,100),this.columns))),c=new ht(o.rowsCount,this.rows,(()=>(this.rows=Phaser.Math.Clamp(this.rows-1,2,100),this.rows)),(()=>(this.rows=Phaser.Math.Clamp(this.rows+1,2,100),this.rows))),h=new ht(o.colorsCount,this.colorsCount,(()=>(this.colorsCount=Phaser.Math.Clamp(this.colorsCount-1,2,8),this.colorsCount)),(()=>(this.colorsCount=Phaser.Math.Clamp(this.colorsCount+1,2,8),this.colorsCount))),d=o.difficulties,u=new dt(o.difficulty,this.difficulty,d,!1,(t=>{this.difficulty=t}));r.add(l.container),r.add(c.container),r.add(h.container),r.add(u.container),this.actionBtn.btn.setInteractive(),this.actionBtn.btn.on("pointerup",this.loadGame,this),this.container.add([a])}loadGame(){this.scene.time.delayedCall(100,(()=>{this.scene.scene.start("LoadingGame",{mode:r.Endless,endlessOptions:{rows:this.rows,columns:this.columns,colorsCount:this.colorsCount,difficulty:this.difficulty},levelData:w(this.rows,this.columns,this.colorsCount,this.difficulty)})}))}}},{key:"Tutorials",type:class extends ct{constructor(t){super(t),e(this,"tutorials");const{tutorials:s}=f(this.scene);this.tutorials=s,this.contentContainer.innerHTML=`\n      <div class="tutorials" style="display: flex; height: 100%;">\n        <div class="topics" style="width: 35%; padding-right: 12px; overflow-y: auto;">\n          ${Object.keys(this.tutorials).map((t=>`\n              <div class="topic card" data-key="${t}" style="cursor: pointer; padding: 8px; margin-bottom: 4px; border: 1px solid #ccc;">\n                ${this.tutorials[t].title}\n              </div>`)).join("")}\n        </div>\n        <div class="content" style="width: 65%; padding-left: 12px; overflow-y: auto;">\n          <h2 id="tutorial-title"></h2>\n          <div id="tutorial-content"></div>\n        </div>\n      </div>\n    `,this.contentContainer.style="display:flex;height:100%",this.actionBtn.setActive(!1),this.bindClickHandlers()}bindClickHandlers(){const t=this.contentContainer.querySelectorAll(".topic"),e=this.contentContainer.querySelector("#tutorial-title"),s=this.contentContainer.querySelector("#tutorial-content");t.forEach((t=>t.addEventListener("click",(()=>{const i=t.getAttribute("data-key"),n=this.tutorials[i];e.textContent=n.title,s.innerHTML=n.content}))))}destroy(){super.destroy()}}},{key:"Options",type:class extends ct{constructor(t){super(t),e(this,"inputs",[]),e(this,"tabs",{}),e(this,"activeTab","general"),e(this,"updateActiveTab",(t=>{this.isTabKey(t)&&(this.activeTab=t,Object.entries(this.tabs).forEach((([e,s])=>{e===t?s.activate():s.disable()})))})),e(this,"resetUserConfig",(()=>{const t=localStorage.getItem(`${g}levels.cleared`);localStorage.clear(),t&&localStorage.setItem(`${g}levels.cleared`,t),this.hide(),this.scene.cache.json.remove("config"),this.scene.time.delayedCall(100,(()=>{this.scene.scene.start("Boot")}))})),e(this,"saveUserConfig",(()=>{const t=this.tabs.colors,e=this.tabs.general,s=this.tabs.gameplay,i=y(this.scene),n=t.getValues(),o=e.getValues(),a=s.getValues();t.isDirty&&!kt(i.colors,n)&&localStorage.setItem(`${g}colors`,JSON.stringify(n)),localStorage.setItem(`${g}background`,JSON.stringify(o.background)),localStorage.setItem(`${g}gameplay`,JSON.stringify(a)),localStorage.setItem("lang",o.lang),this.hide(),this.scene.time.delayedCall(100,(()=>{this.scene.scene.start("Boot")}))}));const{options:s}=f(this.scene);this.setupActionButtons(s),this.setupTabs(s)}setupActionButtons(t){const{primaryBtn:e}=y(this.scene).mainMenu.options;this.actionBtn.text.setText(t.btnSave),this.actionBtn.btn.on("pointerup",this.saveUserConfig,this);const s=new z(e.x,e.y,t.btnReset,e.width,e.height,this.scene,this.resetUserConfig,this);this.container.add(s.container)}setupTabs(t){const e=document.createElement("div"),s=document.createElement("div");this.contentContainer.append(e,s),this.contentContainer.classList.add("menu-options"),wt.forEach((({key:i,TabClass:n})=>{const o=i===this.activeTab,a=t.tabs[i],r=new n(this.scene,i,o,a,e,s,this.updateActiveTab,this);this.tabs[i]=r})),this.scene.events.on("shutdown",(()=>{this.container.destroy(!0),Object.values(this.tabs).forEach((t=>t.destroy()))}),this)}isTabKey(t){return wt.some((e=>e.key==t))}show(){super.show(),this.update()}update(){const{colors:t}=this.scene.cache.json.get("config");this.inputs.forEach(((e,s)=>{const i=t[s],n=Phaser.Display.Color.RGBToString(255*i.x,255*i.y,255*i.z);e.style.background=n,e.value=n}))}addText(t,e,s){const i=document.createElement("p");i.textContent=t,s&&i.classList.add(s),e.appendChild(i)}addCheckbox(t,e,s){const i=document.createElement("div");i.className="checkbox-row",this.addText(t,i);const n=document.createElement("input");return n.type="checkbox",n.checked=Boolean(localStorage.getItem(s)),i.appendChild(n),e.appendChild(i),n}}}];class Et extends i.Scene{constructor(){super("MainMenu"),e(this,"activeTab"),e(this,"tabs",new Map),e(this,"tabBtns",new Map),e(this,"btnsContainer"),e(this,"tutorialMenu")}create(){this.initAudioManager(),this.createBackground(),this.createTabs(),this.createButtons(),this.cameras.main.fadeIn(1e3,0,0,0)}initAudioManager(){var t;const e=this.registry.get("audioManager"),s=(null==(t=null==e?void 0:e.setScene)?void 0:t.call(e,this))??new K(this);this.registry.set("audioManager",s)}createBackground(){const{width:t,height:e}=this.cameras.main;if(new G(this),!this.textures.exists("gradient")){const s=this.textures.createCanvas("gradient",800,e);if(s){const i=s.getContext(),n=i.createLinearGradient(0,0,800,0);n.addColorStop(0,"black"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=n,i.fillRect(0,0,t,e),s.refresh()}}this.add.image(0,0,"gradient").setOrigin(0),this.add.graphics().fillStyle(1447446,1).lineStyle(4,4473924,.6).lineBetween(50,0,50,e)}createTabs(){const{width:t,height:e}=this.cameras.main,s={x:500,y:0,width:t-500,height:e};for(const{key:i,type:n,props:o}of Tt){const t=new n({scene:this,key:i,...s,...o});this.tabs.set(i,t)}}createButtons(){y(this).mainMenu.buttonsBlock;const{x:t,y:e,gap:s}=y(this).mainMenu.buttonsBlock,i=f(this),n=[{key:"LevelSelector",text:i.mainMenu.selectLevel},{key:"EndlessZen",text:i.mainMenu.endlessZen},{key:"LevelEditor",text:i.mainMenu.createLevel},{key:"Tutorials",text:i.mainMenu.tutorials},{key:"Options",text:i.mainMenu.options}],o=this.add.container(t,e),a=100+s;n.forEach((({key:t,text:e},s)=>{const i=this.createTabButton(0,s*a,e,t);this.tabBtns.set(t,i),o.add(i.container)})),this.btnsContainer=o,this.events.on("shutdown",this.onDestroy,this)}onDestroy(){Object.values(this.tabs).forEach((t=>t.destroy())),this.btnsContainer.destroy(!0)}createTabButton(t,e,s,i){return new Bt(this,t,e,s,(()=>{Tt.forEach((({key:t})=>{var e;const s=this.tabs.get(t);if(!s)return;const n=i===t&&!s.container.visible;null==(e=this.tabBtns.get(t))||e.update(n),s.setActive(n)}))}))}}class Lt extends Phaser.Scene{constructor(){super("LoadingGame")}create(t){new at(this),this.time.delayedCall(100,(()=>{this.scene.start("Game",t)}))}}const Mt={type:i.AUTO,width:1920,height:1080,parent:"game-container",backgroundColor:"#121212",dom:{createContainer:!0},scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH},scene:[rt,Et,Lt,ot]},Ot=new Phaser.Game(Mt);document.addEventListener("DOMContentLoaded",(()=>{Ot.scene.start("Boot"),document.body.addEventListener("contextmenu",(t=>{t.preventDefault(),t.stopPropagation()}))}));
